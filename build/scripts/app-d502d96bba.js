"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}();!function(){var e=window.smi2=window.smi2||{};e.app={name:"SMI2",version:window.TabixVersion||"",buildDate:window.TabixBuildDate||""},angular.module(e.app.name,["ngAnimate","ui.router","LocalStorageModule","angularScreenfull","ui.ace","ui.grid","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.exporter","ui.grid.selection","angularResizable","ngSanitize","ngMaterial","funMetisMenu","ngScrollbars","ngCsv","pascalprecht.translate","cfp.hotkeys","ngHandsontable","gridster"])}(),angular.module("SMI2").run(["$templateCache",function(e){e.put("app/base/404.html",'<div class="p++"><h2 class="mt0">404 {{\'не найдено\' | translate}}</h2><md-button class="ml0 md-raised md-primary" ui-sref="dashboard"><i class="mdi mdi-arrow-left"></i> {{ \'Назад\' | translate }}</md-button></div>'),e.put("app/base/base.html",'<div class="wrapper"><header ui-view="header" class="header-view"></header><div class="content"><div ui-view="sidebar" ng-class="{\'show\': showSidebar}" class="sidebar-view" resizable="" r-directions="[\'right\']" r-width="200" r-flex="true"></div><div class="main-content"><div ui-view="main" style="height: 100%"></div><div class="md-sidenav-fix"><md-sidenav class="md-sidenav-right md-whiteframe-4dp" md-component-id="tableSiedenav"><md-content ng-if="currentTable" layout-padding=""><md-button class="md-icon-button right-button" ui-sref="table({tableName:currentTable, dbName:currentDatabase})"><i class="mdi mdi-arrow-expand-all"></i><md-tooltip md-direction="left">{{\'Открыть таблицу\' | translate}}</md-tooltip></md-button><div class="h100" ng-include="\'app/table/table-container.html\'" ng-controller="TableContainerController" ng-init="initContainer()"></div></md-content></md-sidenav></div></div></div></div>'),e.put("app/base/breadcrumbs.html",'<ol ng-if="$root.breadcrumbs" class="breadcrumb p+"><li class="home-item"><a ui-sref="dashboard" lx-ripple="lx-ripple" class="btn btn--xs btn--white btn--fab"><i class="mdi mdi-home"></i></a></li><li ng-repeat="nav in $root.breadcrumbs" class="breadcrumb-item"><i class="icon tc-white icon--xs mdi mdi-chevron-right"></i> <a ng-if="!$last" ui-sref="{{nav.link}}(nav.params)" class="btn btn--xs btn--white btn--raised">{{nav.text}}</a> <span ng-if="$last" class="tc-white">{{nav.text}}</span></li></ol>'),e.put("app/base/header.html",'<div class="header"><md-card class="m0 pl0"><div><div class="pull-left" style="width: 210px"><a ui-sref="dashboard"><img src="assets/images/logotabix.png" class="mr logo"></a></div><div class="pull-right top-menu"><md-button aria-label="menu" ui-sref="sql"><i class="mdi mdi-24px mdi-console"></i> SQL</md-button><md-button aria-label="menu" ui-sref="metrics"><i class="mdi mdi-24px mdi-playlist-play"></i> {{\'Метрики и список процессов\' | translate}}</md-button><md-button aria-label="menu" ng-click="help()" style="vertical-align:top"><i class="mdi mdi-24px mdi-help"></i> {{\'Справка\' | translate}}</md-button><md-menu md-position-mode="target-right target"><md-button aria-label="menu" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-24px mdi-theme-light-dark" style="vertical-align:top"></i> {{\'Тема\' | translate}}</md-button><md-menu-content><md-menu-item ng-repeat="theme in themes"><md-button ng-click="setUiTheme(theme)">{{theme.title}}</md-button></md-menu-item></md-menu-content></md-menu><md-button aria-label="{{\'Выход\' | translate}}" ng-click="logout()" style="vertical-align:top"><i class="mdi mdi-24px mdi-lock"></i> {{\'Выход\' | translate}}</md-button><span class="header-user-name hide-sm p+">{{user}}</span></div></div></md-card></div>'),e.put("app/base/helpDialogRu.html",'<md-dialog aria-label="Mango (Fruit)"><form><md-toolbar><div class="md-toolbar-tools"><h2>Tabix.io {{\'Сборка\' | translate}} {{::vars.version}} [{{::vars.buildDate}}]</h2><span flex=""></span><md-button class="md-icon-button" ng-click="cancel()"><md-icon aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content style="max-width:800px;max-height:810px;"><md-tabs md-dynamic-height="" md-border-bottom=""><md-tab label="Home"><md-content class="md-padding"><p><a href="https://clickhouse.yandex/reference_ru.html" target="_blank" style="text-decoration: underline">ClickHouse Руководство</a></p><p><a href="https://tabix.io/doc/" target="_blank" style="text-decoration: underline">Tabix Руководство</a></p></md-content></md-tab><md-tab label="Hot keys"><md-content class="md-padding"><h1 class="md-display-2">Hot keys</h1><md-list class="fixedRows"><md-list-item class="md-2-line contact-item"><div class="md-list-item-text compact"><h3>⌘ + Y</h3><p>Drop current line</p></div></md-list-item><md-list-item class="md-2-line contact-item"><div class="md-list-item-text compact"><h3>⌘ + ⇧ + F</h3><p>Reformat</p></div></md-list-item><md-list-item class="md-2-line contact-item"><div class="md-list-item-text compact"><h3>⌘ + ⇧ + Plus|Minus</h3><p>свернуть все/развернуть</p></div></md-list-item><md-list-item class="md-2-line contact-item"><div class="md-list-item-text compact"><h3>⌘ + Right|Left</h3><p>переключает вкладки</p></div></md-list-item><md-list-item class="md-2-line contact-item"><div class="md-list-item-text compact"><h3>⌘ + ⌥ + Up|Down</h3><p>Copy lines Up/Down</p></div></md-list-item><md-list-item class="md-2-line contact-item"><div class="md-list-item-text compact"><h3>⌥ + Up|Down</h3><p>Move lines Up/Down</p></div></md-list-item><md-list-item class="md-2-line contact-item"><div class="md-list-item-text compact"><h3>Ctrl + K</h3><p>Remove to line end</p></div></md-list-item><md-list-item class="md-2-line contact-item"><div class="md-list-item-text compact"><h3>⌘ + Backspace</h3><p>Remove to linestart</p></div></md-list-item></md-list><a href="https://github.com/ajaxorg/ace/wiki/Default-Keyboard-Shortcuts" target="_blank" style="text-decoration: underline">Ace Editor Default Keyboard Shortcuts</a></md-content></md-tab><md-tab label="Draw Commands"><md-content class="md-padding"><h3 class="md-display-2">DrawChart</h3><p>DrawChart</p><h3 class="md-display-2">DrawMap</h3><p>DrawMap</p></md-content></md-tab></md-tabs></md-dialog-content><md-dialog-actions layout="row"><md-button href="https://tabix.io" target="_blank" md-autofocus="">https://tabix.io</md-button><span flex=""></span><md-button ng-click="answer(\'useful\')" style="margin-right:20px;">Ok</md-button></md-dialog-actions></form></md-dialog>'),e.put("app/base/sidebar.html",'<div class="sidebar" ng-app="sidebar" ng-scrollbars="" ng-scrollbars-config="vars.scrollConfig"><md-input-container md-no-float="" class="md-block"><input ng-model="vars.searchline" type="text" placeholder="{{\'Поиск\' | translate}}"><md-icon class="mdi mdi-filter-remove" ng-click="vars.searchline=\'\'" style="display:inline-block;"></md-icon></md-input-container><fun-metis-menu ng-if="vars.loaded && !vars.error" fun-metis-config="vars.metis.config" fun-metis-events="vars.metis.events" class="metismenu"><nav><ul><li class="active"><a class="has-arrow"><md-button class="text-left no-txt-transform w200"><i class="mdi mdi-server"></i> Server <span class="pull-right" style="color: silver"></span></md-button></a><ul class="sub-menu"><li ng-repeat="database in vars.databases" ng-class="currentDatabase==database.name?\'active\':\'\'"><a ng-mouseenter=""><md-button class="text-left no-txt-transform w100" ng-dblclick="clickAndSelect(database, $event)"><i class="mdi mdi-database"></i> {{database.name}} <span class="db__table-count">{{database.tables.length}}</span></md-button></a><ul class="sub-menu" ng-if="database.tables.length"><li ng-repeat="table in database.tables"><a class="has-arrow" ng-if="table.active"><md-menu mousepoint-menu=""><md-button ng-mouseenter="" class="text-left no-txt-transform" ng-dblclick="openTable(table)" ng-right-click="$mdOpenMousepointMenu($event)"><i ng-if="table.classEngine" class="mdi mdi-{{table.classEngine}}"></i> <i ng-if="!table.classEngine" class="mdi mdi-table"></i> {{table.name}}</md-button><md-menu-content width="4"><md-menu-item ng-repeat="menu in table.rightMenuList | filter: {active: true}"><md-button ng-click="rightMenuProcessTable(menu, $event)"><i class="mdi mdi-{{menu.icon}}"></i> {{menu.value}}</md-button></md-menu-item></md-menu-content></md-menu></a><ul class="sub-menu"><li ng-repeat="field in table.fields" class="text-left no-txt-transform table-fields-sidebar" ng-click="clickInsertField(field)"><pre style="margin: 2px 0px 0px 2px" ng-if="field.active">{{field.name}}</pre></li></ul></li></ul></li></ul></li></ul></nav></fun-metis-menu><div ng-if="vars.loaded && vars.error" class="mt+">No connect, or Error or Loadind! See console log</div></div>'),e.put("app/login/login.html",'<div class="wrapper"><div class="header header-view"><md-card class="m0 pl0"><div><div class="mr pull-left"><img src="assets/images/logotabix.png" class="logo"></div><div class="pull-left"><a ui-sref="dashboard" class="tc-white"></a></div><div class="pull-right"><md-menu md-position-mode="target-right target"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-24px mdi-theme-light-dark"></i></md-button><md-menu-content><md-menu-item ng-repeat="theme in vars.themes"><md-button ng-click="setUiTheme(theme)">{{theme.title}}</md-button></md-menu-item></md-menu-content></md-menu></div></div></md-card></div><div class="content"><div class="sidebar-view login"><md-card class="m0 h100" style="width: 200px"><div ng-repeat="base in vars.bases"><md-button class="menu-button" ng-click="vars.db = base"><span class="menu-button__title">{{base.name}}</span> <span class="menu-button__subtitle">{{base.host }}</span></md-button></div></md-card></div><div class="main-content login"><div class="main-view"><div class="login-view"><md-tabs md-dynamic-height="" md-border-bottom="" class="login-tabs"><md-tab><md-tab-label>Direct CH</md-tab-label><md-tab-body><md-card md-theme="{{ showDarkTheme ? \'dark-grey\' : \'default\' }}" md-theme-watch=""><form class="p++" name="loginForm"><div><md-input-container><label>{{\'Название\' | translate}}</label> <input ng-model="vars.db.name" required="" placeholder="dev" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Хост:порт\' | translate}}</label> <input ng-model="vars.db.host" placeholder="http://127.0.0.1:8123" required="" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Логин\' | translate}}</label> <input ng-model="vars.db.login" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Пароль\' | translate}}</label> <input type="password" ng-model="vars.db.password" ng-click="onKeypress($event)" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Параметры\' | translate}}</label> <input ng-model="vars.db.params" placeholder="key1=value&key2=value" ng-disabled="vars.loading"></md-input-container></div><div layout="row"><div flex=""><md-button class="md-primary md-raised m0 width-100" ng-disabled="loginForm.$invalid || vars.loading" ng-click="login()">{{\'Войти\' | translate}}</md-button></div><div flex="" ng-if="vars.db.id" class="pl"><md-button class="md-raised md-warn m0 width-100" ng-disabled="vars.loading" ng-click="remove()">{{\'Удалить\' | translate}}</md-button></div></div></form></md-card></md-tab-body></md-tab><md-tab><md-tab-label>tabiX.server</md-tab-label><md-tab-body><md-card md-theme="{{ showDarkTheme ? \'dark-grey\' : \'default\' }}" md-theme-watch=""><form class="p++" name="loginServerForm"><div><md-input-container><label>{{\'Название\' | translate}}</label> <input ng-model="vars.db.name" required="" placeholder="dev" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Сервер\' | translate}}</label> <input ng-model="vars.db.tabix.server" required="" placeholder="https://tabix.dev/s1" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Config Key\' | translate}}</label> <input ng-model="vars.db.tabix.confid" placeholder="empty" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Логин\' | translate}}</label> <input ng-model="vars.db.tabix.login" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Пароль\' | translate}}</label> <input type="password" ng-model="vars.db.tabix.password" ng-click="onKeypress($event)" ng-disabled="vars.loading"></md-input-container></div><div layout="row"><div flex=""><md-button class="md-primary md-raised m0 width-100" ng-disabled="vars.loading" ng-click="login()">{{\'Войти\' | translate}}</md-button></div><div flex="" ng-if="vars.db.id" class="pl"><md-button class="md-raised md-warn m0 width-100" ng-disabled="vars.loading" ng-click="remove()">{{\'Удалить\' | translate}}</md-button></div></div></form></md-card></md-tab-body></md-tab></md-tabs></div></div><div class="footer"><md-card class="m0 p"><div><a href="https://github.com/smi2/" target="_blank" class="pull-right"><i class="mdi mdi-github-circle mdi-24px"></i></a><p class="copyright text-center" style="line-height: 24px"><a href="https://tabix.io/" target="_blank" class="tc-white" style="text-decoration: underline">Tabix.IO</a> from <a href="https://github.com/smi2" target="_blank" style="text-decoration: underline" class="tc-white">{{\'СМИ2\' | translate}}</a> &copy; {{::vars.year}}, {{\'все права защищены\' | translate}}. {{\'Сборка\' | translate}} {{::vars.version}}</p></div></md-card></div></div></div></div>'),e.put("app/metrics/dialog.kill.html",'<md-dialog aria-label="Mango (Fruit)"><form ng-cloak=""><md-toolbar><div class="md-toolbar-tools"><h2>Kill query</h2><span flex=""></span><md-button class="md-icon-button" ng-click="cancel()"><md-icon aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="md-dialog-content"><md-list flex=""><md-subheader class="md-no-sticky"></md-subheader><md-list-item class="md-3-line" ng-repeat="q in queryesToKill" ng-click="kill(q)"><div class="md-list-item-text" layout="column"><h3>{{ q.elapsed }}</h3><b>{{ q.query }}</b><p>{{ q.bytes_read }}</p><p>{{ q.hash }}</p></div></md-list-item></md-list></div></md-dialog-content><md-dialog-actions layout="row"><span flex=""></span><md-button ng-click="cancel()">Cancle</md-button></md-dialog-actions></form></md-dialog>'),e.put("app/metrics/metrics.html",'<md-tabs md-stretch-tabs="yes" md-border-bottom="" md-autoselect="" layout-fill="" md-selected="vars.selectedTabResultIndex" style="width: 100%;height: 100%"><md-tab md-on-select="initOverviewTab()" ng-click="initOverviewTab()" layout-fill=""><md-tab-label>{{\'Обзор\' | translate}} <i class="mdi mdi-18px mdi-table-large"></i></md-tab-label><md-tab-body><div ng-include="\'app/metrics/overview.html\'" ng-if="vars.active.Overview"></div></md-tab-body></md-tab><md-tab md-on-select="initChartTab()" layout-fill=""><md-tab-label>{{\'Метрики\' | translate}} <i class="mdi mdi-18px mdi-chart-bar"></i></md-tab-label><md-tab-body><div flex="" layout-fill="" ng-include="\'app/metrics/metricschart.html\'" ng-if="vars.active.Chart"></div></md-tab-body></md-tab><md-tab md-on-select="initProcessesTab()" layout-fill=""><md-tab-label>{{\'Список процессов\' | translate}} <i class="mdi mdi-18px mdi-palette-advanced"></i></md-tab-label><md-tab-body><div flex="" layout-fill="" ng-include="\'app/metrics/processes.html\'" ng-if="vars.active.Processes"></div></md-tab-body></md-tab></md-tabs>'),e.put("app/metrics/metricschart.html",'<div ng-controller="MetricschartController as render" style="width: 100%;height: 100%"><h1 class="md-title">{{\'Метрики\' | translate}}</h1><md-card-content><div layout="row"><md-input-container class="md-block" flex-gt-sm=""><label>{{\'Частота обновления\' | translate}}</label><md-select ng-model="vars.interval" ng-change="setInterval()"><md-option ng-repeat="interval in [-1, 1, 5, 10, 20, 30]" ng-value="interval">{{interval == -1 ? (\'Обновление отключено\'|translate) : interval +\' \'+(\'сек\'|translate)}}</md-option></md-select></md-input-container><md-input-container class="md-block" flex-gt-sm=""><label>{{\'Максимально точек\' | translate}}</label><md-select ng-model="maxlength" ng-change="setMaxlength()"><md-option ng-repeat="interval in [50, 100, 500, 1500,3600,5000,10000]" ng-value="interval">{{interval}}</md-option></md-select></md-input-container><md-input-container class="md-block" flex-gt-sm=""><md-switch class="md-primary" name="special" ng-model="vars.logEvents">system.events</md-switch></md-input-container><md-input-container class="md-block" flex-gt-sm="" ng-click="load()"><md-button class="md-raised md-primary">{{\'Обновить\' | translate}}</md-button></md-input-container><md-input-container class="md-block" flex-gt-sm="" ng-click="flush()"><md-button class="md-raised">{{\'Очистить\' | translate}}</md-button></md-input-container></div></md-card-content><md-card-content><div style="width: 100%;height: 100%"><div id="metrcisChart" style="width: 100%;height: 100%"></div></div></md-card-content></div>'),e.put("app/metrics/overview.html",'<h1 class="md-title">{{\'Обзор\' | translate}}</h1><div ng-controller="OverviewController as render"><div class="row"><div class="col-md-12"><div gridster="gridsterOpts"><ul><li gridster-item="w" ng-repeat="w in widgets"><div class="widget-box"><div class="widget-box-content widget-draggable"><draw-widget style="display: block;" widget="w" ng-if="w.init && !w.error" isdark="vars.isDark" class="widget widget-{{w.type}}" events="events"></draw-widget><div ng-bind-html="w.error" class="font-monospace" ng-if="w.error"></div><div ng-bind-html="w.text" class="font-monospace" ng-if="w.text"></div><span ng-if="w.empty">{{\'нет данных\' | translate}}</span></div></div></li></ul></div></div></div></div>'),e.put("app/metrics/processes.html",'<div ng-controller="ProcessesController as render" style="width: 100%;height: 100%"><h1 class="md-title">{{\'Список процессов\' | translate}}</h1><md-card-content><div layout="row"><md-input-container class="md-block" flex-gt-sm=""><label>{{\'Частота обновления\' | translate}}</label><md-select ng-model="vars.interval" ng-change="setInterval()"><md-option ng-repeat="interval in [-1, 1, 5, 10, 20, 30]" ng-value="interval">{{interval == -1 ? (\'Обновление отключено\'|translate) : interval +\' \'+(\'сек\'|translate)}}</md-option></md-select></md-input-container><md-input-container class="md-block" flex-gt-sm=""><md-switch class="md-primary" name="special" ng-model="table.wordWrap">{{\'Перенос строк\' | translate}}</md-switch></md-input-container><md-input-container class="md-block" flex-gt-sm=""><md-switch class="md-primary" name="special" ng-model="vars.logMode">{{\'Логирование\' | translate}}</md-switch></md-input-container><md-input-container class="md-block" flex-gt-sm="" ng-click="load()"><md-button class="md-raised md-primary">{{\'Обновить\' | translate}}</md-button></md-input-container><md-input-container class="md-block" flex-gt-sm="" ng-click="flush()"><md-button class="md-raised">{{\'Очистить\' | translate}}</md-button></md-input-container><md-input-container class="md-block" flex-gt-sm="" ng-click="dialogKill()"><md-button class="md-raised md-warn">KILL Query</md-button></md-input-container></div><div layout="row"><md-progress-circular ng-if="vars.loading" class="md-accent" md-diameter="40"></md-progress-circular><hot-table ng-class="{\'handsontable-dark\': vars.isDark}" hot-id="hotTableProcesses" word-wrap="table.wordWrap" settings="table.settings" datarows="table.data" style="width: 100%;height: 100%;" col-headers="table.colHeaders" manual-column-resize="true" class="font-monospace"></hot-table></div></md-card-content></div><md-card-content></md-card-content>'),e.put("app/render/WidgetsList.html",'<div class="row"><div class="col-md-12"><div gridster="gridsterOpts"><ul><li gridster-item="w" ng-repeat="w in widgets"><div class="widget-box"><div class="widget-box-content widget-draggable"><draw-widget style="display: block;" widget="w" ng-if="w.init && !w.error" isdark="vars.isDark" class="widget widget-{{w.type}}" events="events"></draw-widget><div ng-bind-html="w.error" class="font-monospace" ng-if="w.error"></div><div ng-bind-html="w.text" class="font-monospace" ng-if="w.text"></div><span ng-if="w.empty">{{\'нет данных\' | translate}}</span></div></div></li></ul></div></div></div>'),e.put("app/table/table-container.html",'<div style="position: absolute;top: 0px;bottom: 59px;left: 16px;right: 16px;z-index: 1" class="md-tabs-fix"><h3>{{vars.currentDatabase}} <i class="mdi mdi-chevron-right"></i> {{vars.currentTable}}</h3><md-tabs md-dynamic1-height="" md-border-bottom="" class="h100"><md-tab><md-tab-label><i class="mdi mdi-table-column-plus-after mr-"></i>{{\'Структура\' | translate}}</md-tab-label><md-tab-body><table class="data-table" style="font-size: 80%"><thead><tr class="text-left"><th style="width: 40px"></th><th style="width: 40%">{{\'Название\' | translate}}</th><th style="width: 10%">{{\'Тип\' | translate}}</th><th style="width: 10%">{{\'Default тип\' | translate}}</th><th style="width: 10%">{{\'Значение\' | translate}}</th><th style="width: 10%">{{\'Размер\' | translate}}</th><th style="width: 10%">Compress</th></tr></thead><tbody><tr class="text-left" ng-repeat="field in vars.columns.data"><td class="tc-grey-400">{{$index + 1}}</td><td ng-repeat="key in [\'name\', \'type\', \'default_type\', \'default_expression\',\'size\',\'ratio\'] track by $index">{{field[key]}}</td></tr></tbody></table></md-tab-body></md-tab><md-tab><md-tab-label><i class="mdi mdi-information mr-"></i>{{\'Информация\' | translate}}</md-tab-label><md-tab-body><div class="data-table-container" style="overflow:hidden;"><table class="data-table"><tbody><tr class="data-table-row"><td class="tc-grey-400" style="width: 40px">1</td><td style="width: 200px">{{\'Размер\' | translate}}</td><td>{{vars.statistics.size}}</td></tr><tr class="data-table-row"><td class="tc-grey-400">2</td><td>{{\'Размер, байт\' | translate}}</td><td>{{vars.statistics.sizeBytes}}</td></tr><tr class="data-table-row"><td class="tc-grey-400">3</td><td>{{\'Первая запись\' | translate}}</td><td>{{vars.statistics.minDate}}</td></tr><tr class="data-table-row"><td class="tc-grey-400">4</td><td>{{\'Последняя запись\' | translate}}</td><td>{{vars.statistics.maxDate}}</td></tr></tbody></table><br><b>SHOW CREATE TABLE</b><br><pre>{{vars.createtable}}</pre></div></md-tab-body></md-tab><md-tab md-active="true"><md-tab-label><i class="mdi mdi-table-large mr-"></i>{{\'Данные\' | translate}}</md-tab-label><md-tab-body><div style="display:table"></div><div class="pl+ pt+ pb+ pr" style="font-size: .75rem;max-height:100%"><div class="float-right" style="margin-top: -12px"><md-button class="md-icon-button" aria-label="load prev" ng-click="loadPrev()" ng-disabled="vars.offset === 0"><i class="mdi mdi-arrow-left"></i></md-button><md-button class="md-icon-button" aria-label="load next" ng-click="loadNext()"><i class="mdi mdi-arrow-right"></i></md-button></div>{{\'Данные\' | translate}} <span class="tc-grey-400">{{\'с\' | translate}} {{vars.offset}} {{\'по\' | translate}} {{vars.offset + vars.limit}}</span></div><div class="card__actions p+" style="position:absolute; top:46px; bottom:0;left:0;right:0; overflow:hidden;"><span ng-if="vars.data === null&&!vars.loading" class="fs-caption">{{\'нет данных\' | translate}}</span><md-progress-circular ng-if="vars.loading" class="md-accent" md-diameter="40"></md-progress-circular><hot-table ng-class="{\'handsontable-dark\': vars.isDark}" hot-id="hotTableContain" settings="table.settings" datarows="table.data" style="width: 99%;height: 99%" col-headers="table.colHeaders" manual-column-resize="true"></hot-table></div></md-tab-body></md-tab></md-tabs></div>'),e.put("app/table/table.html",'<div ng-controller="TableContainerController" ng-include="\'app/table/table-container.html\'" ng-init="initOnGo()"></div>'),e.put("app/sql/renderResult.html",'<div ng-controller="RenderCtrl as render"><md-tab ng-repeat="resultContainer in tab.results" md-dynamic1-height="" md-border-bottom="" class="h100"><md-tab-label>{{::resultContainer.time}} <i class="mdi mdi-18px ml+" ng-class="resultContainer.pinned ? \'mdi-pin\' : \'mdi-pin-off\'" ng-click="resultContainer.pinned = !resultContainer.pinned; $event.stopPropagation()"></i> <i class="mdi mdi-close" ng-click="removeResult(tab, resultContainer, $event)"></i></md-tab-label><md-tab-body><div style="position: absolute; top: 4px; right: 4px; z-index: 2"><md-button aria-label="menu" class="md-icon-button"><i class="mdi mdi-18px ml+" ng-class="vars.staticGrid ? \'mdi-pin\' : \'mdi-pin-off\'" ng-click="switchStaticGrid()"></i><md-tooltip>{{\'Привязка\' | translate}}</md-tooltip></md-button></div><div ng-if="!tabsRender" ng-init="initNoTabs()"><div ng-init="widgets = resultContainer.widgets.tables" ng-include="\'app/render/WidgetsList.html\'" ng-if="vars.active.table"></div><div ng-init="widgets = resultContainer.widgets.draw" ng-include="\'app/render/WidgetsList.html\'" ng-if="vars.active.draw"></div></div><md-tabs ng-if="tabsRender" md-dynamic-height="" md-border-bottom="" md-autoselect="" md-selected="tab.selectedTabResultIndex"><md-tab md-on-select="initTableTab()" ng-click="vars.active.table=true"><md-tab-label>Table <i class="mdi mdi-18px mdi-table-large"></i></md-tab-label><md-tab-body><div ng-init="widgets = resultContainer.widgets.tables" ng-include="\'app/render/WidgetsList.html\'" ng-if="vars.active.table"></div></md-tab-body></md-tab><md-tab md-on-select="vars.active.draw=true"><md-tab-label>Draw <i class="mdi mdi-18px mdi-chart-bar"></i></md-tab-label><md-tab-body><div ng-init="widgets = resultContainer.widgets.draw" ng-include="\'app/render/WidgetsList.html\'" ng-if="vars.active.draw"></div></md-tab-body></md-tab><md-tab md-on-select="vars.active.pivot=true"><md-tab-label>Pivot <i class="mdi mdi-18px mdi-palette-advanced"></i></md-tab-label><md-tab-body><div ng-init="widgets = resultContainer.widgets.pivot" ng-include="\'app/render/WidgetsList.html\'" ng-if="vars.active.pivot"></div></md-tab-body></md-tab></md-tabs></md-tab-body></md-tab></div>'),e.put("app/sql/sql.html",'<div style="position: absolute; top: 4px; right: 4px; z-index: 2"><md-button aria-label="menu" class="md-icon-button" ng-click="toggleSidenav(\'right\')"><i class="mdi mdi-settings"></i><md-tooltip>{{\'Настройки редактора\' | translate}}</md-tooltip></md-button></div><div ngsf-fullscreen="fullscreenCtrl" class="fullscreen md-tabs-fix" ng-class="vars.uiTheme.name"><md-tabs md-dynamic-height="" md-border-bottom="" md-selected="vars.selectedTab" class="sql-tabs"><md-tab ng-repeat="tab in vars.tabs" ng-click="vars.currentTab = tab"><md-tab-label>{{tab.name + (tab.changed ? \' *\' : \'\')}} <i class="mdi mdi-pencil ml+" ng-click="changeTabName(tab, $event)" style="cursor: pointer"></i> <i class="mdi mdi-close" ng-click="removeTab(tab, $event)" style="cursor: pointer"></i></md-tab-label><md-tab-body><div style="display: table; width: 100%;"><div style="min-height: 100px; position: relative; display: table-cell;"><div resizable="" r-directions="[\'bottom\']" r-height="300" style=""><md-menu mousepoint-menu=""><div ng-model="tab.sql" ng-right-click="$mdOpenMousepointMenu($event)" ui-ace="{ useWrapMode : true, mode: \'clickhouse\', onLoad: aceLoaded, advanced: { enableBasicAutocompletion: true } }" style="width: 100%; height: 100%;" ng-mouseenter=""></div><md-menu-content id="menu" width="4"><md-menu-item ng-repeat="menu in rightAceMenuList | filter: {active: true}"><md-button ng-click="rightMenuProcess(menu, $event)"><i class="mdi mdi-{{menu.icon}}"></i> {{menu.value}}</md-button></md-menu-item><md-menu-divider></md-menu-divider></md-menu-content></md-menu></div><md-button class="md-raised1 md-primary" ng-disabled="tab.loading" ng-click="execute(\'all\', tab)">{{tab.buttonTitle}}</md-button><md-button class="md-icon-button" ng-click="fullscreenCtrl.toggleFullscreen()" aria-label="fullscreen"><i class="mdi mdi-fullscreen"></i><md-tooltip>{{\'На весь экран\' | translate}}</md-tooltip></md-button><md-button class="md-icon-button" ng-click="save(tab, $event)" show-if-fullscreen="false" aria-label="save"><i class="mdi mdi-content-save"></i><md-tooltip>{{\'Сохранить\' | translate}}</md-tooltip></md-button><md-menu md-position-mode="target-right target" ng-if="vars.sqlHistory.length" show-if-fullscreen="false"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-history"></i></md-button><md-menu-content width="4"><md-menu-item ng-repeat="item in vars.sqlHistory track by $index" ng-click="load(item)"><md-button>{{item.name}}<md-tooltip>{{\'История зарпросов\' | translate}}</md-tooltip><div class="pull-right"><i class="mdi mdi-close ml+" ng-click="removeHistory(item, $event)"></i></div></md-button></md-menu-item></md-menu-content></md-menu><md-button class="md-icon-button" ng-click="toggleSidenav(\'log\')" show-if-fullscreen="false" aria-label="log"><i class="mdi mdi-view-headline"></i><md-tooltip>{{\'Лог запросов\' | translate}}</md-tooltip></md-button><md-input-container><md-select ng-model="vars.db" placeholder="Select database"><md-optgroup label="Database"><md-option ng-value="dbb" ng-repeat="dbb in vars.databasesList track by $index" ng-click="selectDatabase(dbb)">USE {{dbb}}</md-option></md-optgroup></md-select></md-input-container><div ng-if="tab.loading" style="display: table; width: 100%;"><md-progress-linear md-mode="indeterminate">{{tab.progress.query}}</md-progress-linear><i style="font-size: 70%">..... {{tab.progress.query}}</i></div></div></div><md-tabs md-dynamic-height="" md-border-bottom="" ng-if="tab.results.length" md-selected="tab.selectedResultTab"><span ng-include="\'app/sql/renderResult.html\'"></span></md-tabs></md-tab-body></md-tab><md-tab ng-click="addTab()"><md-tab-label><i class="mdi mdi-plus-circle"></i></md-tab-label></md-tab></md-tabs></div><md-sidenav class="md-sidenav-right md-whiteframe-4dp" md-component-id="right"><div class="p+"><h4 class="mt0 mb+++">{{\'Настройки редактора\' | translate}}</h4><md-input-container class="width-100"><label for="inp1">{{\'Размер шрифта\' | translate}}</label> <input type="text" id="inp1" ng-model="vars.fontSize"></md-input-container><md-input-container class="width-100"><label for="inp2">{{\'Максимум строк\' | translate}}</label> <input type="text" id="inp2" ng-model="vars.limitRows"></md-input-container><md-input-container class="width-100 mt mb++"><label>{{\'Формат результатов\' | translate}}</label><md-select ng-model="vars.format"><md-option ng-repeat="format in vars.formats" ng-value="format" ng-click="vars.format = format">{{format.name}}</md-option></md-select></md-input-container><md-input-container class="width-100 mb++"><label>{{\'Тема редактора\' | translate}}</label><md-select ng-model="vars.theme"><md-option ng-repeat="theme in vars.themes" ng-value="theme" ng-click="setTheme(theme)">{{theme}}</md-option></md-select></md-input-container><md-input-container class="width-100 mt mb+"><label>{{\'Тема интерфейса\' | translate}}</label><md-select ng-model="vars.uiTheme"><md-option ng-repeat="theme in vars.uiThemes" ng-value="theme" ng-click="setUiTheme(theme)">{{theme.title}}</md-option></md-select></md-input-container><md-input-container class="width-100 mt"><md-checkbox ng-model="vars.saveTabs" aria-label="saveTabs">{{\'Сохранять сессию\' | translate}}</md-checkbox></md-input-container><md-input-container class="width-100 mt"><md-checkbox ng-model="vars.enableLiveAutocompletion" aria-label="LiveAutocompletion">Live Autocompletion</md-checkbox></md-input-container><md-input-container class="width-100 mt"><md-checkbox ng-click="setDisableAutoHelp()" ng-model="vars.disableAutohelp" aria-label="LiveAutocompletion">Disable auto-help</md-checkbox></md-input-container><md-input-container class="width-100 mt mb+"><label>{{\'Разделитель запросов\' | translate }}</label><md-select ng-model="vars.delimiter"><md-option ng-repeat="delimiter in vars.delimiters" ng-value="delimiter.delimiter" ng-click="vars.delimiter = delimiter">{{delimiter.name}}</md-option></md-select></md-input-container><md-button ng-click="toggleSidenav(\'right\')" class="md-primary ml0 mt+++" style="line-height: inherit;">{{\'Закрыть\' | translate}}</md-button></div></md-sidenav><md-sidenav class="md-sidenav-right md-whiteframe-4dp" md-component-id="log"><div class="p+"><h4 class="mt0"><md-button class="md-icon-button pull-right" ng-click="toggleSidenav(\'log\')" aria-label="close" style="margin-top: -10px; margin-right: -10px"><i class="mdi mdi-close"></i><md-tooltip>{{\'Сохранить\' | translate}}</md-tooltip></md-button>{{\'Лог запросов\' | translate}}</h4></div><div><md-input-container><label>{{\'Искать на сервере\' | translate}}</label> <input ng-model="vars.searchQueryOnServer"></md-input-container><md-button md-no-ink="" class="md-primary" ng-click="searchSqlLogServer()">Search</md-button></div><div><hr><div ng-repeat="sql in vars.sqlLogServer" md-ink-ripple="" style="position: relative; cursor: pointer; border-bottom: 1px rgba(120, 120, 120, 0.2) solid;" class="p pl+" ng-click="setSql(sql)"><pre class="p0 m0" style="max-height: 88px; line-height: 16px; overflow: hidden; text-overflow: ellipsis">{{::sql}}</pre></div></div><div ng-repeat="sql in vars.sqlLog" md-ink-ripple="" style="position: relative; cursor: pointer; border-bottom: 1px rgba(120, 120, 120, 0.2) solid;" class="p pl+" ng-click="setSql(sql)"><pre class="p0 m0" style="max-height: 48px; line-height: 16px; overflow: hidden; text-overflow: ellipsis">{{::sql}}</pre></div><small class="p+" ng-if="vars.sqlLog.length === 0">{{\'История запросов пуста\' | translate}}</small></md-sidenav>');
}]),function(e,t){function a(e,t){var a=t.dbName,i=t.tableName;e.vars={dbName:a,tableName:i}}e.module(t.app.name).controller("TableController",a),a.$inject=["$scope","$stateParams"]}(angular,smi2),function(e,t){function a(e,t,a,i,r,n,o,s){e.vars={columns:{},ugrid:{},sortColumn:!1,isDark:i.isDark(),createtable:{},data:null,grid:null,limit:100,offset:0,statistics:{},loading:!0,isRawStatistics:!1,rawstatistics:"",scrollConfig:{autoHideScrollbar:!1,theme:i.isDark()?"light":"dark",scrollButtons:{enable:!1},scrollInertia:100,advanced:{updateOnContentResize:!0}}},e.initContainer=function(){t.$watch("currentTable",function(a){a&&(e.vars.currentTable=t.currentTable,e.vars.currentDatabase=t.currentDatabase,e.init())})},e.onAfterInit=function(){},e.updateHandTable=function(){s.getInstance("hotTableContain").render()},e.initOnGo=function(){e.$parent.vars&&(o.get("tableSiedenav")&&n("tableSiedenav").close(),e.vars.currentTable=e.$parent.vars.tableName,e.vars.currentDatabase=e.$parent.vars.dbName,e.init())},e.initTableSettings=function(){e.table={colHeaders:{},data:{},settings:{manualColumnMove:!0,manualColumnResize:!0,autoWrapRow:!1,wordWrap:!1,colWidths:70,stretchH:"all",preventOverflow:"horizontal",persistentState:!0,columnSorting:!0,sortIndicator:!0,manualRowResize:!0,viewportColumnRenderingOffset:"auto",autoColumnSize:{samplingRatio:23}}}},e.load=function(){console.log(e.vars.columns),e.vars.data=-1,a.query("\n            select * from "+e.vars.currentDatabase+"."+e.vars.currentTable+" limit "+e.vars.offset+", "+e.vars.limit+"\n                ").then(function(t){var i=a.dataToHandsontable(t);e.table.colHeaders=i.colHeaders,e.table.settings.columns=i.columns,e.table.settings.manualColumnResize=i.columns,e.table.data=i.data,e.table.settings.width="99.9"+Math.floor(100*Math.random())+"%",e.table.settings.height="99.9"+Math.floor(100*Math.random())+"%",console.info(e.table),e.updateHandTable(),e.vars.loading=!1},function(t){e.vars.loading=!1,console.error("Ошибка "+t)})},e.calcRawSize=function(){console.log("RAcalcRawSizeW"),e.vars.isRawStatistics=!0,a.query("SELECT any(ignore(*)) FROM "+e.vars.currentDatabase+"."+e.vars.currentTable+" SAMPLE 1 / 10000 ").then(function(t){e.vars.rawstatistics=t.statistics,console.log("RAcalcRawSizeWresult",t)},function(t){e.vars.rawstatistics=t.data})},e.init=function(){e.vars.loading=!0,e.initTableSettings(),e.vars.createtable="N/A",a.query("SHOW CREATE TABLE "+e.vars.currentDatabase+"."+e.vars.currentTable).then(function(t){e.vars.createtable=window.sqlFormatter.format(t.data[0].statement)}),a.query("SELECT 	table, 	formatReadableSize(sum(bytes)) as size, 	sum(bytes) as sizeBytes, 	min(min_date) as minDate, 	max(max_date) as maxDate FROM  	system.parts WHERE 	database = '"+e.vars.currentDatabase+"' AND 	( 		table = '"+e.vars.currentTable+"' OR 		table = '"+e.vars.currentTable+"_sharded'    ) GROUP BY     table ").then(function(t){return e.vars.statistics=t&&t.data.length&&t.data[0]||{}}),a.query("SELECT * FROM system.columns WHERE database='"+e.vars.currentDatabase+"' AND table='"+e.vars.currentTable+"'").then(function(t){a.query("describe table "+e.vars.currentDatabase+"."+e.vars.currentTable).then(function(a){_.map(a.data,function(e){var a=_.find(t.data,{name:e.name});return _.merge(e,a),e.size="-",e.ratio="-",console.log(e),e.data_compressed_bytes&&(e.size=numbro(e.data_compressed_bytes).format("0.0 b")+" / "+numbro(e.data_uncompressed_bytes).format("0.0 b"),e.ratio=numbro(parseInt(e.data_uncompressed_bytes)/parseInt(e.data_compressed_bytes)).format("0.0")),e}),e.vars.columns=a,e.vars.sortColumn=!1;var i=0;a.data.forEach(function(t){3>i&&("Date"==t.type&&(e.vars.sortColumn=t.name),"DateTime"==t.type&&(e.vars.sortColumn=t.name)),i+=1}),e.load()})})},e.loadNext=function(){e.vars.offset+=e.vars.limit,e.load()},e.loadPrev=function(){e.vars.offset>0&&(e.vars.offset-=e.vars.limit,e.load())}}e.module(t.app.name).controller("TableContainerController",a),a.$inject=["$scope","$rootScope","API","ThemeService","$stateParams","$mdSidenav","$mdComponentRegistry","hotRegisterer"]}(angular,smi2),/*
 * Copyright (C) 2017  SMI2
 * All rights reserved.
 */
window.global_keywords_fields="",window.global_keywords_tables="",window.global_keywords_fieldsList="",window.global_keywords_dictList="",window.global_builtinFunctions=[],window.global_delimiter=";;",window.global_lang="ru",function(e,t){function a(t,a,i,r,n,o,s,l,d,c,m,u,h){var p="sqlHistory2",b="sqlLog",g="saveTabs",f="DISABLE_AUTOHELP",v="liveAutocompletion",y="sessionData",w=30;t.vars={sqlHistory:r.get(p)||[],dictionaries:[],isDictionariesLoad:!1,tabs:[],enableLiveAutocompletion:r.get(v)||!1,disableAutohelp:r.get(f)||!1,saveTabs:r.get(g)||!1,uiTheme:d.themeObject,uiThemes:d.list,delimiters:[{name:m("translate")(";; Двойной"),delimiter:";;"},{name:m("translate")("; Одинарный"),delimiter:";"}],databasesList:[],searchQueryOnServer:"",currentTab:{},selectedTab:0,sqlLog:r.get(b)||[],sqlLogServer:[],formats:[{name:m("translate")("Таблица"),sql:" format JSON",render:"html"},{name:"JSON compact",sql:" format JSONCompact"}],db:null,limitRows:r.get("editorLimitRows")||500,fontSize:r.get("editorFontSize")||16,theme:r.get("editorTheme")||"cobalt"},t.vars.delimiter=r.get("delimiter")||";;",t.vars.format=t.vars.formats[0],t.vars.themes=["ambiance","eclipse","mono_industrial","tomorrow_night_blue","chaos","github","monokai","tomorrow_night_bright","chrome","idle_fingers","pastel_on_dark","tomorrow_night_eighties","clouds","iplastic","solarized_dark","tomorrow_night","clouds_midnight","katzenmilch","solarized_light","twilight","cobalt","kr_theme","sqlserver","vibrant_ink","crimson_editor","kuroir","terminal","xcode","dawn","merbivore","textmate","dreamweaver","merbivore_soft","tomorrow"],a.breadcrumbs=[{text:"SQL",link:"sql"}],i.onbeforeunload=function(e){if(""!==t.vars.currentTab.sql&&"localhost"!=location.hostname){var a=m("translate")("Хотите покинуть страницу?");return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}};var x=t.$on("$stateChangeStart",function(e){var a=m("translate")("Хотите покинуть страницу?");e.defaultPrevented||""===t.vars.currentTab||confirm(a)||e.preventDefault()}),C=function(){if(t.vars.saveTabs){var e=t.vars.tabs.map(function(e){return{name:e.name,sql:e.sql,buttonTitle:e.buttonTitle,format:e.format,delimiter:e.delimiter,results:[],editor:null,selectedResultTab:0}});r.set(y,e)}};t.executeQuery=function(a,i,r){var o="";t.vars.currentTab.loading=!0,t.vars.limitRows&&(o+="max_result_rows="+t.vars.limitRows+"&result_overflow_mode=throw");var s=a.sql.replace(/(\r\n|\n|\r)$/gm,"").substr(0,130);t.vars.currentTab.progress.query=s;var c="";a.qid&&(c=" /*TABIX_QUERY_ID_"+a.qid+"_()*/"),n.query(a.sql+c,a.format,!0,o).then(function(n){var o=n;e.isObject(n)||(n={data:o,meta:null,rows:null,statistics:null}),n.error=!1,n.query=a,n.countAllQuery=i.length;var l={time:moment().format("HH:mm:ss")};e.isObject(n.statistics)&&Object.assign(l,n.statistics),l.query=s,t.vars.currentTab.statistics.push(l);var d="ch",c=new DataProvider(n,d);r.widgets.tables.push(new WidgetTable(c)),r.widgets.pivot.push(new WidgetPivot(c)),"drawCommand"in a&&a.drawCommand.length?(c.countAll=a.drawCommand.length,a.drawCommand.forEach(function(e){r.widgets.draw.push(new WidgetDraw(c,e))})):r.widgets.draw.push(new WidgetDraw(c,!1)),r.data.push(a),a.index+1<i.length?t.executeQuery(i[a.index+1],i,r):t.finalizeResult(r)},function(i){l.show(l.simple().content(m("translate")("Ошибка")).theme(d.theme).position("bottom right"));var n={meta:null,rows:null,query:a,statistics:null};i&&i.data?n.error=e.toJson(i.data).replace(/\\n/gi,"<br/>").replace(/^"/,"").replace(/"$/,""):n.error=i;var o="ch",s=new DataProvider(n,o);r.data.push(a),r.widgets.tables.push(new WidgetTable(s)),t.finalizeResult(r)})},t.renderResult=function(t){return t.echarts=!1,t.pivot=!1,t.charts=!1,t.selectedTabIndex=0,"string"==typeof t.error?t.result='<pre class="fs-caption tc-red-700">'+t.error+"</pre>":e.isObject(t.data)?(t.result=n.dataToHtml(t),t.createtable=n.dataToCreateTable(t),t.pivot=!0,t.charts=!0):e.isString(t.data)?t.result='<pre class="fs-caption">'+t.data+"</pre>":t.result='<pre class="fs-caption">'+e.toJson(t.data,!0)+"</pre>",t},t.finalizeResult=function(e){if(t.vars.currentTab.loading=!1,t.vars.currentTab.progress=!1,e.data.find(function(e){return e.keyword&&-1!=["DROP","CREATE","ALTER"].indexOf(e.keyword.toUpperCase())})&&(t.selectDatabase(t.vars.db),a.$emit("handleBroadcastDatabases",{})),t.vars.currentTab.statistics[0]){var i=DataProvider.convertArrayToDataProvider(t.vars.currentTab.statistics,"statistics");i.sort="time",i.sortOrder="desc",e.widgets.tables.push(new WidgetTable(i,!1))}},t.execute=function(a,i){console.groupCollapsed("Execute query");var o=""===i.sql?i.editor.getValue():i.sql,s=0,c=i.editor,u=[],h=c.getSelectedText();e.isUndefined(i.selectedTabResultIndex)&&(i.selectedTabResultIndex=0);var p={data:[],time:m("date")(new Date,"HH:mm:ss"),pinned:!1,widgets:{tables:[],pivot:[],draw:[]}};if(""!==h&&null!==h&&(o=h),console.info("[EDITOR TEXT]> ",o),""===o||null===o)return void l.show(l.simple().content(m("translate")("Не введен SQL")).theme(d.theme).position("bottom right"));console.info("MEMORY, used:"+numbro(window.performance.memory.usedJSHeapSize).format("0.000 b"),"total:"+numbro(window.performance.memory.totalJSHeapSize).format("0.000 b")),console.info("Cache:",$.cache),i.results=i.results.reduce(function(e,t){return t.pinned&&e.push(t),e},[]),i.results.unshift(p),-1==t.vars.sqlLog.indexOf(o)&&(t.vars.sqlLog.unshift(o),t.vars.sqlLog.length>w&&t.vars.sqlLog.splice(0,w),r.set(b,t.vars.sqlLog)),C();var g=window.global_delimiter;g||(g=";;"),c.session.$mode.splitByTokens(o,"constant.character.escape",g).forEach(function(t){if(!("current"==a&&s>0)){var i=[],r=t.sql;if(!(r.length<5)){if("current"==a&&!h){var o=c.selection.getCursor();if(console.log("Exec current position :",o),console.log("Item range :",t.range),!o||e.isUndefined(o))return;var l=t.range.compare(o.row,o.column);if(console.log("Range compare = ",l),0!==l)return}if(c.session.$mode.findTokens(r,"invalid.illegal",!0)){var d=c.session.$mode.splitByTokens(r,"invalid.illegal",!0);r=d[0].sql,d.forEach(function(t){if(e.isDefined(t.keyword)&&t.keyword){var a=/DRAW_(\w+)/gim,r=a.exec(t.keyword);r&&r[1]&&i.push({drawtype:r[1].toLowerCase(),code:t.sql})}})}console.info("[SQL]>",r),i&&console.info("[DRAW]>",i);var m=null,p=!1,b=!1,g=null,f=c.session.$mode.findTokens(r,"storage",!0),v=c.session.$mode.findTokens(r,"keyword",!0);f.hasOwnProperty("value")?(m=!1,b=f.value):(m=" FORMAT JSON ",p=!0),v.hasOwnProperty("value")&&(g=v.value),"select"!==g&&(m=!1,p=!1),u.push({sql:r,index:s,format:m,setedformat:p,keyword:g,storage:b,drawCommand:i,qid:n.makeQueryId()}),s++}}}),console.groupEnd(),u.length&&(t.vars.currentTab.progress={},t.vars.currentTab.statistics||(t.vars.currentTab.statistics=[]),t.executeQuery(u[0],u,p))},t.setTheme=function(e){t.vars.theme=e,t.vars.tabs.forEach(function(t){return t.editor.setTheme("ace/theme/"+e)}),r.set("editorTheme",e)},t.selectDatabase=function(e){if(e){t.vars.db=e;var a={};n.setDatabase(e),n.query("SELECT database,table,name,type,default_type,default_expression FROM system.columns",null).then(function(i){t.vars.databasesList=[];var r=[],n={},o=[],s={},l={},d=[];window.global_keywords_fieldsList=[],i.meta.forEach(function(e){d.push(e.name)}),i.data.forEach(function(i){s[i.database+"."+i.table]=1,_.isString(a[i.database])||(t.vars.databasesList.push(i.database),a[i.database]="y"),i.database==e&&(window.global_keywords_fieldsList.push(i),d.forEach(function(e){"table"==e&&(l.hasOwnProperty(i[e])||(l[i[e]]=1,o.push(i[e]))),"name"==e&&(n.hasOwnProperty(i[e])||(n[i[e]]=1,r.push(i[e])))}))}),window.global_keywords_fields=r.join("|")+"|",window.global_keywords_tables=e,Object.keys(s).forEach(function(e){window.global_keywords_tables+="|"+e}),t.vars.tabs.forEach(function(e){e.editor&&(e.editor.session.setMode({path:"ace/mode/clickhouse",v:Date.now()}),e.editor.session.bgTokenizer.start(0))})})}},t.addDictionariesWord=function(e){var a=t.vars.currentTab.editor,i=a.getCursorPosition();i.column+=e.length,a.clearSelection(),a.insert(e),t.vars.currentTab.sql=a.getValue(),c(function(){a.focus(),a.moveCursorToPosition(i)})},t.loadDictionaries=function(){t.vars.isDictionariesLoad||(console.log("loadDictionaries"),window.global_lang=h.use(),t.vars.dictionaries=[],window.global_keywords_dictList=[],n.query("select name,key,attribute.names,attribute.types from system.dictionaries ARRAY JOIN attribute ORDER BY name,attribute.names",null).then(function(e){e.data.forEach(function(e){var a=e.name;a=a.replace(/^.*\./gm,""),"news"!=a&&(a=a.replace(/s$/gm,"")),a=a?a.toLowerCase()+"_id":"ID";var i="dictGet"+e["attribute.types"]+"('"+e.name+"','"+e["attribute.names"]+"',to"+e.key+"( "+a+" ) ) AS "+e["attribute.names"]+",";window.global_keywords_dictList.push({dic:i,title:"dic_"+e.name+"."+e["attribute.names"]}),t.vars.dictionaries.push({dic:i,title:e.name+"."+e["attribute.names"]+" as "+e["attribute.types"]})})}),t.vars.isDictionariesLoad=!0)};for(var S=function(e){t.vars.tabs.length>=e&&(t.vars.currentTab=t.vars.tabs[e],t.vars.selectedTab=e,c(function(){t.vars.currentTab.editor.focus()}))},k=function(){t.vars.selectedTab>0&&S(t.vars.selectedTab-1)},T=function(){t.vars.selectedTab<t.vars.tabs.length-1&&S(t.vars.selectedTab+1)},D=function(){e.isObject(window.sqlFormatter)&&c(function(){t.vars.currentTab.editor.setValue(window.sqlFormatter.format(t.vars.currentTab.sql))})},E=function(e){u.add({combo:"ctrl+shift+"+(e+1),callback:function(){return S(e)}})},A=0;9>A;A++)E(A);u.add({combo:"ctrl+right",callback:T}),u.add({combo:"ctrl+left",callback:k}),u.add({combo:"ctrl+shift+f",callback:D}),t.aceLoaded=function(e){var a=t.vars.tabs.find(function(e){return!e.editor})||t.vars.currentTab;a.editor=e,e.$blockScrolling=1/0,e.setOptions({fontSize:t.vars.fontSize+"px",enableBasicAutocompletion:!0,behavioursEnabled:!0,wrapBehavioursEnabled:!0,highlightSelectedWord:!0,showGutter:!0,enableLiveAutocompletion:t.vars.enableLiveAutocompletion,liveAutocompletionDelay:500,liveAutocompletionThreshold:1}),e.setTheme("ace/theme/"+t.vars.theme),e.session.setMode({path:"ace/mode/clickhouse",v:Date.now()}),e.session.bgTokenizer.start(0),e.commands.addCommand({name:"runCurrentCommand",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function(){t.execute("current",a)}}),e.commands.addCommand({name:"removeLiness",bindKey:{win:"Ctrl-Y",mac:"Cmd-Y"},exec:function(e){e.removeLines()}}),e.commands.addCommand({name:"collapseAll",bindKey:{win:"Ctrl-Shift--",mac:"Command+Shift+-"},exec:function(e){e.session.$mode.collapseAll(e.session)}}),e.commands.addCommand({name:"unfold",bindKey:{win:"Ctrl-Shift-+",mac:"Command+Shift+="},exec:function(e){e.session.unfold()}}),e.commands.addCommand({name:"runAllCommand",bindKey:{win:"Shift-Ctrl-Enter",mac:"Shift-Command-Enter"},exec:function(){t.execute("all",a)}});for(var i=function(t){e.commands.addCommand({name:"selecttab"+t,bindKey:{win:"Ctrl-Shift-"+(t+1),mac:"Command-Shift-"+(t+1)},exec:function(){return S(t)}})},r=0;9>r;r++)i(r);e.commands.addCommand({name:"selectnexttab",bindKey:{win:"Ctrl-Right",mac:"Command-Right"},exec:T}),e.commands.addCommand({name:"selectprevtab",bindKey:{win:"Ctrl-Left",mac:"Command-Left"},exec:k}),e.commands.addCommand({name:"formatcode",bindKey:{win:"Ctrl-Shift-F",mac:"Command-Shift-F"},exec:D}),e.clearSelection(),e.focus(),e.selection.moveTo(0,0),e.on("changeSelection",function(){c(function(){a.buttonTitle=""!==e.getSelectedText()?m("translate")("Выполнить выделенное ⌘ + ⏎"):m("translate")("Выполнить все ⇧ + ⌘ + ⏎"),a.originalSql&&(a.changed=a.originalSql!=a.sql)})}),t.loadDictionaries()},a.$watch("currentDatabase",t.selectDatabase),t.$watch("vars.limitRows",function(e){return r.set("editorLimitRows",e)}),t.$watch("vars.delimiter",function(e){e.name&&e.delimiter&&(e=e.delimiter),r.set("delimiter",e),window.global_delimiter=e,t.vars.tabs.forEach(function(e){e.editor&&(e.editor.session.setMode({path:"ace/mode/clickhouse",v:Date.now()}),e.editor.session.bgTokenizer.start(0))})}),t.$watch("vars.fontSize",function(e){e&&(t.vars.tabs.forEach(function(t){return t.editor&&t.editor.setOptions({fontSize:e+"px"})}),r.set("editorFontSize",e))}),t.save=function(e,a){return s.show(s.prompt().title(m("translate")("Сохранить SQL как")).placeholder(m("translate")("название")).initialValue(e.name).targetEvent(a).ok(m("translate")("Сохранить")).cancel(m("translate")("Отмена"))).then(function(a){var i=t.vars.sqlHistory.findIndex(function(t){return t.name==e.name});-1!=i?(t.vars.sqlHistory[i].sql=e.sql,t.vars.sqlHistory[i].name=a):t.vars.sqlHistory.push({sql:e.sql,name:a}),e.originalSql=e.sql,e.name=a,r.set(p,t.vars.sqlHistory),C()})},t.load=function(e){t.vars.currentTab.sql=e.sql,t.vars.currentTab.originalSql=e.sql,t.vars.currentTab.name=e.name},t.getExportData=function(t){return t.map(function(t){return Object.keys(t).map(function(a){return e.isArray(t[a])?t[a].join(", "):t[a]})})},t.getExportHeaders=function(e){return e.map(function(e){return e.name})},t.addTab=function(){t.vars.currentTab={name:"new SQL",sql:"",buttonTitle:m("translate")("Выполнить ⌘ + ⏎"),format:{},editor:null,results:[],selectedResultTab:0},t.vars.tabs.push(t.vars.currentTab),C()},t.removeTab=function(e,a){a.stopPropagation();var i=function(){t.vars.tabs.splice(t.vars.tabs.indexOf(e),1),t.vars.tabs.length==t.vars.selectedTab&&t.vars.selectedTab--};e.changed?s.show(s.confirm().title(m("translate")("SQL изменен. Сохранить перед закрытием?")).targetEvent(a).ok(m("translate")("Да")).cancel(m("translate")("Нет"))).then(function(){var a=t.vars.sqlHistory.findIndex(function(t){return t.name==e.name});-1!=a&&(t.vars.sqlHistory[a].sql=e.sql,t.vars.sqlHistory[a].name=e.name),r.set(p,t.vars.sqlHistory),i()},i):i()},t.removeResult=function(e,t,a){a.stopPropagation(),e.results.splice(e.results.indexOf(t),1)},a.$on("handleBroadcastInsertInActive",function(e,a){a.value&&t.addDictionariesWord(a.value)}),t.toggleSidenav=function(e){o(e).toggle()},t.removeHistory=function(e,a){a.preventDefault();var i=t.vars.sqlHistory.indexOf(e);-1!=i&&s.show(s.confirm().title("Удалить "+e.name+"?").targetEvent(a).ok("Да").cancel("Нет")).then(function(){t.vars.sqlHistory.splice(i,1),r.set(p,t.vars.sqlHistory)})},t.$watch("vars.saveTabs",function(e,t){r.set(g,e),t===!1&&e===!0&&C()}),t.searchSqlLogServer=function(){t.vars.sqlLogServer=[];var e=t.vars.searchQueryOnServer,a="\n            SELECT query FROM ( SELECT query FROM system.query_log \nWHERE query like '%TABIX_QUERY%' AND query not like '%system.query_log%' and exception=''  AND query LIKE '%"+e+"%'\nORDER BY event_time desc  ) GROUP BY query";e&&(console.info("Search on server query like : "+a),n.query(a).then(function(e){t.vars.sqlLogServer=_.map(e.data,"query")}))},t.setDisableAutoHelp=function(){var e=t.vars.disableAutohelp;r.set(f,e),console.info("SET>window.global_chFunctionsHelp = {};",e),e&&(window.global_chFunctionsHelp={})},t.$watch("vars.enableLiveAutocompletion",function(e){r.set(v,e),t.vars.tabs.forEach(function(t){return t.editor&&t.editor.setOptions({enableLiveAutocompletion:e})})}),t.setUiTheme=function(e){return d.set(e.name)},t.setSql=function(e){t.vars.currentTab.sql=e,t.toggleSidenav("log"),c(function(){return t.vars.currentTab.editor.focus()},500)},t.changeTabName=function(e,a){a.stopPropagation(),s.show(s.prompt().title(m("translate")("Название вкладки")).placeholder(m("translate")("название")).initialValue(e.name).targetEvent(a).ok(m("translate")("Применить")).cancel(m("translate")("Отмена"))).then(function(a){var i=t.vars.sqlHistory.findIndex(function(t){return t.name==e.name});-1!=i&&(e.originalSql=e.sql,t.vars.sqlHistory[i].name=a,r.set(p,t.vars.sqlHistory)),e.name=a,C()})},t.vars.saveTabs?(t.vars.tabs=r.get(y),t.vars.tabs.length>0?c(function(){return t.vars.currentTab=t.vars.tabs[0]},500):t.addTab()):(r.set(y,[]),t.addTab()),a.currentDatabase&&t.selectDatabase(a.currentDatabase),n.query("select name,is_aggregate from system.functions",null).then(function(e){e.data.forEach(function(e){if(window.global_builtinFunctions.push({name:e.name,isaggr:e.is_aggregate,score:101,comb:!1,origin:e.name}),e.is_aggregate){var t={name:e.name+"If",isaggr:e.is_aggregate,score:3,comb:"If",origin:e.name};window.global_builtinFunctions.push(t),t={name:e.name+"Array",isaggr:e.is_aggregate,score:2,comb:"Array",origin:e.name},window.global_builtinFunctions.push(t),t={name:e.name+"State",isaggr:e.is_aggregate,score:1,comb:"State",origin:e.name},window.global_builtinFunctions.push(t)}})}),t.$on("$destroy",function(){n.setDatabase(a.currentDatabase),x(),i.onbeforeunload=null}),t.rightAceMenuList=[{active:!0,value:"AutoFormat",icon:"format-size"},{active:!0,value:"Expand",icon:"arrow-expand"},{active:!0,value:"Collapse",icon:"arrow-compress"},{active:!0,value:"Collapse All",icon:"arrow-compress"}],t.rightMenuProcess=function(e){var a=t.vars.currentTab.editor.session;t.vars.currentTab.editor.resize(),"AutoFormat"==e.value?D():"Expand"==e.value?a.unfold():"Collapse All"==e.value?a.$mode.collapseAll(a):"Collapse"==e.value&&a.foldAll(),t.vars.currentTab.editor.focus()}}e.module(t.app.name).controller("SqlController",a),a.$inject=["$scope","$rootScope","$window","localStorageService","API","$mdSidenav","$mdDialog","$mdToast","ThemeService","$timeout","$filter","hotkeys","$translate"]}(angular,smi2),/*
 * Copyright (C) 2017 IgorStrykhar in SMI2
 * All rights reserved.
 */
function(e,t,a){function i(e,t,a,i,r,n,o,s,l,d){e.tabsRender=!0,e.vars={rsw:0,uiTheme:l.themeObject,isChartReady:!1,staticGrid:!0,stackType:"false",isDark:l.isDark(),active:{table:!1,pivot:!1,draw:!1}},e.gridsterOpts={columns:6,pushing:!0,floating:!0,swapping:!0,width:"auto",colWidth:"auto",rowHeight:"match",margins:[4,4],outerMargin:!0,sparse:!1,isMobile:!1,mobileBreakPoint:600,mobileModeEnabled:!0,minColumns:1,minRows:0,maxRows:100,defaultSizeX:1,defaultSizeY:1,minSizeX:0,maxSizeX:null,minSizeY:0,maxSizeY:null,resizable:{enabled:!e.vars.staticGrid,handles:["n","e","s","w","ne","se","sw","nw"],start:function(e,t,a){},resize:function(e,t,a){a.scheduledResize()},stop:function(e,t,a){d(function(){a.scheduledResize()},400)}},draggable:{enabled:!e.vars.staticGrid,handle:".widget-draggable",start:function(e,t,a){},drag:function(e,t,a){},stop:function(e,t,a){}}},e.switchStaticGrid=function(){e.vars.staticGrid=!e.vars.staticGrid,e.gridsterOpts.draggable.enabled=!e.vars.staticGrid,e.gridsterOpts.resizable.enabled=!e.vars.staticGrid},e.initNoTabs=function(){console.info("initNoTabs"),e.vars.active.table=!0,e.vars.active.draw=!0,e.vars.active.pivot=!0},e.initTableTab=function(){console.info("initTableTab"),e.vars.active.table=!0},e.initDrawTab=function(){console.info("initDrawTab"),e.vars.active.draw=!0},e.initPivotTab=function(){console.info("initPivotTab"),e.vars.active.pivot=!0}}e.module(t.app.name).controller("RenderCtrl",i),i.$inject=["$scope","$rootScope","$window","localStorageService","API","$mdSidenav","$mdDialog","$mdToast","ThemeService","$timeout"]}(angular,smi2,window.$),function(e,t){function a(t,a){var i=t.get("themeName")||"dark",r=[{isDark:!1,name:"default",title:a("translate")("Светлая тема")},{isDark:!0,name:"dark",title:a("translate")("Темная тема")}],n=r.find(function(e){return e.name==i})||r[0];return n.isDark&&e.element("body").addClass("dark"),{isDark:function(){return n.isDark},theme:n.name,themeObject:n,set:function(e){e!=i&&(t.set("themeName",e),location.href=location.href)},list:r}}e.module(t.app.name).service("ThemeService",a),a.$inject=["localStorageService","$filter"]}(angular,smi2),function(e,t){function a(e,t){return{responseError:function(a){return 401==a.status&&t.get("$state").go("login"),e.reject(a)}}}e.module(t.app.name).service("HttpInterceptor",a),a.$inject=["$q","$injector"]}(angular,smi2),function(e,t){function a(t,a,i,r,n){var o=this,s="currentBaseConfig",l=8123,d=null,c={},m=i.get(s);m&&m.host&&(c=m),this.setConnection=function(t){i.set(s,t),c=e.copy(t),/.*\:\d+$/.test(c.host)||(c.host+=":"+l)},this.clear=function(){d=null,c={},i.set(s,{})},this.makeQueryId=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;15>a;a++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},this.isTabixServer=function(){return c.tabix&&c.tabix.server?!0:!1},this.tabixQuery=function(e){return console.info("[request]>",e),t(req).then(function(e){return defer.resolve(e.data)},function(e){return defer.reject(e)}),defer.promise},this._tabixRequest=function(t,a){var i={version:1,auth:{login:c.tabix.login,password:c.tabix.password,confid:c.tabix.confid}};t=Object.assign(i,t);var r=c.tabix.server+"/"+a;return{method:"POST",data:t,url:r,transformResponse:function(t,a,i){try{return e.fromJson(t)}catch(r){return t?t:"\nStatus:"+i+"\nHeaders:"+e.toJson(a())}}}},this.query=function(i,r,n,s){var l=a.defer(),m="",u="http://localhost/",h=!1;if(r!==!1?(r=r||" FoRmAt JSON","null"==r&&(r=""),m=i+" "+r):m=i,o.isTabixServer())h=o._tabixRequest({query:m},"query");else{var p="";c.host.indexOf("://")>0||0==c.host.indexOf("/")||(p="http://"),u=p+c.host+"/?add_http_cors_header=1&log_queries=1",c.login&&(u+="&user="+c.login),c.password&&(u+="&password="+c.password),n&&(u+="&database="+d),s&&(u+="&"+s),c.params&&(u+="&"+c.params),h={method:"POST",data:m,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:u,transformResponse:function(t,a,i){try{return e.fromJson(t)}catch(r){return t?t:"\nStatus:"+i+"\nHeaders:"+e.toJson(a())}}}}return console.info("SQL>",m),t(h).then(function(e){return l.resolve(e.data)},function(e){return l.reject(e)}),l.promise},this.getConnectionInfo=function(){return c},this.setDatabase=function(e){return d=e},this.getDatabase=function(){return d},this.dataToCreateTable=function(e){var t="\nCREATE TABLE x (\n",a=[];return e.meta.forEach(function(e){return a.push("	"+e.name+" "+e.type)}),t+a.join(",\n")+"\n ) ENGINE = Log \n;;\n"},this.dataToHtml=function(e){var t='<table class="sql-table '+n.theme+'"><tr>',a=[];return e.meta.forEach(function(e){t+="<th>"+r(e.name)+'\n                            <div class="sql-table__subheader">'+r(e.type)+"</div>\n                        </th>",a.push(e.name)}),e.data.forEach(function(e){t+="<tr>",a.forEach(function(a){t+="<td>"+r(e[a])+"</td>"}),t+="</tr>"}),t+="</table>"},this.dataToHandsontable=function(e){var t=[],a=[];return e.meta.forEach(function(e){t.push(e.name);var i={};switch(i.type="text",i.width=100,e.type){case"Date":i.width=90,i.type="date",i.dateFormat="MM/DD/YYYY";break;case"DateTime":i.width=150,i.type="time",i.timeFormat="HH:mm:ss";break;case"Int32":i.width=80,i.type="numeric";break;case"Float64":i.width=80,i.type="numeric",i.format="0,0.0000";break;case"UInt32":i.width=80,i.type="numeric";break;case"String":i.width=180}i.data=e.name,a.push(i)}),{colHeaders:t,columns:a,data:e.data,currentRowClassName:"currentRow",currentColClassName:"currentCol"}}}e.module(t.app.name).service("API",a),a.$inject=["$http","$q","localStorageService","$sanitize","ThemeService"]}(angular,smi2),function(e,t){function a(t,a,i,r,n,o,s){var l="proc.interval",d="proc.key";t.vars={queryesToKill:{},logMode:!0,loading:!1,logData:{},cols:[],isDark:i.isDark(),sort:/^[a-z0-9_]+$/.test(n.get(d))?n.get(d):null,interval:n.get(l)||-1,scrollConfig:{autoHideScrollbar:!1,theme:i.isDark()?"light":"dark",scrollButtons:{enable:!1},scrollInertia:100,advanced:{updateOnContentResize:!0}}},t.updateHandTable=function(){s.getInstance("hotTableProcesses").render()},t.table={wordWrap:!1,data:{},settings:{manualColumnMove:!0,manualColumnResize:!0,autoWrapRow:!0,colWidths:70,dropdownMenu:!0,stretchH:"all",preventOverflow:"horizontal",persistentState:!0,contextMenu:{callback:function(e,t){"kill"===e&&setTimeout(function(){console.warn(t)},100)},items:{kill:{name:"Kill query"}}},columnSorting:!0,sortIndicator:!0,manualRowResize:!0,viewportColumnRenderingOffset:"auto",autoColumnSize:{samplingRatio:23}}};var c=null;t.flush=function(){t.vars.logData={},t.table.data=[]},t.load=function(){var e="SELECT  now() as dt, query,  1 as count,  formatReadableSize(read_bytes) as bytes_read, \n                formatReadableSize(written_bytes) as written_bytes,  formatReadableSize(memory_usage) as memory_usage,\n                read_rows,written_rows, round(elapsed,4) as elapsed ,  * ,   cityHash64(query) as hash,  hostName() FROM system.processes ";t.vars.logMode&&(e+=" /* 12XQWE3X1X2XASDF */ WHERE query not like '%12XQWE3X1X2XASDF%'"),a.query(e).then(function(e){var i=a.dataToHandsontable(e);if(t.table.colHeaders=i.colHeaders,t.table.settings.manualColumnResize=i.columns,t.table.settings.colWidths=i.colWidths,t.vars.logMode){i.data.forEach(function(e){if(t.vars.logData[e.hash]){var a=t.vars.logData[e.hash].count;t.vars.logData[e.hash].query_id!=e.query_id&&(a+=1),e.count=a,t.vars.logData[e.hash]=e}else e.count=1,t.vars.logData[e.hash]=e});var r=$.map(t.vars.logData,function(e,t){return[e]});t.table.data=r}else t.table.data=i.data;t.vars.data=!0,t.vars.loading=!1,t.updateHandTable()},function(e){t.vars.loading=!1,console.error("Ошибка "+e)})},t.setInterval=function(){n.set(l,t.vars.interval),c&&(r.cancel(c),c=null),t.vars.interval>-1&&(c=r(t.load,1e3*t.vars.interval))},t.$on("$destroy",function(){t.vars.interval=-1,r.cancel(c),t.setInterval()}),t.load(),t.vars.interval>-1&&t.setInterval(),t.dialogKill=function(i){var r="SELECT now() as dt,query,1 as count,\n                \n                formatReadableSize(read_bytes) as read_bytes, \n                formatReadableSize(written_bytes) as written_bytes, \n                formatReadableSize(memory_usage) as memory_usage,\n                read_rows,written_rows,\n                \n                query_id as hash,\n                round(elapsed,4) as elapsed \n            FROM system.processes /* 12XQWE3X1X2XASDF */ WHERE query not like '%12XQWE3X1X2XASDF%' ORDER BY elapsed DESC";a.query(r).then(function(r){o.show({controller:["$scope",function(e){e.queryesToKill=r.data,e.kill=function(e){var t="KILL QUERY WHERE query_id='"+e.hash+"' SYNC",r=o.confirm().title(t+" ?").textContent(e.query).ariaLabel("Lucky day").targetEvent(i).ok("Please do it!").cancel("Sounds like a scam");o.show(r).then(function(){a.query(t,!1).then(function(e){o.show(o.alert().clickOutsideToClose(!0).title("Result: "+t).textContent(e).ariaLabel("Alert").ok("Ok!").targetEvent(i))},function(e){o.show(o.alert().clickOutsideToClose(!0).title("Error: "+t).textContent(e.data).ariaLabel("Error on Kill").ok("Ok!").targetEvent(i))})},function(){})},e.cancel=function(){o.cancel()}}],templateUrl:"app/metrics/dialog.kill.html",parent:e.element(document.body),targetEvent:i,clickOutsideToClose:!0}).then(function(e){t.status='You said the information was "'+e+'".'},function(){t.status="You cancelled the dialog."})})}}e.module(t.app.name).controller("ProcessesController",a),a.$inject=["$scope","API","ThemeService","$interval","localStorageService","$mdDialog","hotRegisterer"]}(angular,smi2),/*
 * Copyright (C) 2017 IgorStrykhar in SMI2
 * All rights reserved.
 */
function(e,t,a){function i(e,t,a,i,r,n,o,s,l,d){e.widgets=[],e.gridsterOpts={columns:6,pushing:!0,floating:!0,swapping:!0,width:"auto",colWidth:"auto",rowHeight:"match",margins:[4,4],outerMargin:!0,sparse:!1,isMobile:!1,mobileBreakPoint:600,mobileModeEnabled:!0,minColumns:1,minRows:0,maxRows:100,defaultSizeX:1,defaultSizeY:1,minSizeX:0,maxSizeX:null,minSizeY:0,maxSizeY:null,resizable:{enabled:!e.vars.staticGrid,handles:["n","e","s","w","ne","se","sw","nw"],start:function(e,t,a){},resize:function(e,t,a){a.scheduledResize()},stop:function(e,t,a){d(function(){a.scheduledResize()},400)}},draggable:{enabled:!e.vars.staticGrid,handle:".widget-draggable",start:function(e,t,a){},drag:function(e,t,a){},stop:function(e,t,a){}}},e.vars={uiTheme:l.themeObject,isDark:l.isDark()},e.initTab=function(){console.info("initPivotTab")},e.init=function(){console.info("Init OverviewController"),r.query("SELECT * FROM system.build_options").then(function(t){e.widgets.push(new WidgetTable(new DataProvider(t),1,3))}),r.query("SELECT database,table,name, data_compressed_bytes, data_uncompressed_bytes FROM system.columns").then(function(t){var a={path:"database.table.name.data_compressed_bytes",title:"columns data_compressed_bytes",tooltip:"Size",valueformat:"0.00 b"},i={drawtype:"TREEMAP",code:a};e.widgets.push(new WidgetDraw(new DataProvider(t),i,3,3))}),r.query("select toStartOfFiveMinute(modification_time) as dt,\n            sum(bytes) as bytes from system.parts group by dt order by dt LIMIT 30000").then(function(t){var a={autoAxis:!0,markLine:!0,title:"system.parts bytes"},i={drawtype:"CHART",code:a};e.widgets.push(new WidgetDraw(new DataProvider(t),i,3,3))}),r.query("select concat(database,'.',table) as table,sum(bytes) as bytes from system.parts\n            group by table order by bytes desc LIMIT 3000").then(function(t){var a={title:"system.parts bytes"},i={drawtype:"BAR",code:a};e.widgets.push(new WidgetDraw(new DataProvider(t),i,3,1))})},e.init()}e.module(t.app.name).controller("OverviewController",i),i.$inject=["$scope","$rootScope","$window","localStorageService","API","$mdSidenav","$mdDialog","$mdToast","ThemeService","$timeout"]}(angular,smi2,window.$),function(e,t){function a(t,a,i,r,n,o,s){var l="proc.metrica",d="proc.metrica_max";t.data=[],t.metrcisChart=!1,t.maxlength=n.get(d)||50,t.chartData={},t.orderKeys={},t.preState={},t.EChartOptions={},t.vars={logEvents:!1,initChart:!1,isDark:i.isDark(),interval:n.get(l)||-1,scrollConfig:{autoHideScrollbar:!1,theme:i.isDark()?"light":"dark",scrollButtons:{enable:!1},scrollInertia:100,advanced:{updateOnContentResize:!0}}},e.element(s).bind("resize",function(){t.metrcisChart&&t.vars.initChart&&t.metrcisChart.resize()}),t.initChart=function(e){if(t.vars.initChart){for(var a in e)if("time"!=a){t.chartData[a].length>t.maxlength&&t.chartData[a].shift();var r=parseInt(e[a]);r-parseInt(t.preState[a]);t.chartData[a].push([e.time,r])}return t.metrcisChart.setOption(t.EChartOptions),void(t.preState=e)}if(e.time){t.preState=e;var n=[],o=[],s=[],l=[],d=[],c=0,m=0;for(var u in e)if("time"!=u){t.orderKeys[u]=c;var h=parseInt(e[u]);t.chartData[u]=[],t.chartData[u].push([e.time,h]),n.push({show:!0,borderWidth:0,shadowBlur:2}),o.push({show:!1,type:"time",splitLine:{show:!1},gridIndex:c}),s.push({type:"log",show:!1,scale:!0,splitLine:{show:!1},name:"value",min:"dataMin",max:"dataMax",gridIndex:c}),d.push({textAlign:"center",text:u,textStyle:{fontSize:12,fontWeight:"normal"}}),l.push({name:u,type:"line",data:t.chartData[u],xAxisIndex:c,yAxisIndex:m,showSymbol:!1,hoverAnimation:!1}),c+=1,m+=1}var p=Math.ceil(Math.sqrt(c));n.forEach(function(e,t){e.left=t%p/p*100+.5+"%",e.top=Math.floor(t/p)/p*100+.5+"%",e.width=1/p*100-1+"%",e.height=1/p*100-1+"%",d[t].left=parseFloat(e.left)+parseFloat(e.width)/2+"%",d[t].top=parseFloat(e.top)+"%"});var b={version:3,title:d.concat([{text:"Metrics",top:"bottom",left:"center"}]),toolbox:{show:!0,feature:{saveAsImage:{show:!0}}},width:"100%",group:"group",grid:n,xAxis:o,yAxis:s,series:l,tooltip:{showDelay:0,backgroundColor:"#2c343c",trigger:"axis",formatter:function(e){e=e[0];var t=new Date(e.value[0]),a=e.value[1],i=a;return e.seriesName.toLowerCase().includes("bytes")?a=numbro(a).format("0.0000b"):a>1e4&&(a=numbro(a).format("0.0000a")),e.seriesName+"<br><br>"+moment(t).format("h:mm:ss")+" <br><b>"+a+"</b><br>"+(i!=a?"<br><b>"+i+"</b><br>":"")},axisPointer:{animation:!1}}};t.vars.initChart=!0,t.EChartOptions=Object.assign(b,t.EChartOptions);var g="macarons";i.isDark()&&(g="dark"),t.metrcisChart=echarts.init(document.querySelector("#metrcisChart"),g),t.metrcisChart.setOption(t.EChartOptions),t.metrcisChart.resize()}};var c=null;t.$watch("vars.logEvents",function(){t.flushChart()},!0),t.flushChart=function(){t.vars.initChart&&(t.chartData={},t.metrcisChart.dispose(),t.EChartOptions={},t.vars.initChart=!1,t.load())},t.flush=function(){for(var e in t.chartData)for(var a=t.chartData[e].length,i=0;a-2>i;i++)t.chartData[e].shift();t.metrcisChart.setOption(t.EChartOptions),t.metrcisChart.resize(),t.load()},t.load=function(){t.vars.loading=!0;var e=" SELECT metric,toInt64(value) as value,'metrics' as type FROM system.metrics ORDER BY metric ";e+=" UNION ALL SELECT metric,toInt64(value) as value,'async' as type FROM system.asynchronous_metrics ORDER BY metric ",t.vars.logEvents&&(e+=" UNION ALL  SELECT event as metric, toInt64( value) as value,'events' as type FROM system.events ORDER BY metric"),a.query(e).then(function(e){t.vars.loading=!1;var a={time:Date.now()};e.data.forEach(function(e){var t="";"events"==e.type&&(t=" "),a[e.metric+t]=e.value}),t.initChart(a)},function(e){t.vars.loading=!1,console.error("Ошибка "+e)})},t.setMaxlength=function(){n.set(d,t.maxlength)},t.setInterval=function(){n.set(l,t.vars.interval),c&&(r.cancel(c),c=null),t.vars.interval>-1&&(c=r(t.load,1e3*t.vars.interval))},t.$on("$destroy",function(){t.vars.interval=-1,r.cancel(c),t.setInterval()}),t.load(),t.vars.interval>-1&&t.setInterval()}e.module(t.app.name).controller("MetricschartController",a),a.$inject=["$scope","API","ThemeService","$interval","localStorageService","$mdDialog","$window"]}(angular,smi2),function(e,t){function a(e,t,a,i,r,n,o){e.vars={uiTheme:a.themeObject,isDark:a.isDark(),selectedTabResultIndex:0,active:{Overview:!1,Chart:!1,Processes:!1}},e.initProcessesTab=function(t){e.vars.active.Processes=!0},e.initChartTab=function(t){e.vars.active.Chart=!0},e.initOverviewTab=function(t){e.vars.active.Overview=!0}}e.module(t.app.name).controller("MetricsController",a),a.$inject=["$scope","API","ThemeService","$interval","localStorageService","$mdDialog","$window"]}(angular,smi2),function(e,t){function a(e,a,i,r,n,o){var s="basesConfig";e.vars={bases:i.get(s)||[],db:{},loading:!1,version:t.app.version,themes:o.list},e.login=function(){if(e.vars.loading=!0,e.vars.db.id){for(var t=0;t<e.vars.bases.length;t++)if(e.vars.bases[t].id==e.vars.db.id){e.vars.bases[t]=e.vars.db;break}}else e.vars.db.id=(new Date).getTime(),e.vars.bases.push(e.vars.db);i.set(s,e.vars.bases),r.setConnection(e.vars.db),r.query("SELECT 'login success'").then(function(){return a.go("sql")},function(){e.vars.loading=!1,n.show(n.simple().content("Ошибка доступа").theme(o.theme).position("bottom right"))})},e.remove=function(){var t=e.vars.bases.findIndex(function(t){return t.id==e.vars.db.id});e.vars.bases.splice(t),i.set(s,e.vars.bases),e.vars.db={}},e.setUiTheme=function(e){return o.set(e.name)}}e.module(t.app.name).controller("LoginController",a),a.$inject=["$scope","$state","localStorageService","API","$mdToast","ThemeService"]}(angular,smi2),function(e,t){e.module(t.app.name).filter("filesize",function(){var e=["bytes","KB","MB","GB","TB","PB"];return function(t,a){if(isNaN(parseFloat(t))||!isFinite(t))return"?";for(var i=0;t>=1024;)t/=1024,i++;return t.toFixed(+a)+" "+e[i]}})}(angular,smi2),angular.module("ng-echartsx",[]).directive("ngEchartsx",[function(){return{link:function(e,t,a,i){function r(){var a=e.config&&e.config.theme?e.config.theme:"default",i=echarts.init(t[0],a);e.config&&e.config.dataLoaded===!1&&i.showLoading(),e.config&&e.config.dataLoaded&&(i.setOption(e.option),console.log("chart.resize();"),i.resize(),i.hideLoading()),e.config&&e.config.event&&angular.isArray(e.config.event)&&angular.forEach(e.config.event,function(e,t){for(var a in e)i.on(a,e[a])})}e.$watch(function(){return e.config},function(e){e&&r()},!0),e.$watch(function(){return e.option},function(e){e&&r()},!0)},scope:{option:"=ecOption",config:"=ecConfig"},restrict:"EA"}}]),angular.module("iu",[]).directive("iuChart",function(){return{restrict:"EA",template:"<div></div>",replace:!0,scope:{iuChart:"="},link:function(e,t,a,i){function r(){l=t.find("div")[0]||t[0],h.height?l.height(h.height):l.clientHeight||l.height(t.height()||t.parent().height()||220),c=h.theme?echarts.init(l,h.theme):echarts.init(l),c.setOption(h),angular.isFunction(h.onRegisterApi)&&(n(),h.onRegisterApi(d)),angular.isDefined(e.iuChart.version)&&(u=e.$watch("iuChart.version",function(e,t){e!==t&&c.setOption(h,!0)})),e.$on("$destroy",function(){u&&u(),c.dispose(),c=null}),$(window).resize(function(){c.resize()})}function n(){d={set:function(e){c.setOption(e,!0)},getInstance:function(){return c},addData:function(e){c.addData(e)},connect:function(e,t){e&&t?c.connect([e.getInstance(),t.getInstance()]):c.connect([e.getInstance()])},disConnect:function(e){c.disConnect(e.getInstance())},setTheme:function(e){},showLoading:function(e){},hideLoading:function(){},getImage:function(e){return c.getImage(e||"png")},resize:function(){c.resize()},refresh:function(){c.refresh()},restore:function(){c.restore()},clear:function(){c.clear()},registeEvents:function(e,t,a){this.events={CLICK:-1!==t.indexOf(1),DBLCLICK:-1!==t.indexOf(2),DATA_ZOOM:-1!==t.indexOf(3),LEGEND_SELECTED:-1!==t.indexOf(4),LEGEND_HOVERLINK:-1!==t.indexOf(5),HOVER:-1!==t.indexOf(6),MAP_SELECTED:-1!==t.indexOf(7),PIE_SELECTED:-1!==t.indexOf(8)},o(e,a)},unRegisteEvents:function(e,t){}}}function o(e,t){return m=s(),e.$on(m,function(a){var i=Array.prototype.slice.call(arguments);i.splice(0,1),t.apply(e,i)})}function s(){return"xxxxxxxx-xxxx-8xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,a="x"===e?t:3&t|8;return a.toString(16)})}var l,d,c,m,u,h=e.iuChart;r()}}}),function(){function e(e,t,a,i){return function(r,n,o){function s(e){c=e.width||parseInt(o.width)||b||320,m=e.height||parseInt(o.height)||g||240,h.style.width=c+"px",h.style.height=m+"px"}function l(e,t,i){t=angular.extend({showXAxis:!0,showYAxis:!0,showLegend:!0},t);var r=angular.extend({orient:"top",axisLine:{show:!1}},angular.isObject(t.xAxis)?t.xAxis:{}),n=angular.extend({type:"value",orient:"right",scale:!1,axisLine:{show:!1},axisLabel:{formatter:function(e){return a.formatKMBT(e)}}},angular.isObject(t.yAxis)?t.yAxis:{}),o={title:a.getTitle(e,t,i),tooltip:a.getTooltip(e,t,i),legend:a.getLegend(e,t,i),toolbox:angular.extend({show:!1},angular.isObject(t.toolbox)?t.toolbox:{}),xAxis:[angular.extend(r,a.getAxisTicks(e,t,i))],yAxis:[n],graphic:t.graphic&&(angular.isObject(t.graphic)||angular.isArray(t.graphic))?t.graphic:[],series:a.getSeries(e,t,i)};return t.showXAxis||angular.forEach(o.xAxis,function(e){e.axisLine={show:!1},e.axisLabel={show:!1},e.axisTick={show:!1}}),t.showYAxis||angular.forEach(o.yAxis,function(e){e.axisLine={show:!1},e.axisLabel={show:!1},e.axisTick={show:!1}}),t.showLegend&&"gauge"!==i&&"map"!==i||delete o.legend,a.isAxisChart(i)||(delete o.xAxis,delete o.yAxis),t.dataZoom&&(o.dataZoom=angular.extend({show:!0,realtime:!0},t.dataZoom)),t.dataRange&&(o.dataRange=angular.extend({},t.dataRange)),t.polar&&(o.polar=t.polar),t.grid&&(o.grid=t.grid),o}function d(){if(r.data&&r.config){var a;if(s(r.config),u||(u=echarts.init(h,t.get(r.config.theme||"macarons"))),r.config.event&&(Array.isArray(r.config.event)||(r.config.event=[r.config.event]),Array.isArray(r.config.event)&&r.config.event.forEach(function(e){f[e.type]||(f[e.type]=!0,u.on(e.type,function(t){e.fn(t)}))})),angular.isString(r.data)){if(v)return;v=!0,u.showLoading({text:r.config.loading||"奋力加载中...",textStyle:y}),e.get(r.data).success(function(e){v=!1,u.hideLoading(),e.data?(a=l(e.data,r.config,i),r.config.forceClear&&u.clear(),a.series.length?(u.setOption(a),u.resize()):u.showLoading({text:r.config.errorMsg||"没有数据",textStyle:y})):u.showLoading({text:r.config.emptyMsg||"数据加载失败",textStyle:y})}).error(function(e){v=!1,u.showLoading({text:r.config.emptyMsg||"数据加载失败",textStyle:y})})}else a=l(r.data,r.config,i),r.config.forceClear&&u.clear(),a.series.length?(u.setOption(a),u.resize()):u.showLoading({text:r.config.errorMsg||"没有数据",textStyle:y});r.chartObj=u}}r.config=r.config||{};var c,m,u,h=n.find("div")[0],p=n.parent()[0],b=p.clientWidth,g=p.clientHeight,f={},v=!1,y={color:"red",fontSize:36,fontWeight:900,fontFamily:"Microsoft Yahei, Arial"};r.$watch(function(){return r.config},function(e){e&&d()},!0),r.$watch(function(){return r.data},function(e){e&&d()},!0)}}for(var t=angular.module("angular-echarts",["angular-echarts.theme","angular-echarts.util"]),a=["line","bar","area","pie","donut","gauge","map","radar"],i=0,r=a.length;r>i;i++)!function(a){t.directive(a+"Chart",["$http","theme","util",function(t,i,r){return{restrict:"EA",template:"<div></div>",scope:{config:"=config",data:"=data",chartObj:"=chartObj"},link:e(t,i,r,a)}}])}(a[i]);angular.module("angular-echarts.util",[]).factory("util",function(){function e(e){return["pie","donut"].indexOf(e)>-1}function t(e){return["map"].indexOf(e)>-1}function a(e){return["line","bar","area"].indexOf(e)>-1}function i(e,t,a){var i=[];return e[0]&&angular.forEach(e[0].datapoints,function(e){i.push(e.x)}),{type:"category",boundaryGap:"bar"===a,data:i}}function r(i,r,n){var o=[];return angular.forEach(i,function(i){var s=[];angular.forEach(i.datapoints,function(e){s.push(e.y)});var l={type:n||"line",name:i.name,data:s};"area"===n&&(l.type="line",l.itemStyle={normal:{areaStyle:{type:"default"}}}),"gauge"===n&&(l=angular.extend(l,{splitNumber:10,axisLine:{lineStyle:{color:[[.2,"#228b22"],[.8,"#48b"],[1,"#ff4500"]],width:8}},axisTick:{splitNumber:10,length:12,lineStyle:{color:"auto"}},axisLabel:{textStyle:{color:"auto"}},splitLine:{show:!0,length:30,lineStyle:{color:"auto"}},pointer:{width:5},title:{show:!0,offsetCenter:[0,"-40%"],textStyle:{fontWeight:"bolder"}},detail:{formatter:"{value}%",textStyle:{color:"auto",fontWeight:"bolder"}}},r.gauge||{})),a(n)||(l.data=[],angular.forEach(i.datapoints,function(e){l.data.push({value:e.y,name:e.x})})),e(n)&&(l.type="pie",l.center=r.center||["40%","50%"],l.radius=r.radius||"60%","donut"===n?(l.radius=r.radius||["50%","70%"],l=angular.extend(l,{itemStyle:{normal:{label:{show:!1},labelLine:{show:!1}},emphasis:{label:{show:!0,position:"center",textStyle:{fontSize:"50",fontWeight:"bold"}}}}},r.donut||{})):"pie"===n&&(l=angular.extend(l,{itemStyle:{normal:{label:{position:"inner",formatter:function(e){return(+e.percent).toFixed()+"%"}},labelLine:{show:!1}},emphasis:{label:{show:!0,formatter:"{b}\n{d}%"}}}},r.pie||{}))),t(n)&&(l.type="map",l=angular.extend(l,{},r.map||{})),r.stack&&(l.stack="total"),"radar"===n&&(l.data=i.data),o.push(l)}),o}function n(t,a,i){var r={data:[]};return e(i)?(t[0]&&angular.forEach(t[0].datapoints,function(e){r.data.push(e.x)}),r.orient="verticle",r.x="right",r.y="center"):(angular.forEach(t,function(e){r.data.push(e.name)}),r.orient="horizontal"),angular.extend(r,a.legend||{})}function o(e,t,a){var i={};switch(a){case"line":case"area":i.trigger="axis";break;case"pie":case"donut":case"bar":case"map":case"gauge":i.trigger="item"}return"pie"===a&&(i.formatter="{a} <br/>{b}: {c} ({d}%)"),"map"===a&&(i.formatter="{b}"),angular.extend(i,angular.isObject(t.tooltip)?t.tooltip:{})}function s(t,a,i){return angular.isObject(a.title)?a.title:e(i)?null:{text:a.title,subtext:a.subtitle||"",x:50}}function l(e,t){return t||(t=function(e){return Math.round(100*e)/100}),e=Math.abs(e),e>=1e12?t(e/1e12)+"T":e>=1e9?t(e/1e9)+"B":e>=1e6?t(e/1e6)+"M":e>=1e3?t(e/1e3)+"K":1>e&&e>0?t(e):0===e?"":t(e)}return{isPieChart:e,isAxisChart:a,getAxisTicks:i,getSeries:r,getLegend:n,getTooltip:o,getTitle:s,formatKMBT:l}}),angular.module("angular-echarts.theme",[]).factory("theme",["infographic","macarons","shine","dark","blue","green","red",function(e,t,a,i,r,n,o,s){var l={infographic:e,macarons:t,shine:a,dark:i,blue:r,green:n,red:o,grey:s};return{get:function(e){return l[e]?l[e]:{}}}}]),angular.module("angular-echarts.theme").factory("blue",function(){return{color:["#1790cf","#1bb2d8","#99d2dd","#88b0bb","#1c7099","#038cc4","#75abd0","#afd6dd"],title:{itemGap:8,textStyle:{fontWeight:"normal",color:"#1790cf"}},dataRange:{color:["#1178ad","#72bbd0"]},toolbox:{color:["#1790cf","#1790cf","#1790cf","#1790cf"]},tooltip:{backgroundColor:"rgba(0,0,0,0.5)",axisPointer:{type:"line",lineStyle:{color:"#1790cf",type:"dashed"},crossStyle:{color:"#1790cf"},shadowStyle:{color:"rgba(200,200,200,0.3)"}}},dataZoom:{dataBackgroundColor:"#eee",fillerColor:"rgba(144,197,237,0.2)",handleColor:"#1790cf"},grid:{borderWidth:0},categoryAxis:{axisLine:{lineStyle:{color:"#1790cf"}},splitLine:{lineStyle:{color:["#eee"]}}},valueAxis:{axisLine:{lineStyle:{color:"#1790cf"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.1)","rgba(200,200,200,0.1)"]}},splitLine:{lineStyle:{color:["#eee"]}}},timeline:{lineStyle:{color:"#1790cf"},controlStyle:{normal:{color:"#1790cf"},emphasis:{color:"#1790cf"}}},k:{itemStyle:{normal:{color:"#1bb2d8",color0:"#99d2dd",lineStyle:{width:1,color:"#1c7099",color0:"#88b0bb"}}}},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#c12e34"}}},emphasis:{areaStyle:{color:"#99d2dd"},label:{textStyle:{color:"#c12e34"}}}}},force:{itemStyle:{normal:{linkStyle:{strokeColor:"#1790cf"}}}},chord:{padding:4,itemStyle:{normal:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{startAngle:225,endAngle:-45,axisLine:{show:!0,lineStyle:{color:[[.2,"#1bb2d8"],[.8,"#1790cf"],[1,"#1c7099"]],width:8}},axisTick:{splitNumber:10,length:12,lineStyle:{color:"auto"}},axisLabel:{textStyle:{color:"auto"}},splitLine:{length:18,lineStyle:{color:"auto"}},pointer:{length:"90%",color:"auto"},title:{textStyle:{color:"#333"}},detail:{textStyle:{color:"auto"}}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}}}),angular.module("angular-echarts.theme").factory("dark",function(){return{backgroundColor:"#1b1b1b",color:["#FE8463","#9BCA63","#FAD860","#60C0DD","#0084C6","#D7504B","#C6E579","#26C0C0","#F0805A","#F4E001","#B5C334"],title:{itemGap:8,textStyle:{fontWeight:"normal",color:"#fff"}},legend:{itemGap:8,textStyle:{color:"#ccc"}},dataRange:{itemWidth:15,color:["#FFF808","#21BCF9"],textStyle:{color:"#ccc"}},toolbox:{color:["#fff","#fff","#fff","#fff"],effectiveColor:"#FE8463",disableColor:"#666",itemGap:8},tooltip:{backgroundColor:"rgba(250,250,250,0.8)",axisPointer:{type:"line",lineStyle:{color:"#aaa"},crossStyle:{color:"#aaa"},shadowStyle:{color:"rgba(200,200,200,0.2)"}},textStyle:{color:"#333"}},dataZoom:{dataBackgroundColor:"#555",fillerColor:"rgba(200,200,200,0.2)",handleColor:"#eee"},grid:{borderWidth:0},categoryAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{textStyle:{color:"#ccc"}},splitLine:{show:!1}},valueAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{textStyle:{color:"#ccc"}},splitLine:{lineStyle:{color:["#aaa"],type:"dashed"}},splitArea:{show:!1}},polar:{name:{textStyle:{color:"#ccc"}},axisLine:{lineStyle:{color:"#ddd"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(200,200,200,0.2)"]}},splitLine:{lineStyle:{color:"#ddd"}}},timeline:{label:{textStyle:{color:"#ccc"}},lineStyle:{color:"#aaa"},controlStyle:{normal:{color:"#fff"},emphasis:{color:"#FE8463"}},symbolSize:3},line:{smooth:!0},k:{itemStyle:{normal:{color:"#FE8463",color0:"#9BCA63",lineStyle:{width:1,color:"#FE8463",color0:"#9BCA63"}}}},radar:{symbol:"emptyCircle",symbolSize:3},pie:{itemStyle:{normal:{borderWidth:1,borderColor:"rgba(255, 255, 255, 0.5)"},emphasis:{borderWidth:1,borderColor:"rgba(255, 255, 255, 1)"}}},map:{itemStyle:{normal:{borderColor:"rgba(255, 255, 255, 0.5)",areaStyle:{color:"#ddd"},label:{textStyle:{color:"#ccc"}}},emphasis:{areaStyle:{color:"#FE8463"},label:{textStyle:{color:"ccc"}}}}},force:{itemStyle:{normal:{linkStyle:{strokeColor:"#fff"}}}},chord:{padding:4,itemStyle:{normal:{lineStyle:{width:1,color:"rgba(228, 228, 228, 0.2)"},chordStyle:{lineStyle:{width:1,color:"rgba(228, 228, 228, 0.2)"}}},emphasis:{lineStyle:{width:1,color:"rgba(228, 228, 228, 0.9)"},chordStyle:{lineStyle:{width:1,color:"rgba(228, 228, 228, 0.9)"}}}}},gauge:{startAngle:225,endAngle:-45,axisLine:{show:!0,lineStyle:{color:[[.2,"#9BCA63"],[.8,"#60C0DD"],[1,"#D7504B"]],width:3,shadowColor:"#fff",shadowBlur:10}},axisTick:{length:15,lineStyle:{color:"auto",shadowColor:"#fff",shadowBlur:10}},axisLabel:{textStyle:{fontWeight:"bolder",color:"#fff",shadowColor:"#fff",shadowBlur:10}},splitLine:{length:25,lineStyle:{width:3,color:"#fff",shadowColor:"#fff",shadowBlur:10}},pointer:{shadowColor:"#fff",shadowBlur:5},title:{textStyle:{fontWeight:"bolder",fontSize:20,fontStyle:"italic",color:"#fff",shadowColor:"#fff",shadowBlur:10}},detail:{shadowColor:"#fff",shadowBlur:5,offsetCenter:[0,"50%"],textStyle:{fontWeight:"bolder",color:"#fff"}}},funnel:{itemStyle:{normal:{borderColor:"rgba(255, 255, 255, 0.5)",borderWidth:1},emphasis:{borderColor:"rgba(255, 255, 255, 1)",borderWidth:1}}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}}}),angular.module("angular-echarts.theme").factory("green",function(){return{color:["#408829","#68a54a","#a9cba2","#86b379","#397b29","#8abb6f","#759c6a","#bfd3b7"],title:{itemGap:8,textStyle:{fontWeight:"normal",color:"#408829"}},dataRange:{color:["#1f610a","#97b58d"]},toolbox:{color:["#408829","#408829","#408829","#408829"]},tooltip:{backgroundColor:"rgba(0,0,0,0.5)",axisPointer:{type:"line",lineStyle:{color:"#408829",type:"dashed"},crossStyle:{color:"#408829"},shadowStyle:{color:"rgba(200,200,200,0.3)"}}},dataZoom:{dataBackgroundColor:"#eee",fillerColor:"rgba(64,136,41,0.2)",handleColor:"#408829"},grid:{borderWidth:0},categoryAxis:{axisLine:{lineStyle:{color:"#408829"}},splitLine:{lineStyle:{color:["#eee"]}}},valueAxis:{axisLine:{lineStyle:{color:"#408829"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.1)","rgba(200,200,200,0.1)"]}},splitLine:{lineStyle:{color:["#eee"]}}},timeline:{lineStyle:{color:"#408829"},controlStyle:{normal:{color:"#408829"},emphasis:{color:"#408829"}}},k:{itemStyle:{normal:{color:"#68a54a",color0:"#a9cba2",lineStyle:{width:1,color:"#408829",color0:"#86b379"}}}},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#c12e34"}}},emphasis:{areaStyle:{color:"#99d2dd"},label:{textStyle:{color:"#c12e34"}}}}},force:{itemStyle:{normal:{linkStyle:{strokeColor:"#408829"}}}},chord:{padding:4,itemStyle:{normal:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{startAngle:225,endAngle:-45,axisLine:{show:!0,lineStyle:{color:[[.2,"#86b379"],[.8,"#68a54a"],[1,"#408829"]],width:8}},axisTick:{splitNumber:10,length:12,lineStyle:{color:"auto"}},axisLabel:{textStyle:{color:"auto"}},splitLine:{length:18,lineStyle:{color:"auto"}},pointer:{length:"90%",color:"auto"},title:{textStyle:{color:"#333"}},detail:{textStyle:{color:"auto"}}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}}}),angular.module("angular-echarts.theme").factory("infographic",function(){return{color:["#C1232B","#B5C334","#FCCE10","#E87C25","#27727B","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"],title:{itemGap:8,textStyle:{fontWeight:"normal",color:"#27727B"}},legend:{itemGap:8},dataRange:{x:"right",y:"center",itemWidth:5,itemHeight:25,color:["#C1232B","#FCCE10"]},toolbox:{color:["#C1232B","#B5C334","#FCCE10","#E87C25","#27727B","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD"],effectiveColor:"#ff4500",itemGap:8},tooltip:{backgroundColor:"rgba(50,50,50,0.5)",axisPointer:{type:"line",lineStyle:{color:"#27727B",type:"dashed"},crossStyle:{color:"#27727B"},shadowStyle:{color:"rgba(200,200,200,0.3)"}}},dataZoom:{dataBackgroundColor:"rgba(181,195,52,0.3)",fillerColor:"rgba(181,195,52,0.2)",handleColor:"#27727B"},grid:{borderWidth:0},categoryAxis:{axisLine:{lineStyle:{color:"#27727B"}},splitLine:{show:!1}},valueAxis:{axisLine:{show:!1},splitArea:{show:!1},splitLine:{lineStyle:{color:["#ccc"],type:"dashed"}}},polar:{axisLine:{lineStyle:{color:"#ddd"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(200,200,200,0.2)"]}},splitLine:{lineStyle:{color:"#ddd"}}},timeline:{lineStyle:{color:"#27727B"},controlStyle:{normal:{color:"#27727B"},emphasis:{color:"#27727B"}},symbol:"emptyCircle",symbolSize:3},bar:{itemStyle:{normal:{borderRadius:0},emphasis:{borderRadius:0}}},line:{itemStyle:{normal:{borderWidth:2,borderColor:"#fff",lineStyle:{width:3}},emphasis:{borderWidth:0}},symbol:"circle",symbolSize:3.5},k:{itemStyle:{normal:{color:"#C1232B",color0:"#B5C334",lineStyle:{width:1,color:"#C1232B",color0:"#B5C334"}}}},scatter:{itemdStyle:{normal:{borderWidth:1,borderColor:"rgba(200,200,200,0.5)"},emphasis:{borderWidth:0}},symbol:"star4",symbolSize:4},radar:{symbol:"emptyCircle",symbolSize:3},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#C1232B"}}},emphasis:{areaStyle:{color:"#fe994e"},label:{textStyle:{color:"rgb(100,0,0)"}}}}},force:{itemStyle:{normal:{linkStyle:{strokeColor:"#27727B"}}}},chord:{padding:4,itemStyle:{normal:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{center:["50%","80%"],radius:"100%",startAngle:180,endAngle:0,axisLine:{show:!0,lineStyle:{color:[[.2,"#B5C334"],[.8,"#27727B"],[1,"#C1232B"]],width:"40%"}},axisTick:{splitNumber:2,length:5,lineStyle:{color:"#fff"}},axisLabel:{textStyle:{color:"#fff",fontWeight:"bolder"}},splitLine:{length:"5%",lineStyle:{color:"#fff"}},pointer:{width:"40%",length:"80%",color:"#fff"},title:{offsetCenter:[0,-20],textStyle:{color:"auto",fontSize:20}},detail:{offsetCenter:[0,0],textStyle:{color:"auto",fontSize:40}}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}}}),angular.module("angular-echarts.theme").factory("macarons",function(){return{color:["#2ec7c9","#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],title:{itemGap:8,textStyle:{fontWeight:"normal",color:"#008acd"}},legend:{itemGap:8},dataRange:{itemWidth:15,color:["#2ec7c9","#b6a2de"]},toolbox:{color:["#1e90ff","#1e90ff","#1e90ff","#1e90ff"],effectiveColor:"#ff4500",itemGap:8},tooltip:{backgroundColor:"rgba(50,50,50,0.5)",axisPointer:{type:"line",lineStyle:{color:"#008acd",type:"dashed",width:1},crossStyle:{color:"#008acd",width:1},shadowStyle:{color:"rgba(200,200,200,0.2)"}}},dataZoom:{dataBackgroundColor:"#efefff",fillerColor:"rgba(182,162,222,0.2)",handleColor:"#008acd"},grid:{borderColor:"#eee"},categoryAxis:{axisLine:{lineStyle:{color:"#008acd",width:1}},axisLabel:{skipFirst:!0,margin:3,textStyle:{color:"#999999"}},axisTick:{show:!1,lineStyle:{color:"#008acd",width:1}},splitLine:{lineStyle:{color:["#eee"]}}},valueAxis:{axisLine:{lineStyle:{color:"#008acd",width:1}},axisLabel:{skipFirst:!0,margin:3,textStyle:{color:"#999999"}},axisTick:{show:!1,lineStyle:{color:"#008acd",width:1}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.1)","rgba(200,200,200,0.1)"]}},splitLine:{lineStyle:{color:["#eee"]}}},polar:{axisLine:{lineStyle:{color:"#ddd"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(200,200,200,0.2)"]}},splitLine:{lineStyle:{color:"#ddd"}}},timeline:{lineStyle:{color:"#008acd"},controlStyle:{normal:{color:"#008acd"},emphasis:{color:"#008acd"}},symbol:"emptyCircle",symbolSize:3},bar:{itemStyle:{normal:{borderRadius:5},emphasis:{borderRadius:5}}},line:{smooth:!1,symbol:"circle",symbolSize:3},k:{itemStyle:{normal:{color:"#d87a80",color0:"#2ec7c9",lineStyle:{width:1,color:"#d87a80",color0:"#2ec7c9"}}}},scatter:{symbol:"circle",symbolSize:4},radar:{symbol:"emptyCircle",symbolSize:3},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#d87a80"}}},emphasis:{areaStyle:{color:"#fe994e"},label:{textStyle:{color:"rgb(100,0,0)"}}}}},force:{itemStyle:{normal:{linkStyle:{strokeColor:"#1e90ff"}}}},chord:{padding:4,itemStyle:{normal:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{startAngle:225,endAngle:-45,axisLine:{show:!0,lineStyle:{color:[[.2,"#2ec7c9"],[.8,"#5ab1ef"],[1,"#d87a80"]],width:10}},axisTick:{splitNumber:10,length:15,lineStyle:{color:"auto"}},axisLabel:{textStyle:{color:"auto"}},splitLine:{length:22,lineStyle:{color:"auto"}},pointer:{width:5,color:"auto"},title:{textStyle:{color:"#333"}},detail:{textStyle:{color:"auto"}}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}}}),angular.module("angular-echarts.theme").factory("red",function(){return{color:["#d8361b","#f16b4c","#f7b4a9","#d26666","#99311c","#c42703","#d07e75"],title:{itemGap:8,textStyle:{fontWeight:"normal",color:"#d8361b"}},dataRange:{color:["#bd0707","#ffd2d2"]},toolbox:{color:["#d8361b","#d8361b","#d8361b","#d8361b"]},tooltip:{backgroundColor:"rgba(0,0,0,0.5)",axisPointer:{type:"line",lineStyle:{color:"#d8361b",type:"dashed"},crossStyle:{color:"#d8361b"},shadowStyle:{color:"rgba(200,200,200,0.3)"}}},dataZoom:{dataBackgroundColor:"#eee",fillerColor:"rgba(216,54,27,0.2)",handleColor:"#d8361b"},grid:{borderWidth:0},categoryAxis:{axisLine:{lineStyle:{color:"#d8361b"}},splitLine:{lineStyle:{color:["#eee"]}}},valueAxis:{axisLine:{lineStyle:{color:"#d8361b"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.1)","rgba(200,200,200,0.1)"]}},splitLine:{lineStyle:{color:["#eee"]}}},timeline:{lineStyle:{color:"#d8361b"},controlStyle:{normal:{color:"#d8361b"},emphasis:{color:"#d8361b"}}},k:{itemStyle:{normal:{color:"#f16b4c",color0:"#f7b4a9",lineStyle:{width:1,color:"#d8361b",color0:"#d26666"}}}},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#c12e34"}}},emphasis:{areaStyle:{color:"#99d2dd"},label:{textStyle:{color:"#c12e34"}}}}},force:{itemStyle:{normal:{linkStyle:{strokeColor:"#d8361b"}}}},chord:{padding:4,itemStyle:{normal:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{startAngle:225,endAngle:-45,axisLine:{show:!0,lineStyle:{color:[[.2,"#f16b4c"],[.8,"#d8361b"],[1,"#99311c"]],width:8}},axisTick:{splitNumber:10,length:12,lineStyle:{color:"auto"}},axisLabel:{textStyle:{color:"auto"}},splitLine:{length:18,lineStyle:{color:"auto"}},pointer:{length:"90%",color:"auto"},title:{textStyle:{color:"#333"}},detail:{textStyle:{color:"auto"}}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}}}),angular.module("angular-echarts.theme").factory("shine",function(){return{color:["#c12e34","#e6b600","#0098d9","#2b821d","#005eaa","#339ca8","#cda819","#32a487"],title:{itemGap:8,textStyle:{fontWeight:"normal"}},legend:{itemGap:8},dataRange:{itemWidth:15,color:["#1790cf","#a2d4e6"]},toolbox:{color:["#06467c","#00613c","#872d2f","#c47630"],itemGap:8},
tooltip:{backgroundColor:"rgba(0,0,0,0.6)"},dataZoom:{dataBackgroundColor:"#dedede",fillerColor:"rgba(154,217,247,0.2)",handleColor:"#005eaa"},grid:{borderWidth:0},categoryAxis:{axisLine:{show:!1},axisTick:{show:!1}},valueAxis:{axisLine:{show:!1},axisTick:{show:!1},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(200,200,200,0.2)"]}}},timeline:{lineStyle:{color:"#005eaa"},controlStyle:{normal:{color:"#005eaa"},emphasis:{color:"#005eaa"}}},k:{itemStyle:{normal:{color:"#c12e34",color0:"#2b821d",lineStyle:{width:1,color:"#c12e34",color0:"#2b821d"}}}},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#c12e34"}}},emphasis:{areaStyle:{color:"#e6b600"},label:{textStyle:{color:"#c12e34"}}}}},force:{itemStyle:{normal:{linkStyle:{strokeColor:"#005eaa"}}}},chord:{padding:4,itemStyle:{normal:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{startAngle:225,endAngle:-45,axisLine:{show:!0,lineStyle:{color:[[.2,"#2b821d"],[.8,"#005eaa"],[1,"#c12e34"]],width:5}},axisTick:{splitNumber:10,length:8,lineStyle:{color:"auto"}},axisLabel:{textStyle:{color:"auto"}},splitLine:{length:12,lineStyle:{color:"auto"}},pointer:{length:"90%",width:3,color:"auto"},title:{textStyle:{color:"#333"}},detail:{textStyle:{color:"auto"}}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}}})}();var Widget=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;_classCallCheck(this,e),this._scheduledResize=!1,this.data=t,this.drawCommnads=a,this._draw=!1,a&&this.drawCommnads.drawtype?this.drawType=this.drawCommnads.drawtype.toUpperCase():this.drawType=!1,this.error=this.data.error,this.text=this.data.text,this.name="Widget",this.sizeX=3,this.sizeY=1,this.element=!1,this.init=!1,this.type=!1,this.isDark=angular.element("*[ng-app]").injector().get("ThemeService").isDark()}return _createClass(e,[{key:"onDrag",value:function(){}},{key:"onResize",value:function(){}},{key:"scheduledResize",value:function(){if(!this._scheduledResize){this._scheduledResize=!0;var e=this;setTimeout(function(){e._scheduledResize=!1,e.onResize()},400)}}},{key:"toString",value:function(){return"("+this.name+", "+this.y+")"}}]),e}(),WidgetTable=function(e){function t(e,a,i,r){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));if(n.type="table",n.table={},n.sort=!1,n.hotId="hotIdTable"+Math.floor(1e7*Math.random()),n.error)return n.sizeY=1,n.sizeX=6,n.init=!1,_possibleConstructorReturn(n);if(n.text)return n.sizeY=2,n.sizeX=6,n.init=!1,_possibleConstructorReturn(n);n.hotRegisterer=!1;var o=new HandsTable(n);n.table={settings:o.makeSettings()};var s=o.countColumns(),l=1;return s>2&&(l=2),s>5&&(l=3),s>10&&(l=4),s>15&&(l=6),"statistics"==n.data.sourceType&&(l=6),n.sizeX=l,n.sizeY=1,n.data.rows>100&&(n.sizeY=2),n.data.rows>250&&(n.sizeY=3),n.data.rows>500&&(n.sizeY=4),1==n.data.countAll&&(n.sizeX=6),_.isNumber(i)&&(n.sizeX=i),_.isNumber(r)&&(n.sizeY=r),n.init=!0,n}return t.$inject=["DataProvider","draw","sizeX","sizeY"],_inherits(t,e),_createClass(t,[{key:"preProcessor",value:function(){}},{key:"onDrag",value:function(){this.onResize()}},{key:"getInstanceHandsontable",value:function(){return this.hotRegisterer&&this.init&&this.element&&this.hotId?this.hotRegisterer.getInstance(this.hotId):void 0}},{key:"onResize",value:function(){if(console.info("onResize HotTable"),this.table){this.table.width="99.9"+Math.floor(100*Math.random())+"%",this.table.height="99.9"+Math.floor(100*Math.random())+"%";var e=this.getInstanceHandsontable();e&&(e.updateSettings({height:this.table.height,width:this.table.width}),e.render())}}}]),t}(Widget);angular.module(smi2.app.name).service("WidgetTable",WidgetTable);var WidgetPivot=function(e){function t(e,a){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return i.type="pivot",i.error||i.text?_possibleConstructorReturn(i):(i.init=!0,i.renderers=$.extend($.pivotUtilities.renderers,$.pivotUtilities.c3_renderers,$.pivotUtilities.d3_renderers,$.pivotUtilities.export_renderers),i.pivot={config:{renderer:i.renderers}},1==i.data.countAll&&(i.sizeX=6,i.sizeY=3),i)}return t.$inject=["DataProvider","draw"],_inherits(t,e),t}(Widget);angular.module(smi2.app.name).service("WidgetPivot",WidgetPivot);var WidgetDraw=function(e){function t(e,a,i,r){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return n.type="draw",n.error||n.text?_possibleConstructorReturn(n):(n.library=!1,n.sizeY=2,n._list={HEATMAP:DrawEchartsHeatmap,RAW:DrawEchartsMap,BAR:DrawEchartsBar,RIVER:DrawEchartsRiver,MAP:DrawEchartsMap,TREEMAP:DrawEchartsTreemap,SANKEYS:DrawEchartsSunkeys,CHART:DrawEchartsChart,GRIDCHART:DrawEchartsGridChart,TEXT:DrawText,D3:DrawD3,C3:DrawC3},n.init=n.getChartClass(),"TEXT"==n.drawType&&(n.sizeX=0,n.sizeY=0),_.isNumber(i)&&(n.sizeX=i),_.isNumber(r)&&(n.sizeY=r),1==n.data.countAll&&(n.sizeX=6,n.sizeY=3),n)}return t.$inject=["DataProvider","draw","sizeX","sizeY"],_inherits(t,e),_createClass(t,[{key:"onResize",value:function(){this._draw&&this._draw.onResize()}},{key:"getChartClass",value:function(){return this.drawType||(this.drawType="CHART",console.error("Un support DrawType:null")),this._list[this.drawType]?!0:(console.error("Un support DrawType:"+this.drawType),!1)}},{key:"draw",get:function(){return this.drawType&&!this._draw&&(this._draw=new this._list[this.drawType](this,this.drawType)),this._draw}}]),t}(Widget);angular.module(smi2.app.name).service("WidgetDraw",WidgetDraw);var HandsTable=function(){function e(t){_classCallCheck(this,e),this.WidgetTable=t,this.isDarkTheme=t.isDark,window.isDarkTheme=this.isDarkTheme,this.meta=t.data.meta}return e.$inject=["WidgetTable"],_createClass(e,[{key:"_handsRenderer",value:function(e,t,a,i,r,n,o){"numeric"==o.type?Handsontable.renderers.NumericRenderer.apply(this,arguments):"date"==o.type||"time"==o.type?(moment(new Date(n)).isValid()&&o.renderDateFormat&&(n=moment(n).format(o.renderDateFormat)),arguments[5]=n,Handsontable.renderers.TextRenderer.apply(this,arguments)):Handsontable.renderers.TextRenderer.apply(this,arguments),o.backgroundColor&&(t.style.backgroundColor=o.backgroundColor),o.color&&(t.style.color=o.color)}},{key:"countColumns",value:function(){return this.meta.length}},{key:"makeColumns",value:function(){var e=this,t=[],a=[],i={},r=0;return this.meta.forEach(function(n){i[n.name]=r,r++,t.push(n.name);var o={};switch(o.type="text",o.width=100,o.typeOriginal=n.type,o.isDark=e.isDarkTheme,n.type.includes("Int")&&(o.width=80,o.type="numeric"),n.type){case"Date":o.width=90,o.type="date",o.dateFormat="YYYY-MM-DD";break;case"DateTime":o.width=150,o.type="time",o.timeFormat="YYYY-MM-DD HH:mm:ss";break;case"Float32":o.width=80,o.type="numeric",o.format="0.[0000000]";break;case"Float64":o.width=80,o.type="numeric",o.format="0.[0000000]";break;case"String":o.width=180}o.renderer=e._handsRenderer,o.data=n.name,a.push(o)}),{colHeaders:t,columns:a,colPositions:i}}},{key:"makeSettings",value:function(){var t=this.makeColumns(),a={dropdownMenu:!0,manualColumnMove:!0,manualColumnResize:!0,rowHeaders:!0,colWidths:100,fillHandle:!1,stretchH:"all",customBorders:!0,isDark:this.isDarkTheme,filters:!0,columnSorting:!0,sortIndicator:!0,manualRowResize:!0,wordWrap:!1,autoColumnSize:{samplingRatio:23},preventOverflow:"horizontal",columns:t.columns,colHeaders:t.colHeaders,contextMenu:{items:{columnformat:{name:"Column format",submenu:{items:[{name:"Reset",key:"columnformat:1",callback:function(t,a,i){e.makeFormat(this,"Reset")}},{name:"Money",key:"columnformat:2",callback:function(t,a,i){e.makeFormat(this,"Money")},disabled:function(){return!e.isFormatColl(this,"numeric")}},{name:"Human",key:"columnformat:3",callback:function(t,a,i){e.makeFormat(this,"Human")},disabled:function(){return!e.isFormatColl(this,"numeric")}},{name:"Bytes",key:"columnformat:4",callback:function(t,a,i){e.makeFormat(this,"Bytes")},disabled:function(){return!e.isFormatColl(this,"numeric")}},{name:"Percentages",key:"columnformat:5",callback:function(t,a,i){e.makeFormat(this,"Percentages")},disabled:function(){return!e.isFormatColl(this,"numeric")}},{name:"Time only",key:"columnformat:6",callback:function(t,a,i){e.makeFormat(this,"Time")},disabled:function(){return!e.isFormatColl(this,"Time")}},{name:"Date only",key:"columnformat:7",callback:function(t,a,i){e.makeFormat(this,"Date")},disabled:function(){return!e.isFormatColl(this,"Date")}},{name:"Date loc.",key:"columnformat:8",callback:function(t,a,i){e.makeFormat(this,"DateLoc")},disabled:function(){return!e.isFormatColl(this,"Date")}},{name:"Float",key:"columnformat:9",callback:function(t,a,i){e.makeFormat(this,"Float")},disabled:function(){return!e.isFormatColl(this,"numeric")}},{name:"Heatmaps",key:"columnformat:10",callback:function(t,a,i){e.makeHeatmaps(this,"Heatmaps")},disabled:function(){return!e.isFormatColl(this,"numeric")}},{name:"Negative & Positive",key:"columnformat:11",callback:function(t,a,i){e.makeHeatmaps(this,"NegaPosi")},disabled:function(){return!e.isFormatColl(this,"numeric")}}]}},style:{name:"Style",submenu:{items:[{name:"Normal",callback:function(t,a,i){e.makeStyle(this,"Normal")},key:"style:normal"},{name:"Bold",callback:function(t,a){e.makeStyle(this,"Bold")},key:"style:makebold"},{name:"Red color",callback:function(t,a){e.makeStyle(this,"Red")},key:"style:red"},{name:"Green color",callback:function(t,a){e.makeStyle(this,"Green")},key:"style:green"}]}},hsep1:"---------",copyTo:{name:"To Clipboard",submenu:{items:[{name:"Redmine Markdown",callback:function(t,a,i){console.info("copyToClipboard"),e.copyToClipboard(this,"Redmine")},key:"copyTo:1"},{name:"Redmine Markdown (full)",callback:function(t,a,i){console.info("copyToClipboard"),e.copyToClipboard(this,"Redmine",!0)},key:"copyTo:2"},{name:"WHERE col1 IN (val,val),col2 IN ...",callback:function(t,a,i){console.info("makeWhereIn"),e.makeWhereIn(this)},key:"copyTo:3"}]}},hsep2:"---------",undo:{},make_read_only:{},alignment:{},hsep3:"---------"}},contextMenuCopyPaste:{swfPath:"/bower_components/zeroclipboard/dist/ZeroClipboard.swf"},currentRowClassName:"currentRow",currentColClassName:"currentCol"};return this.WidgetTable.data.sort&&this.WidgetTable.data.sortOrder&&(a.columnSorting={column:t.colPositions[this.WidgetTable.data.sort],sortOrder:"desc"==this.WidgetTable.data.sortOrder.toLowerCase()?!1:!0}),a}}],[{key:"isDark",value:function(){return window.isDarkTheme}},{key:"makeHeatmaps",value:function(e,t){console.info("isDark",window.isDarkTheme),console.warn(e.getCellMeta(0,0,"isDark"));for(var a=e.getSelectedRange(),i=Math.min(a.from.col,a.to.col),r=Math.max(a.from.col,a.to.col),n="#a900e5",o="#3668ff",s=chroma.scale([n,o]),l=i;r>=l;l++){var d=e.countRows(),c=e.getDataAtCol(l),m=Math.min.apply(null,c),u=Math.max.apply(null,c);if(null!==m&&null!==u)for(var h=0;d>=h;h++){var p=parseFloat(e.getDataAtCell(h,l));if("Heatmaps"==t){var b=(p-m)/(u-m),g=s(b).hex(),f=e.getCellMeta(h,l);f&&e.setCellMeta(h,l,"backgroundColor",g)}if("NegaPosi"==t){var v=!1;0>p&&(v="#e27137"),p>0&&(v="#31b3e5");var y=e.getCellMeta(h,l);y&&v&&e.setCellMeta(h,l,"color",v)}}else console.warn("Can`t find Min&Max in column",l)}e.render()}},{key:"getSelected",value:function(e,t,a){var i=e.getSelectedRange(),r=!1;if(!i&&t||a)return{isSelection:!1,fromRow:0,toRow:e.countRows(),toCol:e.countCols(),fromCol:0};if(!i)return{isSelection:!1,fromRow:-1,toRow:-1,toCol:-1,fromCol:-1};var n=Math.min(i.from.col,i.to.col),o=Math.max(i.from.col,i.to.col),s=Math.min(i.from.row,i.to.row),l=Math.max(i.from.row,i.to.row);return{isSelection:r,fromRow:s,toRow:l,toCol:o,fromCol:n}}},{key:"makeFormat",value:function(t,a){for(var i=e.getSelected(t,!0),r=t.getSettings().columns,n=i.fromCol;n<=i.toCol;n++)switch(console.log("makeFormat for coll ="+n,a),a){case"Reset":r[n].format=!1,r[n].renderDateFormat=!1;break;case"Money":r[n].format="$0,0.00";break;case"Human":r[n].format="5a";break;case"Bytes":r[n].format="0.0b";break;case"Percentages":r[n].format="(0.00 %)";break;case"Time":r[n].renderDateFormat="HH:mm:ss";break;case"Date":r[n].renderDateFormat="YYYY-MM-DD";break;case"DateTime":r[n].renderDateFormat="YYYY-MM-DD HH:mm:ss";break;case"DateLoc":r[n].renderDateFormat="LLLL";break;case"Float":r[n].format="0.[0000000]"}t.updateSettings({columns:r}),t.render()}},{key:"isFormatColl",value:function(e,t){t=t.toLowerCase();for(var a=e.getSelectedRange(),i=Math.min(a.from.col,a.to.col),r=Math.max(a.from.col,a.to.col),n=e.getSettings().columns,o=i;r>=o;o++)if(!n[o].type.toLowerCase().includes(t))return!1;return!0}},{key:"pushToClipboardText",value:function(e){var t=document.createElement("textarea");t.style.width=0,t.style.height=0,t.style.border=0,t.style.position="absolute",t.style.top=0,document.body.append(t),t.value=e,t.focus(),t.select();try{document.execCommand("copy")}catch(a){console.log("Oops, unable to copy")}document.body.removeChild(t)}},{key:"makeCreateTable",value:function(t){for(var a=(e.getSelected(t,!0,!0),[]),i=t.getSettings().columns,r=s.fromCol;r<=s.toCol;r++){for(var n=[],o=s.fromRow;o<=s.toRow;o++)n.push(t.getDataAtCell(o,r));var l=n.filter(function(e,t,a){return a.indexOf(e)===t}),d=i[r].type.toLowerCase();d.includes("numeric")?a.push(t.colToProp(r)+" IN ( "+l.join(" , ")+") "):a.push(t.colToProp(r)+" IN ( '"+l.join("' , '")+"') ")}a="\n"+a.join("\n	AND\n")+"\n\n",console.log(a),e.pushToClipboardText(a)}},{key:"makeWhereIn",value:function(t){for(var a=e.getSelected(t,!0),i=[],r=t.getSettings().columns,n=a.fromCol;n<=a.toCol;n++){for(var o=[],s=a.fromRow;s<=a.toRow;s++)o.push(t.getDataAtCell(s,n));var l=o.filter(function(e,t,a){return a.indexOf(e)===t}),d=r[n].type.toLowerCase();d.includes("numeric")?i.push(t.colToProp(n)+" IN ( "+l.join(" , ")+") "):i.push(t.colToProp(n)+" IN ( '"+l.join("' , '")+"') ")}i="\n"+i.join("\n	AND\n")+"\n\n",console.log(i),e.pushToClipboardText(i)}},{key:"copyToClipboard",value:function(t,a,i){for(var r=e.getSelected(t,!0,i),n="",o=[],s=r.fromCol;s<=r.toCol;s++)o.push(t.colToProp(s));n=n+" | "+o.join(" | ")+" |\n",o=[];for(var l=r.fromRow;l<=r.toRow;l++){for(var d=r.fromCol;d<=r.toCol;d++)o.push(t.getDataAtCell(l,d));n=n+" | "+o.join(" | ")+" |\n",o=[]}e.pushToClipboardText(n)}},{key:"makeStyle",value:function(t,a){console.log("makeStyle",a);for(var i=e.getSelected(t,!0),r=i.fromRow;r<=i.toRow;r++)for(var n=i.fromCol;n<=i.toCol;n++){var o=t.getCellMeta(r,n),s="htCell"+a;(!o.className||o.className&&o.className.indexOf(s)<0)&&t.setCellMeta(r,n,"className",s)}t.render()}}]),e}();angular.module(smi2.app.name).service("HandsTable",HandsTable);var DrawBasicChart=function(){function DrawBasicChart(e){_classCallCheck(this,DrawBasicChart),this.widget=e,this.chart=!1,this.init=!1,this.options={},this.widget.height=1,this.widget.width=1,this.errorMessage="",this.drawCodeObject={type:!1};try{this.drawCodeObject=this.initDrawCodeObject()}catch(t){console.error("error eval ",t)}console.info("isExecutableCode()",this.isExecutableCode())}return _createClass(DrawBasicChart,[{key:"setError",value:function(e){this.errorMessage=e}},{key:"isDark",value:function(){return this.widget.isDark}},{key:"getError",value:function(){return this.errorMessage}},{key:"isExecutableCode",value:function(){return this.drawCodeObject&&this.drawCodeObject.type?this.drawCodeObject.exec:!1}},{key:"executableCode",value:function(){var e={};return this.isExecutableCode()&&(console.log(this.drawCodeObject.code),e=this.drawCodeObject.code.call(window,this.widget.data)),console.warn("ResultFunction",e),e}},{key:"initChartByJsCode",value:function(){if(this.isExecutableCode()){var e=this.executableCode();return this.options=Object.assign(this.options,e),!0}return!1}},{key:"data",value:function(){return this.widget.data.data}},{key:"meta",value:function(){return this.widget.data.meta}},{key:"isNumericColumn",value:function(e){var t=this.getColumnPosition(e);if(!_.isUndefined(t)){var a=this.meta()[t].type;return a?(a=a.toLowerCase(),a.includes("int")||a.includes("float")?!0:!1):!1}}},{key:"getColumnPosition",value:function(e){return _.findKey(this.meta(),{name:e})}},{key:"haveColumn",value:function(e){var t=this.getColumnPosition(e);return _.isUndefined(t)?!1:!0}},{key:"getDateTimeColumn",value:function(){return this.meta().forEach(function(e){return"DateTime"==e.type?e.name:void 0}),!1}},{key:"getDateColumn",value:function(){return this.meta().forEach(function(e){return"Date"==e.type?e.name:void 0}),!1}},{key:"getColumns",value:function(e){var t=_.map(this.meta(),"name");return _.isUndefined(e)?t:t[e]}},{key:"getFirstColumn",value:function(){return this.getColumns(0)}},{key:"getDrawCommandObject",value:function(){return this.drawCodeObject&&this.drawCodeObject.type?this.drawCodeObject.code:!1}},{key:"initDrawCodeObject",value:function initDrawCodeObject(){var drawCommand=this.widget.drawCommnads;if(!drawCommand)return[];var codeDrawText=!1;if(drawCommand&&drawCommand.code&&(codeDrawText=drawCommand.code),!codeDrawText)return[];var draw={code:!1,type:!1};if(_.isObject(codeDrawText))return draw={isok:!0,code:codeDrawText,type:"undefined"==typeof codeDrawText?"undefined":_typeof(codeDrawText),exec:!1};if("text"==drawCommand.drawtype.toLowerCase()){var obj=codeDrawText.trim();return draw={isok:!0,code:obj,type:"undefined"==typeof obj?"undefined":_typeof(obj),exec:!1}}try{var code="("+codeDrawText+")",_obj=eval(code),type="undefined"==typeof _obj?"undefined":_typeof(_obj);draw={isok:!0,code:_obj,type:type,exec:!!(_obj&&_obj.constructor&&_obj.call&&_obj.apply)}}catch(E){console.error("error eval ",codeDrawText,E)}return draw}}]),DrawBasicChart}(),DrawText=function(e){function t(e,a){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=a.toUpperCase(),i.library="text",i.widget.sizeX=0,i.widget.sizeY=0,i}return _inherits(t,e),_createClass(t,[{key:"preProcessor",value:function(){var e=this.getDrawCommandObject();this.init=this.applyText(e)}},{key:"applyText",value:function(e){return this.isDark()&&(this.widget.element[0].style.background="#404a59"),e?this.widget.element[0].innerHTML=Mustache.render(e,this.widget.data):this.widget.element[0].innerHTML="<pre>"+JSON.stringify(this.widget.data,null,"	")+"</pre>",!0}},{key:"onResize",value:function(){}}]),t}(DrawBasicChart),DrawEcharts=function(e){function t(e,a){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=a.toUpperCase(),i.library="echarts",i.preference={gridchart:!1,bar:!1},i.options={version:3,textStyle:{fontFamily:"Menlo"}},i}return _inherits(t,e),_createClass(t,[{key:"onResize",value:function(){this.chart&&this.init&&(this.chart.setOption(this.options),this.chart.resize())}},{key:"preProcessor",value:function(){if(this.initChartByJsCode()?this.init=!0:this.init=this.create(),this.getError())return console.error(this.getError()),this.chart.before("<p>"+this.getError()+"</p>"),!1;var e=this.getDrawCommandObject();e.raw&&(this.options=_.merge(this.options,e.raw)),this.isDark()&&(this.options.backgroundColor="#404a59"),console.info("preProcessor",this.init,this.options)}},{key:"getParameterPath",value:function(){var e=this.getDrawCommandObject(),t={path:""};e&&(t=Object.assign(t,e));var a="";if(_.isString(e)?a=e:t.path&&(a=t.path),!a)return!1;for(var i=_.split(a,"."),r=0;r<i.length;r++)if(!this.haveColumn(i[r]))return this.setError("Not set column in path :"+i[r]),!1;return i}},{key:"applyDataZoom",value:function(){this.options.dataZoom=[{type:"inside",show:!0,realtime:!0},{show:!0,realtime:!0}]}},{key:"applyLegend",value:function(){this.options.legend={data:_.map(this.options.series,"name"),x:"left"}}},{key:"applyTitle",value:function(e){this.options.title={orient:"vertical",padding:25,left:"center",text:e}}},{key:"applyGrid",value:function(){var e=[];this.options.grid=e}}]),t}(DrawBasicChart),DrawEchartsTreemap=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"getLevelOption",value:function(){return[{itemStyle:{normal:{borderWidth:0,gapWidth:5}}},{itemStyle:{normal:{gapWidth:1}}},{colorSaturation:[.35,.5],itemStyle:{normal:{gapWidth:1,borderColorSaturation:.6}}}]}},{key:"buildTreeData",value:function(e,t){var a=[],i=this;return _.forEach(e,function(e,r){var n=t[r],o={};if(o.value=n.__value,_.isObject(e)){var s=i.buildTreeData(e,n);_.isArray(s)&&s.length&&(o.children=s)}o.name=r,a.push(o)}),a}},{key:"create",value:function(){var e=this.getDrawCommandObject(),t={path:"",title:"TreeMap",tooltip:"Usage",valueformat:!1};e&&(t=Object.assign(t,e));var a="";t.path&&(a=t.path),_.isString(e)&&(a=e);var i=_.split(a,"."),r=i.length;if(!r)return this.setError("Not set path"),!1;for(var n=0;r>n;n+=1)if(!this.haveColumn(i[n]))return this.setError("bad path, no column:"+i[n]),!1;if(!this.isNumericColumn(i[r-1]))return this.setError("bad column:"+i[r-1]+" must be number"),!1;var o={},s={};this.data().forEach(function(e){for(var t=e[i[r-1]],a=[],n=0;r-1>n;n+=1){a.push(e[i[n]]);var l=_.get(o,a.join("_"),0);_.set(o,a.join(".")+".__value",parseFloat(l)+parseFloat(t))}_.set(s,a.join("."),t)});var l=this.buildTreeData(s,o),d={tooltip:{trigger:"item"}},c=echarts.format;return d.series=[{type:"treemap",name:t.title,label:{show:!0,formatter:"{b}"},tooltip:{formatter:function(e){for(var a=e.value,i=[],r=e.treePathInfo,n=1;n<r.length;n++)i.push(r[n].name);var o=t.valueformat;return o||(o="0,0.0"),['<div class="tooltip-title">'+c.encodeHTML(i.join("."))+"</div>",t.tooltip+" : "+numbro(a).format(o)].join("")}},itemStyle:{normal:{borderColor:"#fff"}},levels:this.getLevelOption(),data:l}],this.options=Object.assign(d,this.options),!0}}]),t}(DrawEcharts),DrawEchartsSunkeys=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"create",value:function(){var e=this.getDrawCommandObject(),t={path:"",value:"value",source:"source",target:"target"};e&&(t=Object.assign(t,e));var a="";if(!this.haveColumn(t.value))return this.setError("Not set column value"),!1;if(console.log("sets['path']:",t.path),_.isString(e))a=e;else if(t.path)a=t.path;else{if(!this.haveColumn(t.source)||!this.haveColumn(t.target))return this.setError("Not set column path or source & target"),!1;a=t.source+"."+t.target}var i=_.split(a,".");if(!(1&i.length))return this.setError("Path четно"),!1;var r=[],n=[];this.data().forEach(function(e){for(var t=0;t<i.length;t+=2){var a=i[t],o=i[t+1],s=i[t+2];if(_.isUndefined(o)||_.isUndefined(s))break;n[e[a]]=1,n[e[s]]=1,r.push({source:e[a],target:e[s],value:e[o]})}});var o=[];for(var s in n)o.push({name:s});var l={tooltip:{trigger:"item",triggerOn:"mousemove"},series:[{type:"sankey",data:o,links:r,itemStyle:{normal:{borderWidth:1,borderColor:"#aaa"}},lineStyle:{normal:{color:"source",curveness:.5}}}]};return this.options=Object.assign(l,this.options),!0}}]),t}(DrawEcharts),DrawEchartsRiver=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"create",value:function(){if(this.initChartByJsCode())return!0;var e=this.getDrawCommandObject(),t={x:"dt",y:"views",name:"name",title:"title"};e&&(t=Object.assign(t,e));var a={},i={},r={},n=[];this.widget.data.data.forEach(function(e){var n=parseInt(e[t.y]);_.set(a,e[t.name]+"."+e[t.x],n),i[e[t.name]]=1,r[e[t.x]]=1}),_.forEach(i,function(e,t){_.forEach(r,function(e,i){var r=_.get(a,t+"."+i,0);n.push([i,r,t])})});var o=[{type:"themeRiver",data:n,itemStyle:{emphasis:{shadowBlur:20,shadowColor:"rgba(0, 0, 0, 0.8)"}}}],s={tooltip:{trigger:"axis",axisPointer:{type:"line",lineStyle:{color:"rgba(0,0,0,0.2)",width:2,type:"solid"}}},singleAxis:{axisTick:{},axisLabel:{},type:"time",position:"top",splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.2}}},series:o};return this.options=Object.assign(this.options,s),!0}}]),t}(DrawEcharts),DrawEchartsMap=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"loadWorldMapJS",value:function(){if(window.loadWorldMapJSEcharts)return!1;console.warn("MAP >loadWorldMapJS");var e=document.createElement("script");e.type="text/javascript",e.async=!1,e.src="https://tabix.io/doc/img/echarts_world.js",e.charset="utf-8";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),window.loadWorldMapJSEcharts=!0}},{key:"create",value:function(){this.loadWorldMapJS();var e=this.getDrawCommandObject(),t={longitude:"longitude",latitude:"latitude",count:"count",name:"name",title:"Map",destination:{longitude:"destination_longitude",latitude:"destination_latitude",speed:"destination_speed",name:"destination_name",count:"destination_count"}},a=0;e&&(t=Object.assign(t,e));var i=[],r=[];this.data().forEach(function(e,n){var o=parseInt(e[t.count]);if(o>a&&(a=o),e[t.destination.longitude]&&e[t.destination.latitude]){var s="";e[t.destination.name]&&(s=e[t.destination.name]),r.push({fromName:e[t.name],toName:s,coords:[[e[t.longitude],e[t.latitude]],[e[t.destination.longitude],e[t.destination.latitude]]]})}i.push({name:e[t.name],value:[e[t.longitude],e[t.latitude],o],label:{emphasis:{position:"right",show:!0}}})});var n=[{name:t.title,type:"effectScatter",coordinateSystem:"geo",data:i,showEffectOn:"render",rippleEffect:{brushType:"stroke"},symbolSize:function(e){return a?e[2]/a*15:e[2]/1e4},hoverAnimation:!0,label:{normal:{formatter:"{b}",position:"right",show:!0}},itemStyle:{normal:{color:"#f4e925",shadowBlur:10,shadowColor:"#333"}},zlevel:1}];if(r.length>0){var o="path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z";n.push({name:t.title,type:"lines",zlevel:1,effect:{show:!0,period:6,trailLength:.7,color:"#fff",symbolSize:3},lineStyle:{normal:{width:0,curveness:.2}},data:r}),n.push({name:t.title,type:"lines",zlevel:2,symbol:["none","arrow"],symbolSize:10,effect:{show:!0,period:6,trailLength:0,symbol:o,symbolSize:15},lineStyle:{normal:{width:1,opacity:.6,curveness:.2}},data:r})}var s={tooltip:{trigger:"item"},geo:{name:t.title,type:"map",map:"world",label:{emphasis:{show:!1}},visualMap:{show:!0,min:0,max:100,inRange:{symbolSize:[6,60]}},roam:!0,itemStyle:{normal:{areaColor:"#323c48",borderColor:"#404a59"},emphasis:{areaColor:"#2a333d"}}},series:n};return this.options=Object.assign(this.options,s),!0}}]),t}(DrawEcharts),DrawEchartsHeatmap=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"create",value:function(){var e=this.getParameterPath();if(!e)return this.setError("Not set path"),!1;var t={},a={},i={};this.data().forEach(function(r){_.set(t,r[e[0]],1),_.set(a,r[e[1]],1),_.set(i,r[e[0]]+"."+r[e[1]],parseFloat(r[e[2]]))});var r=[],n=_.keys(t),o=_.keys(a),s=0,l=0;_.mapKeys(t,function(e,t){_.mapKeys(a,function(e,a){var n=_.get(i,t+"."+a,"-");s>n&&(s=n),n>l&&(l=n),r.push([t,a,n])})});var d={tooltip:{position:"top"},animation:!1,grid:{height:"50%",y:"10%"},xAxis:{type:"category",data:n,splitArea:{show:!0}},yAxis:{type:"category",data:o,splitArea:{show:!0}},visualMap:{min:s,max:l,calculable:!0,orient:"horizontal",left:"center",bottom:"15%"},series:[{name:"Punch Card",type:"heatmap",data:r,label:{normal:{show:!0}},itemStyle:{emphasis:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};return this.options=Object.assign(d,this.options),!0}}]),t}(DrawEcharts),DrawEchartsChart=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"create",value:function(){console.log("DrawEchartsChart");var e=this.getDrawCommandObject(),t=this.preCreate(e),a=this.createChart(e),i={toolbox:{show:!0,feature:{dataZoom:{yAxisIndex:"none"},dataView:{readOnly:!1},magicType:{type:["line","bar"]},restore:{},saveAsImage:{}}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0}};return e.title&&this.applyTitle(e.title),this.applyDataZoom(),this.applyLegend(),this.options=Object.assign(a,this.options,i,t),this.postCreate(e),console.info(this.options),!0}},{key:"findDateTimeAxis",value:function(){var e=this.getDateTimeColumn();if(e)return e;var t=this.getDateColumn();return t?t:!1}},{key:"postCreate",value:function(e){return{}}},{key:"preCreate",value:function(e){return{}}},{key:"createChart",value:function(e){var t={autoAxis:!0,markLine:!0,stack:!1};e&&(t=Object.assign(t,e));var a=this.getColumns(),i={},r=[],n=[],o=this.getFirstColumn(),s=this.findDateTimeAxis(),l=[];s?(o=s,n=[{name:s,type:"time",data:_.map(this.data(),s)}]):n=[{name:o,type:"category",data:_.map(this.data(),o)}];var d=[],c="",m=0;for(var u in a){var h=a[u];if(h!=o&&this.isNumericColumn(h)){var p=_.map(this.data(),h),b=_.median(p);c=h;var g={name:h,type:"line",symbolSize:8,hoverAnimation:!1,data:p};this.preference.bar&&(g.type="bar",g.barGap="-100%",g.barCategoryGap="40%"),t.markLine&&(g.markLine={data:[{name:"mediana",yAxis:b}]}),l.push(g),d.push({column:h,median:b,index:m}),m+=1}}if(console.log("colsMedianAxis",d),t.autoAxis&&d.length>1){var f=_.groupBy(d,function(e){return Math.floor(e.median/1e3)});if(_.size(f)>1){var v=function(e){var a=f[e],i=_.map(a,"column").join(",");_.forEach(a,function(e){l[e.index].yAxisIndex=r.length,t.stack&&(l[e.index].stack=i,l[e.index].areaStyle={normal:{}})}),r.push({name:i,type:"value"})};for(var y in f)v(y)}}return r.length||(r=[{name:c,type:"value"}]),i.series=l,i.yAxis=r,i.xAxis=n,i}}]),t}(DrawEcharts),DrawEchartsGridChart=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"preCreate",value:function(e){return this.preference.gridchart=!0,{}}},{key:"postCreate",value:function(e){var t=[],a=[],i=[],r=[],n=0;console.info("postCreate!!!!!!",this.options);var o=[],s=this.options.xAxis[0],l=this.options.yAxis[0];for(var d in this.options.series){d=parseInt(d);var c=this.options.series[d].name;this.options.series[d].xAxisIndex=d,this.options.series[d].yAxisIndex=n,console.log(c,this.options.series[d]),s.show=!1,s.gridIndex=d,l.gridIndex=d,l.show=!1,l.name=c,t.push({show:!0,borderWidth:0,shadowBlur:2}),i.push(_.clone(s)),a.push(_.clone(l)),r.push({textAlign:"center",text:c,textStyle:{fontSize:11,fontWeight:"normal"}}),o.push(d),n+=1}var m=Math.ceil(Math.sqrt(n));t.forEach(function(e,t){e.left=t%m/m*100+.5+"%",e.top=Math.floor(t/m)/m*100+.5+"%",e.width=1/m*100-1+"%",e.height=1/m*100-1+"%",r[t].left=parseFloat(e.left)+parseFloat(e.width)/2+"%",r[t].top=parseFloat(e.top)+"%"}),this.options.dataZoom&&this.options.dataZoom[0]&&(this.options.dataZoom[0].xAxisIndex=o),this.options.titles=r,this.options.grid=t,this.options.xAxis=i,this.options.yAxis=a}}]),t}(DrawEchartsChart),DrawEchartsBar=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"preCreate",value:function(e){
return this.preference.bar=!0,{}}}]),t}(DrawEchartsChart),DrawD3=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.library="d3",a}return _inherits(t,e),t}(DrawBasicChart),DrawC3=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.library="c3",a.bindto=!1,a}return _inherits(t,e),_createClass(t,[{key:"onResize",value:function(){this.chart&&this.init}},{key:"preProcessor",value:function(){return console.log("preProcessor>c3.generate"),this.initChartByJsCode()?(console.log("c3.options>",this.options),this.options.bindto=this.bindto,console.log("c3.options>",this.options),void(this.chart=c3.generate(this.options))):(console.error("C3.Init by code"),!1)}}]),t}(DrawBasicChart),DrawAMcharts=function(e){function t(e){_classCallCheck(this,t),console.warn("DrawAMcharts constructor");var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.library="amchart",a}return _inherits(t,e),_createClass(t,[{key:"onResize",value:function(){this.makeLegend()}},{key:"preProcessor",value:function(){this.createChart()&&(this.init=!0),console.log("!preProcessor,done",this.init,this.options)}},{key:"createChart",value:function(){var e=this,t={},a=this.widget.data.meta,i=!1,r="",n="mm",o=[],s=0,l=[];a.forEach(function(a){if("DateTime"==a.type)i="YYYY-MM-DD JJ:NN:SS",r=a.name;else if("Date"==a.type)i="YYYY-MM-DD",n="DD",r=a.name;else{if(!r)return void(r=a.name);s+=1;var d=e.getChartGraph(a,t[a.name]);d.id="g"+s,"v1"!==d.valueAxis&&l.push(d.valueAxis),o.push(d)}});var d={theme:Widget.isDark?"dark":"light",color:Widget.isDark?"#eee":"#333",type:"serial",categoryField:r,valueAxes:[{id:"v1",axisAlpha:1,gridAlpha:.07,axisColor:Widget.isDark?"#eee":"#333",gridColor:Widget.isDark?"#eee":"#333",ignoreAxisWidth:!0}],balloon:{borderThickness:1,shadowAlpha:0},graphs:o,chartCursor:{valueLineEnabled:!0,valueLineBalloonEnabled:!0,cursorAlpha:0,zoomable:!1,valueZoomable:!0,valueLineAlpha:.5},chartScrollbar:{graph:"g1",gridAlpha:0,color:"#888888",scrollbarHeight:25,backgroundAlpha:0,selectedBackgroundAlpha:.1,selectedBackgroundColor:"#888888",graphFillAlpha:0,autoGridCount:!0,selectedGraphFillAlpha:0,graphLineAlpha:.2,graphLineColor:"#c2c2c2",selectedGraphLineColor:"#888888",selectedGraphLineAlpha:1},categoryAxis:{dashLength:1,minorGridEnabled:!0,axisColor:Widget.isDark?"#eee":"#333",gridColor:Widget.isDark?"#eee":"#333"},data:this.widget.data.data};if(d.categoryAxis.parseDates=!1,i&&(d.dataDateFormat=i,d.categoryAxis.parseDates=!0,d.categoryAxis.minPeriod=n),l){var c=0;l.forEach(function(e){c++;var t={id:e,axisAlpha:1,axisThickness:1,position:"right",ignoreAxisWidth:!0,offset:1*c};d.valueAxes.push(t)})}return this.options=d,this.init=!0,this.makeLegend(),!0}},{key:"makeLegend",value:function(){console.log("this.widget.sizeY",this.widget.sizeY),this.widget.sizeY<2?delete this.options.legend:this.options.legend={align:"center",equalWidths:!1,periodValueText:"total: [[value.sum]]",valueAlign:"left",valueText:"[[value]] ([[percents]]%)",valueWidth:100},console.warn(this.options)}},{key:"getChartGraph",value:function(e,t){var a=e.name,i=e.name,r="v1";a=a.replace(/_axis\d+/gm,"");var n=/.*_axis(\d+).*/i,o=i.match(n);o&&o[1]&&(r="v"+o[1]);var s={id:"g1",valueAxis:r,fillAlphas:.2,bullet:"round",bulletSize:8,hideBulletsCount:50,lineThickness:1,title:a,useLineColorForBulletBorder:!0,valueField:i,type:"smoothedLine",balloonText:"[[title]] [[category]]<br><b><span style='font-size:14px;'>[[value]]</span></b>"};return t||(t={}),Object.assign(s,t)}}]),t}(DrawBasicChart),DataProvider=function(){function e(t,a){_classCallCheck(this,e),this.data=t.data,this.text=!1,this.sort=!1,this.sortOrder=!1,t.error||angular.isObject(t.data)||(angular.isString(t.data)?this.text=t.data:this.text=angular.toJson(t.data,!0)),a||(a="ch"),this.sourceType=a,this.meta=t.meta,t.query?this.query=t.query:this.query={index:0,drawCommands:!1},t.error?this.error=t.error:this.error=!1,this.draw=this.query.drawCommands,this.rows=t.rows,this.position=this.query.index,this.countAll=t.countAllQuery}return e.$inject=["result","sourceType"],_createClass(e,[{key:"isText",value:function(){return this.text?!0:!1}},{key:"isError",value:function(){return this.error?!0:!1}},{key:"getError",value:function(){return this.error}},{key:"data",value:function(){return this.data}},{key:"meta",value:function(){return this.meta}},{key:"toString",value:function(){return"("+this.name+", "+this.y+")"}}],[{key:"convertArrayToDataProvider",value:function(t,a){var i={};return i.data=t,i.meta=[],i.error=!1,i.query={drawCommands:!1},i.rows=t.length,i.position=0,i.countAll=0,Object.keys(t[0]).map(function(e){return i.meta.push({name:e,type:"string"})}),new e(i,a)}}]),e}();angular.module(smi2.app.name).service("DataProvider",DataProvider),/*
 * Copyright (c) 2017. Smi2
 */
angular.module(smi2.app.name).directive("pivot",[function(){return{restrict:"AE",scope:{data:"=",config:"=",editMode:"="},link:function(e,t,a){var i=$.extend($.pivotUtilities.renderers);null==e.config&&(e.config={rows:[],cols:[]}),e.renderPivotTable=function(){$(t).pivot(e.data,{renderers:i,rendererName:"Table",cols:e.config.cols,rows:e.config.rows,onRefresh:function(t){var a=JSON.parse(JSON.stringify(t));delete a.aggregators,delete a.renderers,delete a.derivedAttributes,delete a.rendererOptions,delete a.localeStrings,e.config=a,e.$apply()}})},e.renderPivotUITable=function(){$(t).pivotUI(e.data)},e.$watch("scope.editMode",function(t,a){console.log("watch"+e.editMode),t&&(e.editMode?e.renderPivotUITable():e.renderPivotTable())},!0),e.renderPivotUITable()}}}]),function(e,t){function a(e){return function(t,a,i){var r=e(i.ngRightClick);a.bind("contextmenu",function(e){t.$apply(function(){e.preventDefault(),r(t,{$event:e})})})}}e.module(t.app.name).directive("ngRightClick",a),a.$inject=["$parse"]}(angular,smi2),function(e,t){function a(){return{restrict:"A",require:"mdMenu",link:function(t,a,i,r){t.$mdOpenMousepointMenu=function(t){var a=e.element(t.currentTarget).offset();r.offsets=function(){return{left:t.pageX-a.left,top:t.pageY-a.top+8}},r.open(t)}}}}e.module(t.app.name).directive("mousepointMenu",a)}(angular,smi2),/*
 * Copyright (C) 2017 IgorStrykhar  in  SMI2
 * All rights reserved.
 * GPLv3
 */
function(e,t){function a(t,a,i){var r="";if("echarts"==t.draw.library){var n="macarons";t.isDark&&(n="dark"),t.draw.chart=echarts.init(a[0],n),r=!1}return"c3"==t.draw.library&&(t.draw.bindto=a[0],r=!1),"text"==t.draw.library&&(t.element=e.element('<div style="width: 100%;height: 100%">&nbsp;</div>'),r=!1),"d3"==t.draw.library&&console.info("DW:d3"),"amchart"==t.draw.library&&(r='<am-chart options="widget.draw.options" height="100%"  width="100%"></am-chart>'),console.group("widget.draw.preProcessor"),console.time("widget.draw.preProcessor time took"),t.draw.preProcessor instanceof Function&&t.draw.preProcessor(),console.timeEnd("widget.draw.preProcessor time took"),console.groupEnd(),r}function i(t,i,r){return function(n,o,s){if(console.warn("buildLinkFunc:!!!!!!!!!!!!",n.widget.type),n.widget.isDark=n.isdark,n.widget.preProcessor instanceof Function&&n.widget.preProcessor(),!n.widget.error&&!n.widget.textformat){if("table"!=n.widget.type||n.widget.error||(n.widget.element=e.element('<hot-table\n                        hot-id="'+n.widget.hotId+'"\n                        settings="widget.table.settings"\n                        datarows="widget.data.data"\n                        ng-class="{\'handsontable-dark\': widget.isDark}"\n                     \n                        col-headers="widget.table.colHeaders"\n                        manual-column-resize="true"\n                    ></hot-table>'),n.widget.hotRegisterer=r),"draw"==n.widget.type&&!n.widget.error){n.widget.element=!1;var l=a(n.widget,o,i);l&&(n.widget.element=e.element(l))}"pivot"!=n.widget.type||n.widget.error||(n.widget.element=e.element('<pivot style=" transition: none !important;" data="widget.data.data" config="widget.pivot.config" edit-mode="true"></pivot>')),n.widget.element&&(o.append(n.widget.element),t(n.widget.element)(n)),n.widget.scheduledResize(),n.$watch("widget.sizeY",function(){n.widget.scheduledResize()},!0),n.$watch("widget.sizeX",function(){n.widget.scheduledResize()},!0),e.element(window).on("resize",function(e){n.$broadcast("resize")}),n.events={resize:function(e,t){i(function(){console.log("scope.events.resize"),t.widget.scheduledResize()},200)}}}}}e.module(t.app.name).directive("drawWidget",["$compile","$timeout","hotRegisterer",function(e,t,a){return{restrict:"EA",template:'<div style="width: 100%;height: 100%"></div>',scope:{widget:"=widget",isdark:"=isdark"},replace:!0,link:i(e,t,a)}}])}(angular,smi2),function(){var e=angular.module("angular-pivottable",[]);e.directive("ngPivot",function(){return{restrict:"A",link:function(e,t,a){var i=function(e,a){if(void 0===e)throw"Invalid data input on angular-pivot directive :) -";t.pivotUI(e)};if("undefined"!=typeof google)google.load("visualization","1.0",{packages:["corechart","charteditor"],callback:function(){var t=($.pivotUtilities.derivers,$.extend($.pivotUtilities.renderers,$.pivotUtilities.gchart_renderers)),r={renderers:t};i(e.$eval(a.ngPivot),r)}});else{i(e.$eval(a.ngPivot),r);var r={}}e.$watch(a.ngPivot,function(e){i(e,r)})}}})}(),function(e,t){function a(e,t,a,i,r,n,o){e.vars={searchline:"",loaded:!1,error:!1,databases:[]},e.vars.scrollConfig={autoHideScrollbar:!1,theme:r.isDark()?"light":"dark",scrollButtons:{enable:!1},scrollInertia:400,advanced:{updateOnContentResize:!0}},e.vars.metis={config:{toggle:!1,preventDefault:!1}},e.$watch("vars.searchline",function(t){t.length<2?(console.warn("reset, search box"),e.vars.databases.forEach(function(t,a){e.vars.databases[a].active=!0,t.tables.forEach(function(t,i){e.vars.databases[a].tables[i].active=!0,t.fields.forEach(function(t,r){e.vars.databases[a].tables[i].fields[r].active=!0})})})):e.filterCompletions(t)}),e.clickInsertField=function(e){t.$emit("handleBroadcastInsertInActive",{value:" "+e.name+",\n"})},e.clickAndSelect=function(a,i){return a.name==t.currentDatabase?(i.stopPropagation(),!1):void e.selectDatabase(a)},e.selectDatabase=function(e){t.currentDatabase=e.name,o.show(o.simple().content("USE "+e.name+" database").theme(r.theme).position("bottom right")),n("tableSiedenav").close()},e.openTable=function(e){n("tableSiedenav").close(),t.currentDatabase!=e.database&&(o.show(o.simple().content("USE "+e.database+" database").theme(r.theme).position("bottom right")),t.currentDatabase=e.database),t.currentTable=e.name,n("tableSiedenav").open()},t.$on("handleBroadcastDatabases",function(){e.reLoad()}),e.filterCompletions=function(t){console.log(">>>filterCompletions",t);var a={},i=t.toUpperCase(),r=t.toLowerCase();e.vars.databases.forEach(function(e,n){e.tables.forEach(function(o,s){o.fields.forEach(function(l,d){var c={},m=o.name+"."+l.name;if(m){for(var u=-1,h=0,p=0,b=void 0,g=void 0,f=0;f<t.length;f++){var v=m.indexOf(r[f],u+1),y=m.indexOf(i[f],u+1);if(b=v>=0&&(0>y||y>v)?v:y,0>b)return;g=b-u-1,g>0&&(-1===u&&(p+=10),p+=g),h|=1<<b,u=b}c.matchMask=h,c.exactMatch=p?0:1,c.score=(c.score||0)-p,c.dbase=e.name,c.table=o.name,c.field=l.name,a[n]||(a[n]={}),a[n][s]||(a[n][s]={}),a[n][s][d]=c}})})}),e.vars.databases.forEach(function(t,i){a[i]?e.vars.databases[i].active=!0:e.vars.databases[i].active=!1,t.tables.forEach(function(t,r){a[i]&&a[i][r]?e.vars.databases[i].tables[r].active=!0:e.vars.databases[i].tables[r].active=!1,t.fields.forEach(function(t,n){a[i]&&a[i][r]&&a[i][r][n]?e.vars.databases[i].tables[r].fields[n].active=!0:e.vars.databases[i].tables[r].fields[n].active=!1})})})},e.rightMenuProcessTable=function(e){var a=e.item.name,r=e.item.database;"OpenTables"==e.key?window.location="/database/"+r+"/table/"+a:"InsertDescribe"==e.key&&i.query("SELECT * FROM system.columns WHERE database='"+r+"' AND table='"+a+"'").then(function(e){var i=[],n=[];e.data.forEach(function(e){i.push(e.name),"Date"==e.type&&n.push(e.name+"=today()")});var o="\nSELECT\n	"+i.join(",\n	")+"\nFROM\n	"+r+"."+a+"\n";n.length&&(o=o+"\nWHERE\n	"+n.join("\n AND \n")),o+="\nLIMIT 100\n\n",console.log(o),t.$emit("handleBroadcastInsertInActive",{value:o})})},e.reLoad=function(){var t=[];i.query("SELECT * FROM system.columns").then(function(a){var r=a.data||[];r.forEach(function(e){t[e.database+"."+e.table]||(t[e.database+"."+e.table]=[]),t[e.database+"."+e.table].push({name:e.name,type:e.type,active:!0})}),i.query("SELECT database,name,engine FROM system.tables").then(function(a){var r=a.data||[];e.vars.databases=r.reduce(function(e,a){var i=[{active:!0,value:"Open table",key:"OpenTables",icon:"arrow-expand",item:a},{active:!0,value:"Code Select from",key:"InsertDescribe",icon:"format-size",item:a}],r="";a.engine.match(/Distributed.*/)&&(r="soundcloud"),a.engine.match(/AggregatingMergeTree.*/)&&(r="cube"),a.engine.match(/MaterializedView.*/)&&(r="border-bottom"),a.engine.match(/SummingMergeTree.*/)&&(r="table-row-plus-after"),a.engine.match(/CollapsingMergeTree.*/)&&(r="table-row-height"),a.engine.match(/$Merge^/)&&(r="source-fork"),a.active=!0,a.classEngine=r,a.rightMenuListTable=i;var n=!0,o=!1,s=void 0;try{for(var l,d=e[Symbol.iterator]();!(n=(l=d.next()).done);n=!0){var c=l.value;if("-"!==a.name&&c.name==a.database)return c.tables.push({active:!0,database:a.database,name:a.name,engine:a.engine,classEngine:a.classEngine,fields:t[a.database+"."+a.name],rightMenuList:a.rightMenuListTable}),e}}catch(m){o=!0,s=m}finally{try{!n&&d["return"]&&d["return"]()}finally{if(o)throw s}}return[].concat(_toConsumableArray(e),[{name:a.database,tables:[{active:!0,database:a.database,name:a.name,engine:a.engine,classEngine:a.classEngine,rightMenuList:a.rightMenuListTable,fields:t[a.database+"."+a.name]}]}])},[]),e.selectDatabase(e.vars.databases[0]),i.query("SELECT name FROM system.databases").then(function(t){var a=t.data||[];a.forEach(function(t){var a=!1;e.vars.databases.forEach(function(e){e.name==t.name&&(a=!0)}),a||e.vars.databases.push({name:t.name,tables:[],active:!0})}),e.vars.loaded=!0,e.vars.error=!1},function(){e.vars.loaded=!0,e.vars.error=!0})},function(){e.vars.loaded=!0,e.vars.error=!0})},function(){e.vars.loaded=!0,e.vars.error=!0})},e.reLoad()}e.module(t.app.name).controller("SidebarController",a),a.$inject=["$scope","$rootScope","$state","API","ThemeService","$mdSidenav","$mdToast"]}(angular,smi2),function(e,t){function a(a,i,r,n,o){a.user=r.getConnectionInfo().name,a.themes=n.list,a.help=function(a){function i(e,a){e.vars={version:t.app.version,buildDate:t.app.buildDate},e.hide=function(){a.hide()},e.cancel=function(){a.cancel()},e.answer=function(e){a.hide(e)}}i.$inject=["$scope","$mdDialog"],o.show({controller:i,templateUrl:"app/base/helpDialogRu.html",parent:e.element(document.body),targetEvent:a,clickOutsideToClose:!0})},a.logout=function(){r.clear(),i.go("login")},a.setUiTheme=function(e){return n.set(e.name)}}e.module(t.app.name).controller("HeaderController",a),a.$inject=["$scope","$state","API","ThemeService","$mdDialog"]}(angular,smi2),function(){angular.module(smi2.app.name).run(["$rootScope","$state",function(e,t){e.breadcrumbs=[],e.currentDatabase=null;var a=e.$on("$stateChangeError",function(e,a,i,r,n,o){"notAuthorized"==o&&t.go("login")});e.$on("$destroy",function(){return a})}])}(),function(e,t){e.module(t.app.name).config(["$stateProvider",function(t){t.state("base",{"abstract":!0,resolve:{session:["$q","API",function(t,a){var i=t.defer();return e.isDefined(a.getConnectionInfo().host)?i.resolve():i.reject("notAuthorized"),i.promise}]},templateUrl:"app/base/base.html"}).state("layout",{parent:"base","abstract":!0,views:{header:{templateUrl:"app/base/header.html",controller:"HeaderController"},sidebar:{templateUrl:"app/base/sidebar.html",controller:"SidebarController"},main:{template:"<ui-view/>"}}}).state("dashboard",{parent:"layout",url:"/",controller:["$state",function(e){e.go("sql")}]}).state("login",{url:"/login",templateUrl:"app/login/login.html",controller:"LoginController"}).state("sql",{parent:"layout",url:"/sql",templateUrl:"app/sql/sql.html",controller:"SqlController"}).state("table",{parent:"layout",url:"/database/{dbName}/table/{tableName}",templateUrl:"app/table/table.html",controller:"TableController"}).state("processes",{parent:"layout",url:"/processes",templateUrl:"app/processes/processes.html",controller:"ProcessesController"}).state("metrics",{parent:"layout",url:"/metrics",templateUrl:"app/metrics/metrics.html",controller:"MetricsController"}).state("404",{parent:"layout",templateUrl:"app/base/404.html"})}])}(angular,smi2),function(e,t){e.module(t.app.name).config(["$locationProvider","$httpProvider","$sceProvider","$urlRouterProvider","$mdThemingProvider","ThemeServiceProvider",function(e,t,a,i,r,n){e.html5Mode(!0).hashPrefix("!"),t.interceptors.push("HttpInterceptor"),a.enabled(!1),i.otherwise(function(e){var t=e.get("$state");t.transitionTo("404")}),n.$get().isDark()&&r.theme("default").dark().primaryPalette("blue").accentPalette("blue",{"default":"500"})}]).config(["$translateProvider",function(e){e.translations("en",{"Подключение":"Connection","Неверные данные":"some data is wrong","Название":"name","Хост:порт":"host:port","Логин":"login","Пароль":"password","Удалить":"Delete","Войти":"Sign in","не найдено":"not found","нет данных":"no data","Назад":"Back","Выход":"Sing out","Шрифт":"font","История запросов пуста":"Requests's history is empty","Структура":"Structure","Данные":"Data","Параметры":"Params","Информация":"Information","Размер":"Size","Размер, байт":"Size in bytes","Первая запись":"First record","Последняя запись":"Last record","Тип":"Type","Default тип":"Default type","Значение":"Default value","Рабочий стол":"Dashboard","База":"Database","Выполнить ⌘ + ⏎":"Run ⌘ + ⏎","Таблица":"Table","Таблица ":"Table ","Хотите покинуть страницу?":"Do you want to leave this page?","Ошибка":"Error","Не введен SQL":"SQL request is empty","Выполнить выделенное ⌘ + ⏎":"Run selected ⌘ + ⏎","Выполнить все ⇧ + ⌘ + ⏎":"Run all ⇧ + ⌘ + ⏎","Просмотр":"Preview","Ошибка ":"Error ","Сохранить":"Save","Лог запросов":"Request's log","Тема интерфейса":"Theme","Тема":"Theme","Максимум строк":"Maximum lines","Настройки редактора":"Editor settings","Закрыть":"Close","Размер шрифта":"Font size","Формат результатов":"Result's format","Тема редактора":"Editor theme","Сохранять сессию":"Save session","На весь экран":"Full screen","Словари":"Dictionaries","CSV с заголовком":"CSV with headers","CSV без заголовка":"CSV without headers","Табулированный текст с заголовками":"Tabulated text with headers","Табулированный текст без заголовков":"Tabulated text without headers","время":"time","строк прочитано":"lines read","прочитано":"read","SQL изменен. Сохранить перед закрытием?":"SQL was changed. Save it before exit?","Да":"Yes","Нет":"No","Светлая тема":"Light theme","Темная тема":"Dark theme","с":"from","по":"to","Открыть таблицу":"Open table","Метрики":"Metrics","Метрики и список процессов":"Metrics & Processes","Поиск":"Search","Справка":"Help","Список процессов":"Processes","История зарпросов":"Query log",";; Двойной":";; Double","; Одинарный":"; Single","Разделитель запросов":"Delimiters queries","Сборка":"Build","СМИ2":"Smi2","Сервер":"Server",Config:"Config","Config Key":"Config Key","все права защищены":"all rights reserved","Привязка":"Pinned","Обновить":"Refresh","Очистить":"Reset","Максимально точек":"Max points","Частота обновления":"Frequency","сек":"sec","Обновление отключено":"Disable refresh","Логирование":"Logs","Перенос строк":"TextWrap","Искать на сервере":"Search on server","Обзор":"Overview"}).translations("ru",{}).useMissingTranslationHandlerLog().registerAvailableLanguageKeys(["en","ru"],{"*":"en"}).determinePreferredLanguage()}])}(angular,smi2);