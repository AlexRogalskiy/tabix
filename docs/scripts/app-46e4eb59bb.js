"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e=window.smi2=window.smi2||{};e.app={name:"SMI2",version:window.clickhouseGuiVersion||""},// External libs connection
angular.module(e.app.name,["ngAnimate","ui.router","LocalStorageModule","angularScreenfull","ui.ace","ui.grid","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.exporter","ui.grid.selection","angularResizable","ngSanitize","ngMaterial","funMetisMenu","ngScrollbars","ngCsv","pascalprecht.translate","cfp.hotkeys","ngHandsontable","amChartsDirective"]).directive("ngRightClick",["$parse",function(e){return function(t,a,n){var i=e(n.ngRightClick);a.bind("contextmenu",function(e){t.$apply(function(){e.preventDefault(),i(t,{$event:e})})})}}]).directive("mousepointMenu",[function(){return{restrict:"A",require:"mdMenu",link:function(e,t,a,n){// var prev = { x: 0, y: 0 };
e.$mdOpenMousepointMenu=function(e){n.offsets=function(){return{left:e.offsetX,top:e.offsetY}},n.open(e)}}}}])}(),angular.module("SMI2").run(["$templateCache",function(e){e.put("app/base/404.html",'<div class="p++"><h2 class="mt0">404 {{\'не найдено\' | translate}}</h2><md-button class="ml0 md-raised md-primary" ui-sref="dashboard"><i class="mdi mdi-arrow-left"></i> {{ \'Назад\' | translate }}</md-button></div>'),e.put("app/base/base.html",'<div class="wrapper"><header ui-view="header" class="header-view"></header><div class="content"><div ui-view="sidebar" ng-class="{\'show\': showSidebar}" class="sidebar-view" resizable="" r-directions="[\'right\']" r-width="200" r-flex="true"></div><div class="main-content"><div ui-view="main" style="height: 100%"></div><md-sidenav class="md-sidenav-right md-whiteframe-4dp md-sidenav-fix" md-component-id="tableSiedenav"><md-content ng-if="currentTable" layout-padding=""><md-button class="md-icon-button right-button" ui-sref="table({tableName:currentTable, dbName:currentDatabase})"><i class="mdi mdi-arrow-expand-all"></i><md-tooltip md-direction="left">{{\'Открыть таблицу\' | translate}}</md-tooltip></md-button><div class="h100" ng-include="\'app/table/table-container.html\'" ng-controller="TableContainerController" ng-init="initContainer()"></div></md-content></md-sidenav></div></div></div>'),e.put("app/base/breadcrumbs.html",'<ol ng-if="$root.breadcrumbs" class="breadcrumb p+"><li class="home-item"><a ui-sref="dashboard" lx-ripple="lx-ripple" class="btn btn--xs btn--white btn--fab"><i class="mdi mdi-home"></i></a></li><li ng-repeat="nav in $root.breadcrumbs" class="breadcrumb-item"><i class="icon tc-white icon--xs mdi mdi-chevron-right"></i> <a ng-if="!$last" ui-sref="{{nav.link}}(nav.params)" class="btn btn--xs btn--white btn--raised">{{nav.text}}</a> <span ng-if="$last" class="tc-white">{{nav.text}}</span></li></ol>'),e.put("app/base/header.html",'<div class="header"><md-card class="m0 pl0"><div><div class="pull-left" style="width: 180px"><img src="assets/images/logo.png" class="logo mr"> <a ui-sref="dashboard" class="tc-white">Query.Life</a></div><div class="pull-right"><md-menu md-position-mode="target-right target"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-24px mdi-theme-light-dark"></i><md-tooltip>{{\'Тема\' | translate}}</md-tooltip></md-button><md-menu-content><md-menu-item ng-repeat="theme in themes"><md-button ng-click="setUiTheme(theme)">{{theme.title}}</md-button></md-menu-item></md-menu-content></md-menu><md-button aria-label="menu" class="md-icon-button" ui-sref="processes"><i class="mdi mdi-24px mdi-playlist-play"></i><md-tooltip>Список процессов</md-tooltip></md-button><md-button aria-label="menu" class="md-icon-button" ui-sref="sql"><i class="mdi mdi-24px mdi-console"></i><md-tooltip>SQL</md-tooltip></md-button><md-button class="md-icon-button" aria-label="{{\'Выход\' | translate}}" ng-click="logout()"><i class="mdi mdi-24px mdi-lock"></i><md-tooltip>{{\'Выход\' | translate}}</md-tooltip></md-button><span class="header-user-name hide-sm p+">{{user}}</span></div></div></md-card></div>'),e.put("app/base/sidebar.html",'<div class="sidebar" ng-app="sidebar" ng-scrollbars="" ng-scrollbars-config="vars.scrollConfig"><fun-metis-menu ng-if="vars.loaded && !vars.error" fun-metis-config="vars.metis.config" fun-metis-events="vars.metis.events" class="metismenu"><nav><ul><li ng-class="active"><a><md-button class="text-left no-txt-transform w200"><i class="mdi mdi-server"></i> Server <span class="pull-right" style="color: silver"></span></md-button></a><ul class="sub-menu"><li ng-repeat="database in vars.databases" ng-class="currentDatabase==database.name?\'active\':\'\'"><a><md-button class="text-left no-txt-transform w100" ng-click="clickAndSelect(database, $event)"><i class="mdi mdi-database"></i>{{database.name}} <span class="pull-right" style="color: silver">{{database.tables.length}}</span></md-button></a><ul class="sub-menu" ng-if="database.tables.length"><li ng-repeat="table in database.tables"><a><md-button class="text-left no-txt-transform" ng-dblclick="openTable(table)"><i ng-if="table.classEngine" class="mdi mdi-{{table.classEngine}}"></i> <i ng-if="!table.classEngine" class="mdi mdi-table"></i> {{table.name}}</md-button></a><ul class="sub-menu"><li ng-repeat="field in table.fields" class="text-left" style="font-size: 70%;" ng-click="clickInsertField(field)">{{field.name}}</li></ul></li></ul></li></ul></li></ul></nav></fun-metis-menu><div ng-if="vars.loaded && vars.error" class="mt+">No connect, or Error. See console log</div></div>'),e.put("app/login/login.html",'<div class="wrapper"><div class="header header-view"><md-card class="m0 pl0"><div><div class="mr pull-left"><img src="assets/images/logo.png" class="logo"></div><div class="pull-left"><a ui-sref="dashboard" class="tc-white">Clickhouse</a></div><div class="pull-right"><md-menu md-position-mode="target-right target"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-24px mdi-theme-light-dark"></i></md-button><md-menu-content><md-menu-item ng-repeat="theme in vars.themes"><md-button ng-click="setUiTheme(theme)">{{theme.title}}</md-button></md-menu-item></md-menu-content></md-menu></div></div></md-card></div><div class="content"><div class="sidebar-view login"><md-card class="m0 h100" style="width: 180px"><div ng-repeat="base in vars.bases"><md-button class="menu-button" ng-click="vars.db = base"><span class="menu-button__title">{{base.name}}</span> <span class="menu-button__subtitle">{{base.host}}</span></md-button></div></md-card></div><div class="main-content login"><div class="main-view"><div class="login-view"><md-tabs md-dynamic-height="" md-border-bottom="" class="login-tabs"><md-tab><md-tab-label>Direct</md-tab-label><md-tab-body><md-card md-theme="{{ showDarkTheme ? \'dark-grey\' : \'default\' }}" md-theme-watch=""><form class="p++" name="loginForm"><div><md-input-container><label>{{\'Название\' | translate}}</label> <input ng-model="vars.db.name" required="" placeholder="dev" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Хост:порт\' | translate}}</label> <input ng-model="vars.db.host" placeholder="http://127.0.0.1:8123" required="" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Логин\' | translate}}</label> <input ng-model="vars.db.login" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Пароль\' | translate}}</label> <input type="password" ng-model="vars.db.password" ng-click="onKeypress($event)" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Параметры\' | translate}}</label> <input ng-model="vars.db.params" placeholder="key1=value&key2=value" ng-disabled="vars.loading"></md-input-container></div><div layout="row"><div flex=""><md-button class="md-primary md-raised m0 width-100" ng-disabled="loginForm.$invalid || vars.loading" ng-click="login()">{{\'Войти\' | translate}}</md-button></div><div flex="" ng-if="vars.db.id" class="pl"><md-button class="md-raised md-warn m0 width-100" ng-disabled="vars.loading" ng-click="remove()">{{\'Удалить\' | translate}}</md-button></div></div></form></md-card></md-tab-body></md-tab><md-tab><md-tab-label>uxData Grider</md-tab-label><md-tab-body><md-card md-theme="{{ showDarkTheme ? \'dark-grey\' : \'default\' }}" md-theme-watch=""><form class="p++" name="loginServerForm"><div><md-input-container><label>{{\'Сервер\' | translate}}</label> <input ng-model="vars.db.srvname" required="" placeholder="dev" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Логин\' | translate}}</label> <input ng-model="vars.db.srvlogin" ng-disabled="vars.loading"></md-input-container></div><div><md-input-container><label>{{\'Пароль\' | translate}}</label> <input type="password" ng-model="vars.db.srvpassword" ng-click="onKeypress($event)" ng-disabled="vars.loading"></md-input-container></div><div layout="row"><div flex=""><md-button class="md-primary md-raised m0 width-100" ng-disabled="vars.loading" ng-click="login()">{{\'Войти\' | translate}}</md-button></div></div></form></md-card></md-tab-body></md-tab></md-tabs></div></div><div class="footer"><md-card class="m0 p"><div><a href="https://github.com/smi2/clickhouse-frontend" target="_blank" class="pull-right"><i class="mdi mdi-github-circle mdi-24px"></i></a><p class="copyright text-center" style="line-height: 24px"><a href="https://github.com/smi2" target="_blank" class="tc-white">{{\'СМИ2\' | translate}}</a> &copy; {{::vars.year}}, {{\'все права защищены\' | translate}}. {{\'Сборка\' | translate}} {{::vars.version}}</p></div></md-card></div></div></div></div>'),e.put("app/processes/processes.html",'<div class="pr+ pt+ pull-right"><md-input-container class="mb++ mr+"><label>{{\'Частота обновления\' | translate}}</label><md-select ng-model="vars.interval" ng-change="setInterval()"><md-option ng-repeat="interval in [-1, 1, 5, 10, 20, 30]" ng-value="interval">{{interval == -1 ? \'Обновление отключено\' : interval + \' сек\'}}</md-option></md-select></md-input-container><md-input-container class="mb++"><label>{{\'Сортировка\' | translate}}</label><md-select ng-model="vars.sort" ng-change="setSort()"><md-option ng-repeat="col in vars.cols" ng-value="col">{{col}}</md-option></md-select></md-input-container></div><h4 class="pl pt">{{\'Список процессов\' | translate}}</h4><div class="card__actions pl pr+ pt+ pb" style="position:absolute; top:46px; bottom:0;left:0;right:0; overflow:hidden;" ng-scrollbars="" ng-scrollbars-config="vars.scrollConfig"><span ng-if="vars.data === null && !vars.loading" class="fs-caption">{{\'нет данных\' | translate}}</span><md-progress-circular ng-if="vars.loading" class="md-accent" md-diameter="40"></md-progress-circular><div ng-if="vars.data !== null && vars.data != -1" ng-bind-html="vars.data"></div></div>'),e.put("app/sql/renderResult.html",'<div ng-controller="FooterCtrl as footer"><md-tab ng-repeat="result in tab.results"><md-tab-label>{{::result.time}} <i class="mdi mdi-18px ml+" ng-class="result.pinned ? \'mdi-pin\' : \'mdi-pin-off\'" ng-click="result.pinned = !result.pinned; $event.stopPropagation()"></i> <i class="mdi mdi-close" ng-click="removeResult(tab, result, $event)"></i></md-tab-label><md-tab-body><div ng-repeat="item in result.data"><md-tabs md-dynamic-height="" md-selected="vars.selectedIndex" md-border-bottom="" md-autoselect=""><md-tab><md-tab-label>Table</md-tab-label><md-tab-body><md-card class="m0"><div><div class="pull-left" ng-if="item.statistics"><md-button aria-label="menu" class="md-icon-button" ng-click="addDictionariesWord(item.createtable)" ng-if="item.createtable"><i class="mdi mdi-table-large"></i></md-button><md-menu md-position-mode="target"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-file-excel"></i></md-button><md-menu-content><md-menu-item><md-button ng-csv="getExportData(item.data)" quote-strings=\'"\' filename="{{tab.name}}-{{result.time}}.csv" csv-header="getExportHeaders(item.meta)">{{\'CSV с заголовком\' | translate}}</md-button></md-menu-item><md-menu-item><md-button ng-csv="getExportData(item.data)" quote-strings=\'"\' filename="{{tab.name}}-{{result.time}}.csv">{{\'CSV без заголовка\' | translate}}</md-button></md-menu-item><md-menu-item><md-button ng-csv="getExportData(item.data)" quote-strings="" filename="{{tab.name}}-{{result.time}}.txt" field-separator="\\t" csv-header="getExportHeaders(item.meta)">{{\'Табулированный текст с заголовками\' | translate}}</md-button></md-menu-item><md-menu-item><md-button ng-csv="getExportData(item.data)" quote-strings="" filename="{{tab.name}}-{{result.time}}.txt" field-separator="\\t" csv-header="getExportHeaders(item.meta)">{{\'Табулированный текст без заголовков\' | translate}}</md-button></md-menu-item></md-menu-content></md-menu></div><div style="white-space: nowrap; line-height: 40px" class="md-card pull-right mr" ng-if="item.statistics">{{\'время\' | translate}}: <b>{{item.statistics.elapsed | number:3}}</b>, {{\'строк прочитано\' | translate}}: <b>{{item.statistics.rows_read | number}}</b>, {{\'прочитано\' | translate}}: <b>{{item.statistics.bytes_read | filesize}}</b></div></div></md-card><span ng-if="item.result === null">{{\'нет данных\' | translate}}</span><div ng-if="item.result !== null" ng-bind-html="item.result" style="overflow-x: auto; overflow-y: auto; width: 100%; min-height: 40px"></div></md-tab-body></md-tab><md-tab md-on-select="initChart(item.meta,item.data,item.query)"><md-tab-label>amChart <i class="mdi mdi-show-chart"></i></md-tab-label><md-tab-body><md-card md-theme-watch=""><div><div id="myFirstChart" style="height:500px;width:100%;border: 1px silver dotted"></div></div></md-card></md-tab-body></md-tab><md-tab md-on-select="initPivot(item.meta,item.data,item.query)"><md-tab-label>Pivot <i class="mdi mdi-pages"></i></md-tab-label><md-tab-body><div id="pivotDiv" style="width:600px; height:100%"></div></md-tab-body></md-tab><md-tab md-on-select="initSankeys(item.meta,item.data,item.query)"><md-tab-label>Sankeys <i class="mdi mdi-pages"></i></md-tab-label><md-tab-body><div id="sunkeyDiv" style="width:600px; height:100%"></div></md-tab-body></md-tab></md-tabs></div></md-tab-body></md-tab></div>'),e.put("app/sql/sql.html",'<script src="https://www.amcharts.com/lib/3/amcharts.js" type="text/javascript"></script><script src="https://www.amcharts.com/lib/3/serial.js" type="text/javascript"></script><script src="https://www.amcharts.com/lib/3/themes/light.js"></script><script src="https://www.amcharts.com/lib/3/themes/dark.js"></script><script src="../bower_components/jquery-ui/ui/core.js"></script><script src="../bower_components/jquery.sortable/jquery.sortable.js"></script><link rel="stylesheet" href="../bower_components/jquery-ui/themes/base/base.css"><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.7.0/d3_renderers.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.7.0/c3_renderers.min.js"></script><style>\n\n    .ace_icon {\n        left: 0;\n        bottom: 0;\n        border-radius: 50%;\n        font-weight: bold;\n        height: 13px;\n        width: 13px;\n        font-size: 11px;\n        line-height: 14px;\n        text-align: center;\n        color: black;\n        -moz-box-sizing: border-box;\n        -webkit-box-sizing: border-box;\n        box-sizing: border-box;\n    }\n\n    .ace_icon-unknown:before {\n        content: \'?\';\n        background: #4bb;\n    }\n    .ace_icon-function:before {\n        content: \'ƒ\';\n        color: #7c7;\n    }\n    .ace_icon-array:before {\n        content: \'A\';\n        background: #c66;\n    }\n    .ace_icon-field:before {\n        content: \'F\';\n        color:red;\n    }\n    .ace_icon-dict:before {\n        content: \'D\';\n    }\n    .ace_icon-keyword:before {\n        content: \'K\';\n    }\n    .ace_icon-type:before {\n        content: \'√\';\n    }\n    .ace_icon-table:before {\n        content: \'T\';\n        color: #c66;\n    }\n\n\n    .ace_doc-tooltip-boxclose {\n        position: absolute;\n        top: 0;\n        right: 3px;\n        color: red;\n    }\n\n    .ace_doc-tooltip-boxclose:hover {\n        background-color: yellow;\n    }\n\n    .ace_doc-tooltip-boxclose:before {\n        content: \'×\';\n        cursor: pointer;\n        font-weight: bold;\n        font-size: larger;\n    }\n\n    .ace_doc-tooltip-link {\n        font-size: smaller;\n        color: blue;\n    }\n    .description  {\n\n    }\n    .ace_doc-header  {\n        font-size: 110%;\n\n    }\n    .ace_doc-tooltip  {\n\n        border: 1px solid silver;\n        border-radius: 3px;\n        color: #444;\n        padding: 2px 5px;\n        padding-right: 15px;\n        font-size: 100%;\n        font-family: monospace;\n        background-color: white;\n        white-space: pre-wrap;\n        max-width: 35em;\n        max-height: 30em;\n        overflow-y: auto;\n        position: absolute;\n        z-index: 10;\n        -webkit-box-shadow: 2px 3px 5px rgba(0, 0, 0, .2);\n        -moz-box-shadow: 2px 3px 5px rgba(0, 0, 0, .2);\n        box-shadow: 2px 3px 5px rgba(0, 0, 0, .2);\n        transition: opacity 1s;\n        -moz-transition: opacity 1s;\n        -webkit-transition: opacity 1s;\n        -o-transition: opacity 1s;\n        -ms-transition: opacity 1s;\n    }\n</style><div style="position: absolute; top: 4px; right: 4px; z-index: 2"><md-button aria-label="menu" class="md-icon-button" ng-click="toggleSidenav(\'right\')"><i class="mdi mdi-settings"></i><md-tooltip>{{\'Настройки редактора\' | translate}}</md-tooltip></md-button></div><div ngsf-fullscreen="fullscreenCtrl" class="fullscreen" ng-class="vars.uiTheme.name"><md-tabs md-dynamic-height="" md-border-bottom="" md-selected="vars.selectedTab" class="sql-tabs"><md-tab ng-repeat="tab in vars.tabs" ng-click="vars.currentTab = tab"><md-tab-label>{{tab.name + (tab.changed ? \' *\' : \'\')}} <i class="mdi mdi-pencil ml+" ng-click="changeTabName(tab, $event)" style="cursor: pointer"></i> <i class="mdi mdi-close" ng-click="removeTab(tab, $event)" style="cursor: pointer"></i></md-tab-label><md-tab-body><div style="display: table; width: 100%;"><div style="min-height: 100px; position: relative; display: table-cell;"><div resizable="" r-directions="[\'bottom\']" r-height="300" style=""><md-menu mousepoint-menu=""><div ng-model="tab.sql" ng-right-click="$mdOpenMousepointMenu($event)" ui-ace="{ useWrapMode : true, mode: \'clickhouse\', onLoad: aceLoaded, advanced: { enableBasicAutocompletion: true } }" style="width: 100%; height: 100%;"></div><md-menu-content id="menu" width="4"><md-menu-item ng-repeat="menu in rightAceMenuList | filter: {active: true}"><md-button ng-click="rightMenuProcess(menu, $event)"><i class="mdi mdi-fullscreen"></i> {{menu.value}}</md-button></md-menu-item><md-menu-divider></md-menu-divider></md-menu-content></md-menu></div><md-button class="md-raised1 md-primary" ng-disabled="tab.loading" ng-click="execute(\'all\', tab)">{{tab.buttonTitle}}</md-button><md-button class="md-icon-button" ng-click="fullscreenCtrl.toggleFullscreen()" aria-label="fullscreen"><i class="mdi mdi-fullscreen"></i><md-tooltip>{{\'На весь экран\' | translate}}</md-tooltip></md-button><md-button class="md-icon-button" ng-click="save(tab, $event)" show-if-fullscreen="false" aria-label="save"><i class="mdi mdi-content-save"></i><md-tooltip>{{\'Сохранить\' | translate}}</md-tooltip></md-button><md-menu md-position-mode="target-right target" ng-if="vars.sqlHistory.length" show-if-fullscreen="false"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-history"></i></md-button><md-menu-content width="4"><md-menu-item ng-repeat="item in vars.sqlHistory track by $index" ng-click="load(item)"><md-button>{{item.name}}<md-tooltip>{{\'История зарпросов\' | translate}}</md-tooltip><div class="pull-right"><i class="mdi mdi-close ml+" ng-click="removeHistory(item, $event)"></i></div></md-button></md-menu-item></md-menu-content></md-menu><md-menu md-position-mode="target-right target" show-if-fullscreen="false"><md-button aria-label="menu" class="md-icon-button" ng-click="$mdOpenMenu($event)"><i class="mdi mdi-code-braces"></i><md-tooltip>{{\'Словари\' | translate}}</md-tooltip></md-button><md-menu-content><md-menu-item ng-repeat="dictionary in vars.dictionaries"><md-button ng-click="addDictionariesWord(dictionary.dic)">{{dictionary.title}}</md-button></md-menu-item></md-menu-content></md-menu><md-button class="md-icon-button" ng-click="toggleSidenav(\'log\')" show-if-fullscreen="false" aria-label="log"><i class="mdi mdi-view-headline"></i><md-tooltip>{{\'Лог запросов\' | translate}}</md-tooltip></md-button><div style="display: inline-block"><md-progress-circular md-diameter="16px" ng-if="tab.loading"></md-progress-circular></div></div></div><md-tabs md-dynamic-height="" md-border-bottom="" ng-if="tab.results.length" md-selected="tab.selectedResultTab"><span ng-include="\'app/sql/renderResult.html\'"></span></md-tabs></md-tab-body></md-tab><md-tab ng-click="addTab()"><md-tab-label><i class="mdi mdi-plus-circle"></i></md-tab-label></md-tab></md-tabs></div><md-sidenav class="md-sidenav-right md-whiteframe-4dp" md-component-id="right"><div class="p+"><h4 class="mt0 mb+++">{{\'Настройки редактора\' | translate}}</h4><md-input-container class="width-100"><label for="inp1">{{\'Размер шрифта\' | translate}}</label> <input type="text" id="inp1" ng-model="vars.fontSize"></md-input-container><md-input-container class="width-100"><label for="inp2">{{\'Максимум строк\' | translate}}</label> <input type="text" id="inp2" ng-model="vars.limitRows"></md-input-container><md-input-container class="width-100 mt mb++"><label>{{\'Формат результатов\' | translate}}</label><md-select ng-model="vars.format"><md-option ng-repeat="format in vars.formats" ng-value="format" ng-click="vars.format = format">{{format.name}}</md-option></md-select></md-input-container><md-input-container class="width-100 mb++"><label>{{\'Тема редактора\' | translate}}</label><md-select ng-model="vars.theme"><md-option ng-repeat="theme in vars.themes" ng-value="theme" ng-click="setTheme(theme)">{{theme}}</md-option></md-select></md-input-container><md-input-container class="width-100 mt mb+"><label>{{\'Тема интерфейса\' | translate}}</label><md-select ng-model="vars.uiTheme"><md-option ng-repeat="theme in vars.uiThemes" ng-value="theme" ng-click="setUiTheme(theme)">{{theme.title}}</md-option></md-select></md-input-container><md-input-container class="width-100 mt"><md-checkbox ng-model="vars.saveTabs" aria-label="saveTabs">{{\'Сохранять сессию\' | translate}}</md-checkbox></md-input-container><md-input-container class="width-100 mt"><md-checkbox ng-model="vars.enableLiveAutocompletion" aria-label="LiveAutocompletion">Live Autocompletion</md-checkbox></md-input-container><md-input-container class="width-100 mt mb+"><label>{{\'Разделитель запросов\' | translate }}</label><md-select ng-model="vars.delimiter"><md-option ng-repeat="delimiter in vars.delimiters" ng-value="delimiter.delimiter" ng-click="vars.delimiter = delimiter">{{delimiter.name}}</md-option></md-select></md-input-container><md-button ng-click="toggleSidenav(\'right\')" class="md-primary ml0 mt+++" style="line-height: inherit;">{{\'Закрыть\' | translate}}</md-button></div></md-sidenav><md-sidenav class="md-sidenav-right md-whiteframe-4dp" md-component-id="log"><div class="p+"><h4 class="mt0"><md-button class="md-icon-button pull-right" ng-click="toggleSidenav(\'log\')" aria-label="close" style="margin-top: -10px; margin-right: -10px"><i class="mdi mdi-close"></i><md-tooltip>{{\'Сохранить\' | translate}}</md-tooltip></md-button>{{\'Лог запросов\' | translate}}</h4></div><div ng-repeat="sql in vars.sqlLog" md-ink-ripple="" style="position: relative; cursor: pointer; border-bottom: 1px rgba(120, 120, 120, 0.2) solid;" class="p pl+" ng-click="setSql(sql)"><pre class="p0 m0" style="max-height: 48px; line-height: 16px; overflow: hidden; text-overflow: ellipsis">{{::sql}}</pre></div><small class="p+" ng-if="vars.sqlLog.length === 0">{{\'История запросов пуста\' | translate}}</small></md-sidenav>'),e.put("app/table/table-container.html",'<div style="position: absolute;top: 0px;bottom: 59px;left: 16px;right: 16px;" class="md-tabs-fix"><h3>{{vars.currentDatabase}} <i class="mdi mdi-chevron-right"></i> {{vars.currentTable}}</h3><md-tabs md-dynamic1-height="" md-border-bottom="" class="h100"><md-tab><md-tab-label><i class="mdi mdi-table-column-plus-after mr-"></i>{{\'Структура\' | translate}}</md-tab-label><md-tab-body><table class="data-table" style="font-size: 80%"><thead><tr class="text-left"><th style="width: 40px"></th><th style="width: 40%">{{\'Название\' | translate}}</th><th style="width: 10%">{{\'Тип\' | translate}}</th><th style="width: 10%">{{\'Default тип\' | translate}}</th><th style="width: 10%">{{\'Значение\' | translate}}</th></tr></thead><tbody><tr class="text-left" ng-repeat="field in vars.columns.data"><td class="tc-grey-400">{{$index + 1}}</td><td ng-repeat="key in [\'name\', \'type\', \'default_type\', \'default_expression\'] track by $index">{{field[key]}}</td></tr></tbody></table></md-tab-body></md-tab><md-tab><md-tab-label><i class="mdi mdi-information mr-"></i>{{\'Информация\' | translate}}</md-tab-label><md-tab-body><div class="data-table-container"><table class="data-table"><tbody><tr class="data-table-row"><td class="tc-grey-400" style="width: 40px">1</td><td style="width: 200px">{{\'Размер\' | translate}}</td><td>{{vars.statistics.size}}</td></tr><tr class="data-table-row"><td class="tc-grey-400">2</td><td>{{\'Размер, байт\' | translate}}</td><td>{{vars.statistics.sizeBytes}}</td></tr><tr class="data-table-row"><td class="tc-grey-400">3</td><td>{{\'Первая запись\' | translate}}</td><td>{{vars.statistics.minDate}}</td></tr><tr class="data-table-row"><td class="tc-grey-400">4</td><td>{{\'Последняя запись\' | translate}}</td><td>{{vars.statistics.maxDate}}</td></tr></tbody></table><br><br><br><b>SHOW CREATE TABLE</b><br><i ng-repeat="field in vars.createtable.data">{{ field.statement }}</i></div></md-tab-body></md-tab><md-tab md-active="true"><md-tab-label><i class="mdi mdi-table-large mr-"></i>{{\'Данные\' | translate}}</md-tab-label><md-tab-body><div style="display:table"></div><div class="pl+ pt+ pb+ pr" style="font-size: .75rem;max-height:100%"><div class="float-right" style="margin-top: -12px"><md-button class="md-icon-button" aria-label="load prev" ng-click="loadPrev()" ng-disabled="vars.offset === 0"><i class="mdi mdi-arrow-left"></i></md-button><md-button class="md-icon-button" aria-label="load next" ng-click="loadNext()"><i class="mdi mdi-arrow-right"></i></md-button></div>{{\'Данные\' | translate}} <span class="tc-grey-400">{{\'с\' | translate}} {{vars.offset}} {{\'по\' | translate}} {{vars.offset + vars.limit}}</span></div><div class="card__actions p+" style="position:absolute; top:46px; bottom:0;left:0;right:0; overflow:hidden;"><span ng-if="vars.data === null&&!vars.loading" class="fs-caption">{{\'нет данных\' | translate}}</span><md-progress-circular ng-if="vars.loading" class="md-accent" md-diameter="40"></md-progress-circular><hot-table ng-class="{\'handsontable-dark\': vars.isDark}" hot-id="hottable" settings="table.settings" datarows="table.data" style="width: 99%;height: 99%" col-headers="table.colHeaders" manual-column-resize="true"></hot-table></div></md-tab-body></md-tab></md-tabs></div>'),e.put("app/table/table.html",'<div ng-controller="TableContainerController" ng-include="\'app/table/table-container.html\'" ng-init="initOnGo()"></div>')}]),function(e,t){function a(e,t){var a=t.dbName,n=t.tableName;e.vars={dbName:a,tableName:n}}e.module(t.app.name).controller("TableController",a),a.$inject=["$scope","$stateParams"]}(angular,smi2),function(e,t){function a(e,t,a,n,i,r,s,o){e.table={data:{},settings:{dropdownMenu:!0}},e.vars={columns:{},ugrid:{},isDark:n.isDark(),createtable:{},data:null,grid:null,limit:100,offset:0,statistics:{},loading:!0,scrollConfig:{autoHideScrollbar:!1,theme:n.isDark()?"light":"dark",scrollButtons:{enable:!1},scrollInertia:100,advanced:{updateOnContentResize:!0}}},e.initContainer=function(){t.$watch("currentTable",function(a){a&&(e.vars.currentTable=t.currentTable,e.vars.currentDatabase=t.currentDatabase,e.init())})},e.onAfterInit=function(){},e.initHandTable=function(){},e.initOnGo=function(){e.$parent.vars&&(s.get("tableSiedenav")&&r("tableSiedenav").close(),e.vars.currentTable=e.$parent.vars.tableName,e.vars.currentDatabase=e.$parent.vars.dbName,e.init())},e.load=function(){e.vars.data=-1,a.query("\n                select *\n                from "+e.vars.currentDatabase+"."+e.vars.currentTable+"\n                limit "+e.vars.offset+", "+e.vars.limit+"\n                ").then(function(t){var n=a.dataToHandsontable(t);e.table.colHeaders=n.colHeaders,e.table.settings.manualColumnResize=n.columns,e.table.settings.colWidths=n.colWidths,e.table.data=n.data,e.vars.loading=!1},function(t){e.vars.loading=!1,console.error("Ошибка "+t)})},e.init=function(){e.vars.loading=!0,a.query("describe table "+e.vars.currentDatabase+"."+e.vars.currentTable).then(function(t){return e.vars.columns=t}),a.query("SHOW CREATE TABLE "+e.vars.currentDatabase+"."+e.vars.currentTable).then(function(t){return e.vars.createtable=t}),a.query("SELECT 	table, 	formatReadableSize(sum(bytes)) as size, 	sum(bytes) as sizeBytes, 	min(min_date) as minDate, 	max(max_date) as maxDate FROM  	system.parts WHERE 	database = '"+e.vars.currentDatabase+"' AND 	( 		table = '"+e.vars.currentTable+"' OR 		table = '"+e.vars.currentTable+"_sharded'    ) GROUP BY     table ").then(function(t){return e.vars.statistics=t&&t.data.length&&t.data[0]||{}}),e.initHandTable(),e.load()},e.loadNext=function(){e.vars.offset+=e.vars.limit,e.load()},e.loadPrev=function(){e.vars.offset>0&&(e.vars.offset-=e.vars.limit,e.load())}}e.module(t.app.name).controller("TableContainerController",a),a.$inject=["$scope","$rootScope","API","ThemeService","$stateParams","$mdSidenav","$mdComponentRegistry","HandTable"]}(angular,smi2),window.global_keywords_fields="",window.global_keywords_tables="",window.global_keywords_fieldsList="",window.global_keywords_dictList="",window.global_builtinFunctions=[],window.global_delimiter=";;",function(e,t){function a(t,a,n,i,r,s,o,l,d,c,m,u){var b="sqlHistory2",p="sqlLog",v="saveTabs",h="liveAutocompletion",g="sessionData",f=30;t.menuOptions=[["Select",function(e,a,n,i,r){t.selected=e.item.name}],null,["Remove",function(e,a,n,i,r){t.items.splice(e.$index,1)}]],t.vars={sqlHistory:i.get(b)||[],dictionaries:[],tabs:[],enableLiveAutocompletion:i.get(h)||!1,saveTabs:i.get(v)||!1,uiTheme:d.themeObject,uiThemes:d.list,delimiters:[{name:m("translate")(";; Двойной"),delimiter:";;"},{name:m("translate")("; Одинарный"),delimiter:";"}],currentTab:{},selectedTab:0,sqlLog:i.get(p)||[],formats:[{name:m("translate")("Таблица"),sql:" format JSON",render:"html"},{name:"JSON compact",sql:" format JSONCompact"}],db:null,limitRows:i.get("editorLimitRows")||500,fontSize:i.get("editorFontSize")||16,theme:i.get("editorTheme")||"cobalt"},t.vars.delimiter=i.get("delimiter")||";;",t.vars.format=t.vars.formats[0],t.vars.themes=["ambiance","eclipse","mono_industrial","tomorrow_night_blue","chaos","github","monokai","tomorrow_night_bright","chrome","idle_fingers","pastel_on_dark","tomorrow_night_eighties","clouds","iplastic","solarized_dark","tomorrow_night","clouds_midnight","katzenmilch","solarized_light","twilight","cobalt","kr_theme","sqlserver","vibrant_ink","crimson_editor","kuroir","terminal","xcode","dawn","merbivore","textmate","dreamweaver","merbivore_soft","tomorrow"],a.breadcrumbs=[{text:"SQL",link:"sql"}],n.onbeforeunload=function(e){if(""!==t.vars.currentTab.sql&&"localhost"!=location.hostname){var a=m("translate")("Хотите покинуть страницу?");return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=a),a}};var y=t.$on("$stateChangeStart",function(e){var a=m("translate")("Хотите покинуть страницу?");e.defaultPrevented||""===t.vars.currentTab||confirm(a)||e.preventDefault()}),w=function(){if(t.vars.saveTabs){var e=t.vars.tabs.map(function(e){return{name:e.name,sql:e.sql,buttonTitle:e.buttonTitle,format:e.format,delimiter:e.delimiter,results:[],editor:null,selectedResultTab:0}});i.set(g,e)}};t.executeQuery=function(a,n,i){var s="";t.vars.currentTab.loading=!0,t.vars.limitRows&&(s+="max_result_rows="+t.vars.limitRows+"&result_overflow_mode=throw"),r.query(a.sql,a.format,!0,s).then(function(e){var r=e;"object"!==("undefined"==typeof e?"undefined":_typeof(e))&&(e={data:r,meta:null,rows:null,statistics:null}),e.error=!1,e.query=a;var s=t.renderResult(e);i.data.push(s),a.index+1<n.length?t.executeQuery(n[a.index+1],n,i):t.renderFinalResult(i);
},function(n){l.show(l.simple().content(m("translate")("Ошибка")).theme(d.theme).position("bottom right"));var r={meta:null,rows:null,query:a,statistics:null};n&&n.data?r.error=e.toJson(n.data).replace(/\\n/gi,"<br/>").replace(/^"/,"").replace(/"$/,""):r.error=n,i.data.push(t.renderResult(r)),t.renderFinalResult(i)})},t.renderResult=function(t){return"string"==typeof t.error?t.result='<pre class="fs-caption tc-red-700">'+t.error+"</pre>":"object"!==_typeof(t.data)?"string"!=typeof t.data?t.result='<pre class="fs-caption">'+e.toJson(t.data,!0)+"</pre>":t.result='<pre class="fs-caption">'+t.data+"</pre>":(t.result=r.dataToHtml(t),t.createtable=r.dataToCreateTable(t)),t},t.renderFinalResult=function(e){t.vars.currentTab.loading=!1,e.data.find(function(e){return e.query&&e.query.keyword&&-1!=["DROP","CREATE","ALTER"].indexOf(e.query.keyword.toUpperCase())})&&(t.selectDatabase(t.vars.db),a.$emit("handleBroadcastDatabases",{}))},t.execute=function(a,n){var r=n.sql,s=0,o=n.editor,c=[],u=o.getSelectedText(),b={data:[],time:m("date")(new Date,"HH:mm:ss"),pinned:!1};if(""!==u&&null!==u&&(r=u),console.info(r),""===r||null===r)return void l.show(l.simple().content(m("translate")("Не введен SQL")).theme(d.theme).position("bottom right"));n.results=n.results.reduce(function(e,t){return t.pinned&&e.push(t),e},[]),n.results.unshift(b),-1==t.vars.sqlLog.indexOf(r)&&(t.vars.sqlLog.unshift(r),t.vars.sqlLog.length>f&&t.vars.sqlLog.splice(0,f),i.set(p,t.vars.sqlLog)),w();var v=window.global_delimiter;v||(v=";;"),o.session.$mode.splitByTokens(r,"constant.character.escape",v).forEach(function(t){var n=[],i=t.sql;if(!(i.length<5)){if("current"==a&&!u){var r=o.selection.getCursor();if(!r||e.isUndefined(r))return;var l=t.range.compare(r.row,r.column);if(0!==l)return}if(o.session.$mode.findTokens(i,"invalid.illegal",!0)){var d=o.session.$mode.splitByTokens(i,"invalid.illegal",!0);i=d[0].sql,d.forEach(function(t){if(!e.isUndefined(t.keyword)&&t.keyword){var a=/DRAW\s+(\w+)/gim,i=a.exec(t.keyword);i&&i[1]&&n.push({drawtype:i[1].toLowerCase(),code:t.sql})}})}console.info("[SQL]>",i),n&&console.info("[DRAW]>",n);var m=null,b=!1,p=!1,v=null,h=o.session.$mode.findTokens(i,"storage",!0),g=o.session.$mode.findTokens(i,"keyword",!0);h.hasOwnProperty("value")?(m=!1,p=h.value):(m=" FORMAT JSON ",b=!0),g.hasOwnProperty("value")&&(v=g.value),"select"!==v&&(m=!1,b=!1),c.push({sql:i,index:s,format:m,setedformat:b,keyword:v,storage:p,drawCommand:n}),s++}}),c.length&&t.executeQuery(c[0],c,b)},t.setTheme=function(e){t.vars.theme=e,t.vars.tabs.forEach(function(t){return t.editor.setTheme("ace/theme/"+e)}),i.set("editorTheme",e)},t.selectDatabase=function(e){e&&(t.vars.db=e,r.setDatabase(e),r.query("SELECT table,name,type,default_type,default_expression FROM system.columns WHERE database='"+e+"'",null).then(function(a){var n=[],i={},r=[],s={},o=[];window.global_keywords_fieldsList=[],a.meta.forEach(function(e){o.push(e.name)}),a.data.forEach(function(e){window.global_keywords_fieldsList.push(e),o.forEach(function(t){"table"==t&&(s.hasOwnProperty(e[t])||(s[e[t]]=1,r.push(e[t]))),"name"==t&&(i.hasOwnProperty(e[t])||(i[e[t]]=1,n.push(e[t])))})}),window.global_keywords_fields=n.join("|")+"|",window.global_keywords_tables=r.join("|")+"|"+e,t.vars.tabs.forEach(function(e){e.editor&&(e.editor.session.setMode({path:"ace/mode/clickhouse",v:Date.now()}),e.editor.session.bgTokenizer.start(0))})}))},t.addDictionariesWord=function(e){var a=t.vars.currentTab.editor,n=a.getCursorPosition();n.column+=e.length,a.clearSelection(),a.insert(e),t.vars.currentTab.sql=a.getValue(),c(function(){a.focus(),a.moveCursorToPosition(n)})},t.loadDictionaries=function(){t.vars.dictionaries=[],window.global_keywords_dictList=[],r.query("select name,key,attribute.names,attribute.types from system.dictionaries ARRAY JOIN attribute ORDER BY name,attribute.names",null).then(function(e){e.data.forEach(function(e){var a="dictGet"+e["attribute.types"]+"('"+e.name+"','"+e["attribute.names"]+"',to"+e.key+"( ID ) ) AS "+e["attribute.names"]+",";window.global_keywords_dictList.push({dic:a,title:"dic_"+e.name+"."+e["attribute.names"]}),t.vars.dictionaries.push({dic:a,title:e.name+"."+e["attribute.names"]+" as "+e["attribute.types"]})})})};for(var x=function(e){t.vars.tabs.length>=e&&(t.vars.currentTab=t.vars.tabs[e],t.vars.selectedTab=e,c(function(){t.vars.currentTab.editor.focus()}))},k=function(){t.vars.selectedTab>0&&x(t.vars.selectedTab-1)},T=function(){t.vars.selectedTab<t.vars.tabs.length-1&&x(t.vars.selectedTab+1)},C=function(){e.isObject(window.sqlFormatter)&&c(function(){t.vars.currentTab.editor.setValue(window.sqlFormatter.format(t.vars.currentTab.sql))})},S=function(e){u.add({combo:"ctrl+shift+"+(e+1),callback:function(){return x(e)}})},$=0;9>$;$++)S($);u.add({combo:"ctrl+right",callback:T}),u.add({combo:"ctrl+left",callback:k}),u.add({combo:"ctrl+shift+f",callback:C}),t.aceLoaded=function(e){var a=t.vars.tabs.find(function(e){return!e.editor})||t.vars.currentTab;a.editor=e,e.$blockScrolling=1/0,console.log(e.getSession().getUndoManager()),e.setOptions({fontSize:t.vars.fontSize+"px",enableBasicAutocompletion:!0,behavioursEnabled:!0,wrapBehavioursEnabled:!0,highlightSelectedWord:!0,showGutter:!0,enableLiveAutocompletion:t.vars.enableLiveAutocompletion,liveAutocompletionDelay:500,liveAutocompletionThreshold:1}),e.setTheme("ace/theme/"+t.vars.theme),e.session.setMode({path:"ace/mode/clickhouse",v:Date.now()}),e.session.bgTokenizer.start(0),e.commands.addCommand({name:"runCurrentCommand",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function(){t.execute("current",a)}}),e.commands.addCommand({name:"removeLiness",bindKey:{win:"Ctrl-Y",mac:"Cmd-Y"},exec:function(e){e.removeLines()}}),e.commands.addCommand({name:"runAllCommand",bindKey:{win:"Shift-Ctrl-Enter",mac:"Shift-Command-Enter"},exec:function(){t.execute("all",a)}});for(var n=function(t){e.commands.addCommand({name:"selecttab"+t,bindKey:{win:"Ctrl-Shift-"+(t+1),mac:"Command-Shift-"+(t+1)},exec:function(){return x(t)}})},i=0;9>i;i++)n(i);e.commands.addCommand({name:"selectnexttab",bindKey:{win:"Ctrl-Right",mac:"Command-Right"},exec:T}),e.commands.addCommand({name:"selectprevtab",bindKey:{win:"Ctrl-Left",mac:"Command-Left"},exec:k}),e.commands.addCommand({name:"formatcode",bindKey:{win:"Ctrl-Shift-F",mac:"Command-Shift-F"},exec:C}),e.clearSelection(),e.focus(),e.selection.moveTo(0,0),e.on("changeSelection",function(){c(function(){a.buttonTitle=""!==e.getSelectedText()?m("translate")("Выполнить выделенное ⌘ + ⏎"):m("translate")("Выполнить все ⇧ + ⌘ + ⏎"),a.originalSql&&(a.changed=a.originalSql!=a.sql)})}),t.loadDictionaries()},a.$watch("currentDatabase",t.selectDatabase),t.$watch("vars.limitRows",function(e){return i.set("editorLimitRows",e)}),t.$watch("vars.delimiter",function(e){e.name&&e.delimiter&&(e=e.delimiter),i.set("delimiter",e),window.global_delimiter=e,t.vars.tabs.forEach(function(e){e.editor&&(e.editor.session.setMode({path:"ace/mode/clickhouse",v:Date.now()}),e.editor.session.bgTokenizer.start(0))})}),t.$watch("vars.fontSize",function(e){e&&(t.vars.tabs.forEach(function(t){return t.editor&&t.editor.setOptions({fontSize:e+"px"})}),i.set("editorFontSize",e))}),t.save=function(e,a){return o.show(o.prompt().title(m("translate")("Сохранить SQL как")).placeholder(m("translate")("название")).initialValue(e.name).targetEvent(a).ok(m("translate")("Сохранить")).cancel(m("translate")("Отмена"))).then(function(a){var n=t.vars.sqlHistory.findIndex(function(t){return t.name==e.name});-1!=n?(t.vars.sqlHistory[n].sql=e.sql,t.vars.sqlHistory[n].name=a):t.vars.sqlHistory.push({sql:e.sql,name:a}),e.originalSql=e.sql,e.name=a,i.set(b,t.vars.sqlHistory),w()})},t.load=function(e){t.vars.currentTab.sql=e.sql,t.vars.currentTab.originalSql=e.sql,t.vars.currentTab.name=e.name},t.getExportData=function(t){return t.map(function(t){return Object.keys(t).map(function(a){return e.isArray(t[a])?t[a].join(", "):t[a]})})},t.getExportHeaders=function(e){return e.map(function(e){return e.name})},t.addTab=function(){t.vars.currentTab={name:"new SQL",sql:"",buttonTitle:m("translate")("Выполнить ⌘ + ⏎"),format:{},editor:null,results:[],selectedResultTab:0},t.vars.tabs.push(t.vars.currentTab),w()},t.removeTab=function(e,a){a.stopPropagation();var n=function(){t.vars.tabs.splice(t.vars.tabs.indexOf(e),1),t.vars.tabs.length==t.vars.selectedTab&&t.vars.selectedTab--};e.changed?o.show(o.confirm().title(m("translate")("SQL изменен. Сохранить перед закрытием?")).targetEvent(a).ok(m("translate")("Да")).cancel(m("translate")("Нет"))).then(function(){var a=t.vars.sqlHistory.findIndex(function(t){return t.name==e.name});-1!=a&&(t.vars.sqlHistory[a].sql=e.sql,t.vars.sqlHistory[a].name=e.name),i.set(b,t.vars.sqlHistory),n()},n):n()},t.removeResult=function(e,t,a){a.stopPropagation(),e.results.splice(e.results.indexOf(t),1)},a.$on("handleBroadcastInsertInActive",function(e,a){a.value&&t.addDictionariesWord(" "+a.value+", ")}),t.toggleSidenav=function(e){s(e).toggle()},t.removeHistory=function(e,a){a.preventDefault();var n=t.vars.sqlHistory.indexOf(e);-1!=n&&o.show(o.confirm().title("Удалить "+e.name+"?").targetEvent(a).ok("Да").cancel("Нет")).then(function(){t.vars.sqlHistory.splice(n,1),i.set(b,t.vars.sqlHistory)})},t.$watch("vars.saveTabs",function(e,t){i.set(v,e),t===!1&&e===!0&&w()}),t.$watch("vars.enableLiveAutocompletion",function(e,a){i.set(h,e),t.vars.tabs.forEach(function(t){return t.editor&&t.editor.setOptions({enableLiveAutocompletion:e})})}),t.setUiTheme=function(e){return d.set(e.name)},t.setSql=function(e){t.vars.currentTab.sql=e,t.toggleSidenav("log"),c(function(){return t.vars.currentTab.editor.focus()},500)},t.changeTabName=function(e,a){a.stopPropagation(),o.show(o.prompt().title(m("translate")("Название вкладки")).placeholder(m("translate")("название")).initialValue(e.name).targetEvent(a).ok(m("translate")("Применить")).cancel(m("translate")("Отмена"))).then(function(a){var n=t.vars.sqlHistory.findIndex(function(t){return t.name==e.name});-1!=n&&(e.originalSql=e.sql,t.vars.sqlHistory[n].name=a,i.set(b,t.vars.sqlHistory)),e.name=a,w()})},t.vars.saveTabs?(t.vars.tabs=i.get(g),t.vars.tabs.length>0?c(function(){return t.vars.currentTab=t.vars.tabs[0]},500):t.addTab()):(i.set(g,[]),t.addTab()),a.currentDatabase&&t.selectDatabase(a.currentDatabase),r.query("select name,is_aggregate from system.functions",null).then(function(e){e.data.forEach(function(e){if(window.global_builtinFunctions.push({name:e.name,isaggr:e.is_aggregate,score:101,comb:!1,origin:e.name}),e.is_aggregate){var t={name:e.name+"If",isaggr:e.is_aggregate,score:3,comb:"If",origin:e.name};window.global_builtinFunctions.push(t),t={name:e.name+"Array",isaggr:e.is_aggregate,score:2,comb:"Array",origin:e.name},window.global_builtinFunctions.push(t),t={name:e.name+"State",isaggr:e.is_aggregate,score:1,comb:"State",origin:e.name},window.global_builtinFunctions.push(t)}})}),t.$on("$destroy",function(){r.setDatabase(a.currentDatabase),y(),n.onbeforeunload=null}),t.rightAceMenuList=[{active:!0,value:"AutoFormat"},{active:!0,value:"Cut"},{active:!0,value:"Paste"}],t.rightMenuProcess=function(e,a){"Copy"==e.value?t.placeHolder=t.model.text:"Cut"==e.value?(t.placeHolder=t.model.text,t.model.text=""):C()}}e.module(t.app.name).controller("SqlController",a),a.$inject=["$scope","$rootScope","$window","localStorageService","API","$mdSidenav","$mdDialog","$mdToast","ThemeService","$timeout","$filter","hotkeys"]}(angular,smi2),function(angular,smi2){function FooterController($scope,$rootScope,$window,localStorageService,API,$mdSidenav,$mdDialog,$mdToast,ThemeService){$scope.amChartOptions=!1,$scope.vars={rsw:0,uiTheme:ThemeService.themeObject,isChartReady:!1,stackType:"false"},$scope.initPivot=function(e,t){console.info("pivot"),console.table(e);var a=[],n=[];e.forEach(function(e){}),$("#pivotDiv").pivotUI(t,{dataClass:$.pivotUtilities.SubtotalPivotData,rows:a,cols:n,renderer:$.pivotUtilities.subtotal_renderers["Table With Subtotal"],rendererOptions:{collapseRowsAt:1,collapseColsAt:0}})},$scope.initChart=function(e,t,a){var n=[];"drawCommand"in a&&(n=a.drawCommand),$scope.createChart(e,t,n)},$scope.getChartGraph=function(e,t){var a=e.name,n=e.name,i="v1";a=a.replace(/_axis\d+/gm,"");var r=/.*_axis(\d+).*/i,s=n.match(r);s&&s[1]&&(i="v"+s[1]);var o={id:"g1",valueAxis:i,fillAlphas:.2,bullet:"round",bulletSize:8,hideBulletsCount:50,lineThickness:1,title:a,useLineColorForBulletBorder:!0,valueField:n,type:"smoothedLine",balloonText:"[[title]] [[category]]<br><b><span style='font-size:14px;'>[[value]]</span></b>"};return t||(t={}),Object.assign(o,t)},$scope.createChart=function(meta,data,drawCommand){var chartSets={};drawCommand.forEach(function(i){try{var _ret3=function(){if(i&&!i.code)return{v:void 0};var object=eval("("+i.code+")");console.warn(object),meta.forEach(function(e){object[e.name]&&(chartSets[e.name]=object[e.name])})}();if("object"===("undefined"==typeof _ret3?"undefined":_typeof(_ret3)))return _ret3.v}catch(E){}});var dataDateFormat=!1,categoryField="",minPeriod="mm",graphs=[],counter=0,axes=[];meta.forEach(function(e){if("DateTime"==e.type)dataDateFormat="YYYY-MM-DD JJ:NN:SS",categoryField=e.name;else if("Date"==e.type)dataDateFormat="YYYY-MM-DD",minPeriod="DD",categoryField=e.name;else{if(!categoryField)return void(categoryField=e.name);counter+=1;var t=$scope.getChartGraph(e,chartSets[e.name]);t.id="g"+counter,"v1"!==t.valueAxis&&axes.push(t.valueAxis),graphs.push(t)}});var theme="light";ThemeService.isDark()&&(theme="dark");var obl={type:"serial",theme:theme,marginRight:50,marginLeft:50,startDuration:.4,autoMarginOffset:50,autoResize:!0,marginBottom:30,marginsUpdated:!0,marginTop:10,categoryField:categoryField,valueAxes:[{id:"v1",axisAlpha:1,gridAlpha:.07,ignoreAxisWidth:!0}],balloon:{borderThickness:1,shadowAlpha:0},graphs:graphs,chartCursor:{valueLineEnabled:!0,valueLineBalloonEnabled:!0,cursorAlpha:0,zoomable:!1,valueZoomable:!0,valueLineAlpha:.5},chartScrollbar:{graph:"g1",gridAlpha:0,color:"#888888",scrollbarHeight:25,backgroundAlpha:0,selectedBackgroundAlpha:.1,selectedBackgroundColor:"#888888",graphFillAlpha:0,autoGridCount:!0,selectedGraphFillAlpha:0,graphLineAlpha:.2,graphLineColor:"#c2c2c2",selectedGraphLineColor:"#888888",selectedGraphLineAlpha:1},categoryAxis:{dashLength:1,minorGridEnabled:!0},dataProvider:data,legend:{align:"center",equalWidths:!1,periodValueText:"total: [[value.sum]]",valueAlign:"left",valueText:"[[value]] ([[percents]]%)",valueWidth:100}};dataDateFormat&&(obl.dataDateFormat=dataDateFormat,obl.categoryAxis.parseDates=!0,obl.categoryAxis.minPeriod=minPeriod),axes&&!function(){var e=0;axes.forEach(function(t){e++;var a={id:t,axisAlpha:1,axisThickness:1,position:"right",ignoreAxisWidth:!0,offset:1*e};obl.valueAxes.push(a)})}(),console.info("valueAxes",obl.valueAxes);var chart=AmCharts.makeChart("myFirstChart",obl)}}angular.module(smi2.app.name).controller("FooterCtrl",FooterController),FooterController.$inject=["$scope","$rootScope","$window","localStorageService","API","$mdSidenav","$mdDialog","$mdToast","ThemeService"]}(angular,smi2),function(e,t){function a(e,t){var a=e.get("themeName")||"dark",n=[{isDark:!1,name:"default",title:t("translate")("Светлая тема")},{isDark:!0,name:"dark",title:t("translate")("Темная тема")}],i=n.find(function(e){return e.name==a})||n[0];return{isDark:function(){return i.isDark},theme:i.name,themeObject:i,set:function(t){t!=a&&(e.set("themeName",t),location.href=location.href)},list:n}}e.module(t.app.name).service("ThemeService",a),a.$inject=["localStorageService","$filter"]}(angular,smi2),function(e,t){function a(e,t){return{responseError:function(a){return 401==a.status&&t.get("$state").go("login"),e.reject(a)}}}e.module(t.app.name).service("HttpInterceptor",a),a.$inject=["$q","$injector"]}(angular,smi2),function(e,t){function a(e,t,a,n){return{}}e.module(t.app.name).service("HandTable",a),a.$inject=["localStorageService","ThemeService","$q","$injector"]}(angular,smi2),function(e,t){function a(t,a,n,i,r){var s="currentBaseConfig",o=8123,l=null,d={},c=n.get(s);c&&c.host&&(d=c),this.setConnection=function(t){n.set(s,t),d=e.copy(t),/.*\:\d+$/.test(d.host)||(d.host+=":"+o)},this.clear=function(){l=null,d={},n.set(s,{})},this.query=function(n,i,r,s){var o=a.defer(),c="";i!==!1?(i=i||" FoRmAt JSON","null"==i&&(i=""),c=n+" "+i):c=n;var m="";d.host.indexOf("://")>0||0==d.host.indexOf("/")||(m="http://");var u=m+d.host+"/?add_http_cors_header=1";d.login&&(u+="&user="+d.login),d.password&&(u+="&password="+d.password),r&&(u+="&database="+l),s&&(u+="&"+s),d.params&&(u+="&"+d.params);var b={method:"POST",data:c,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:u,transformResponse:function(t,a,n){try{return e.fromJson(t)}catch(i){return t?t:"\nStatus:"+n+"\nHeaders:"+e.toJson(a())}}};return t(b).then(function(e){return o.resolve(e.data)},function(e){return o.reject(e)}),o.promise},this.getConnectionInfo=function(){return d},this.setDatabase=function(e){return l=e},this.getDatabase=function(){return l},this.dataToCreateTable=function(e){var t="\nCREATE TABLE x (\n",a=[];return e.meta.forEach(function(e){return a.push("	"+e.name+" "+e.type)}),t+a.join(",\n")+"\n ) ENGINE = Log \n;;\n"},this.dataToHtml=function(e){var t='<table class="sql-table '+r.theme+'"><tr>',a=[];return e.meta.forEach(function(e){t+="<th>"+i(e.name)+'\n                            <div class="sql-table__subheader">'+i(e.type)+"</div>\n                        </th>",a.push(e.name)}),e.data.forEach(function(e){t+="<tr>",a.forEach(function(a){t+="<td>"+i(e[a])+"</td>"}),t+="</tr>"}),t+="</table>"},this.dataToHandsontable=function(e){var t=[],a=[],n=[];return e.meta.forEach(function(e){a.push(e.name);var t={};switch(t.type="text",t.width=100,e.type){case"Date":t.width=90,t.type="date",t.dateFormat="MM/DD/YYYY";break;case"DateTime":t.width=150,t.type="time",t.timeFormat="HH:mm:ss";break;case"Int32":t.width=80,t.type="numeric";break;case"Float64":t.width=80,t.type="numeric",t.format="0,0.0000";break;case"UInt32":t.width=80,t.type="numeric";break;case"String":t.width=180}t.data=e.name,n.push(t)}),{colWidths:t,colHeaders:a,columns:n,data:e.data}},this.dataToUIGrid=function(e){var t=[];return e.meta.forEach(function(e){var a=100;switch(e.type){case"Date":a=90;break;case"DateTime":a=150;break;case"Int32":a=80;break;case"UInt32":a=80;break;case"String":a=180}console.info(e.type),t.push({field:e.name,minWidth:a,headerTooltip:e.type,enableColumnMenu:!0,enableFiltering:!0})}),{columnDefs:t,data:e.data}}}e.module(t.app.name).service("API",a),a.$inject=["$http","$q","localStorageService","$sanitize","ThemeService"]}(angular,smi2),function(e,t){function a(e,t,a,n,i){var r="proc.interval",s="proc.key";e.vars={loading:!1,data:null,cols:[],sort:/^[a-z0-9_]+$/.test(i.get(s))?i.get(s):null,interval:i.get(r)||-1,scrollConfig:{autoHideScrollbar:!1,theme:a.isDark()?"light":"dark",scrollButtons:{enable:!1},scrollInertia:100,advanced:{updateOnContentResize:!0}}};var o=null;e.load=function(){var a="SELECT * FROM system.processes";e.vars.sort&&(a+=" ORDER BY "+e.vars.sort),t.query(a).then(function(a){e.vars.data=t.dataToHtml(a),e.vars.cols=a.meta.map(function(e){return e.name}),e.vars.loading=!1},function(t){e.vars.loading=!1,console.error("Ошибка "+t)})},e.setInterval=function(){i.set(r,e.vars.interval),o&&(n.cancel(o),o=null),e.vars.interval>-1&&(o=n(e.load,1e3*e.vars.interval))},e.setSort=function(){i.set(s,e.vars.sort),e.load()},e.load(),e.vars.interval>-1&&e.setInterval()}e.module(t.app.name).controller("ProcessesController",a),a.$inject=["$scope","API","ThemeService","$interval","localStorageService"]}(angular,smi2),function(e,t){function a(e,a,n,i,r,s){var o="basesConfig";e.vars={bases:n.get(o)||[],db:{},loading:!1,version:t.app.version,themes:s.list},e.login=function(){if(e.vars.loading=!0,e.vars.db.id){for(var t=0;t<e.vars.bases.length;t++)if(e.vars.bases[t].id==e.vars.db.id){e.vars.bases[t]=e.vars.db;break}}else e.vars.db.id=(new Date).getTime(),e.vars.bases.push(e.vars.db);n.set(o,e.vars.bases),i.setConnection(e.vars.db),i.query("SELECT 'login success'").then(function(){return a.go("sql")},function(){e.vars.loading=!1,r.show(r.simple().content("Ошибка доступа").theme(s.theme).position("bottom right"))})},e.remove=function(){var t=e.vars.bases.findIndex(function(t){return t.id==e.vars.db.id});e.vars.bases.splice(t),n.set(o,e.vars.bases),e.vars.db={}},e.setUiTheme=function(e){return s.set(e.name)}}e.module(t.app.name).controller("LoginController",a),a.$inject=["$scope","$state","localStorageService","API","$mdToast","ThemeService"]}(angular,smi2),function(e,t){e.module(t.app.name).filter("filesize",function(){var e=["bytes","KB","MB","GB","TB","PB"];return function(t,a){if(isNaN(parseFloat(t))||!isFinite(t))return"?";for(var n=0;t>=1024;)t/=1024,n++;return t.toFixed(+a)+" "+e[n]}})}(angular,smi2),function(e,t){function a(e,t,a,n,i,r){e.vars={loaded:!1,error:!1,databases:[]},e.vars.scrollConfig={autoHideScrollbar:!1,theme:i.isDark()?"light":"dark",scrollButtons:{enable:!1},scrollInertia:400,advanced:{updateOnContentResize:!0}},e.vars.metis={config:{toggle:!0,preventDefault:!1}},e.clickInsertField=function(e){t.$emit("handleBroadcastInsertInActive",{value:e.name})},e.clickAndSelect=function(a,n){return a.name==t.currentDatabase?(n.stopPropagation(),!1):void e.selectDatabase(a)},e.selectDatabase=function(e){t.currentDatabase=e.name,r("tableSiedenav").close()},e.openTable=function(e){r("tableSiedenav").close(),t.currentTable=e.name,r("tableSiedenav").open()},t.$on("handleBroadcastDatabases",function(t,a){e.reLoad()}),e.reLoad=function(){var t=[];n.query("SELECT * FROM system.columns").then(function(a){var i=a.data||[];i.forEach(function(e){t[e.database+"."+e.table]||(t[e.database+"."+e.table]=[]),t[e.database+"."+e.table].push({name:e.name,type:e.type})}),n.query("SELECT database,name,engine FROM system.tables").then(function(a){var i=a.data||[];e.vars.databases=i.reduce(function(e,a){var n="";a.engine.match(/Distributed.*/)&&(n="soundcloud"),a.engine.match(/AggregatingMergeTree.*/)&&(n="cube"),a.engine.match(/MaterializedView.*/)&&(n="border-bottom"),a.engine.match(/SummingMergeTree.*/)&&(n="table-row-plus-after"),a.engine.match(/CollapsingMergeTree.*/)&&(n="table-row-height"),a.engine.match(/$Merge^/)&&(n="source-fork"),a.classEngine=n;var i=!0,r=!1,s=void 0;try{for(var o,l=e[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){var d=o.value;if("-"!==a.name&&d.name==a.database)return d.tables.push({name:a.name,engine:a.engine,classEngine:a.classEngine,fields:t[a.database+"."+a.name]}),e}}catch(c){r=!0,s=c}finally{try{!i&&l["return"]&&l["return"]()}finally{if(r)throw s}}return[].concat(_toConsumableArray(e),[{name:a.database,tables:[{name:a.name,engine:a.engine,classEngine:a.classEngine,fields:t[a.database+"."+a.name]}]}])},[]),e.selectDatabase(e.vars.databases[0]),n.query("SELECT name FROM system.databases").then(function(t){var a=t.data||[];a.forEach(function(t){var a=!1;e.vars.databases.forEach(function(e){e.name==t.name&&(a=!0)}),a||e.vars.databases.push({name:t.name,tables:[]})}),e.vars.loaded=!0,e.vars.error=!1},function(){e.vars.loaded=!0,e.vars.error=!0})},function(){e.vars.loaded=!0,e.vars.error=!0})},function(){e.vars.loaded=!0,e.vars.error=!0})},e.reLoad()}e.module(t.app.name).controller("SidebarController",a),a.$inject=["$scope","$rootScope","$state","API","ThemeService","$mdSidenav"]}(angular,smi2),function(e,t){function a(e,t,a,n){e.user=a.getConnectionInfo().name,e.themes=n.list,e.logout=function(){a.clear(),t.go("login")},e.setUiTheme=function(e){return n.set(e.name)}}e.module(t.app.name).controller("HeaderController",a),a.$inject=["$scope","$state","API","ThemeService"]}(angular,smi2),function(){angular.module(smi2.app.name).run(["$rootScope","$state","$http",function(e,t,a){e.breadcrumbs=[],e.currentDatabase=null;var n=e.$on("$stateChangeError",function(e,a,n,i,r,s){"notAuthorized"==s&&t.go("login")});e.$on("$destroy",function(){return n}),a.get("assets/ch_completions_help.json").then(function(e){window.global_chFunctionsHelp=e.data})}])}(),function(e,t){e.module(t.app.name).config(["$stateProvider",function(t){t.state("base",{"abstract":!0,resolve:{session:["$q","API",function(t,a){var n=t.defer();return e.isDefined(a.getConnectionInfo().host)?n.resolve():n.reject("notAuthorized"),n.promise}]},templateUrl:"app/base/base.html"}).state("layout",{parent:"base","abstract":!0,views:{header:{templateUrl:"app/base/header.html",controller:"HeaderController"},sidebar:{templateUrl:"app/base/sidebar.html",controller:"SidebarController"},main:{template:"<ui-view/>"}}}).state("dashboard",{parent:"layout",url:"/",controller:["$state",function(e){return e.go("sql")}]}).state("login",{url:"/login",templateUrl:"app/login/login.html",controller:"LoginController"}).state("sql",{parent:"layout",url:"/sql",templateUrl:"app/sql/sql.html",controller:"SqlController"}).state("table",{parent:"layout",url:"/database/{dbName}/table/{tableName}",templateUrl:"app/table/table.html",controller:"TableController"}).state("processes",{parent:"layout",url:"/processes",templateUrl:"app/processes/processes.html",controller:"ProcessesController"}).state("404",{parent:"layout",templateUrl:"app/base/404.html"})}])}(angular,smi2),function(e,t){e.module(t.app.name).config(["$locationProvider","$httpProvider","$sceProvider","$urlRouterProvider","$mdThemingProvider","ThemeServiceProvider",function(e,t,a,n,i,r){e.html5Mode(!0).hashPrefix("!"),t.interceptors.push("HttpInterceptor"),a.enabled(!1),n.otherwise(function(e){var t=e.get("$state");t.transitionTo("404")}),r.$get().isDark()&&i.theme("default").dark().primaryPalette("blue").accentPalette("blue",{"default":"500"})}]).config(["$translateProvider",function(e){e.translations("en",{"Подключение":"Connection","Неверные данные":"some data is wrong","Название":"name","Хост:порт":"host:port","Логин":"login","Пароль":"password","Удалить":"Delete","Войти":"Sign in","не найдено":"not found","нет данных":"no data","Назад":"Back","Выход":"Sing out","Шрифт":"font","История запросов пуста":"Requests's history is empty","Структура":"Structure","Данные":"Data","Параметры":"Params","Информация":"Information","Размер":"Size","Размер, байт":"Size in bytes","Первая запись":"First record","Последняя запись":"Last record","Тип":"Type","Default тип":"Default type","Значение":"Default value","Рабочий стол":"Dashboard","База":"Database","Выполнить ⌘ + ⏎":"Run ⌘ + ⏎","Таблица":"Table","Таблица ":"Table ","Хотите покинуть страницу?":"Do you want to leave this page?","Ошибка":"Error","Не введен SQL":"SQL request is empty","Выполнить выделенное ⌘ + ⏎":"Run selected ⌘ + ⏎","Выполнить все ⇧ + ⌘ + ⏎":"Run all ⇧ + ⌘ + ⏎","Просмотр":"Preview","Ошибка ":"Error ","Сохранить":"Save","Лог запросов":"Request's log","Тема интерфейса":"Theme","Тема":"Theme","Максимум строк":"Maximum lines","Настройки редактора":"Editor settings","Закрыть":"Close","Размер шрифта":"Font size","Формат результатов":"Result's format","Тема редактора":"Editor theme","Сохранять сессию":"Save session","На весь экран":"Full screen","Словари":"Dictionaries","CSV с заголовком":"CSV with headers","CSV без заголовка":"CSV without headers","Табулированный текст с заголовками":"Tabulated text with headers","Табулированный текст без заголовков":"Tabulated text without headers","время":"time","строк прочитано":"lines read","прочитано":"read","SQL изменен. Сохранить перед закрытием?":"SQL was changed. Save it before exit?","Да":"Yes","Нет":"No","Светлая тема":"Light theme","Темная тема":"Dark theme","с":"from","по":"to","Открыть таблицу":"Open table",";; Двойной":";; Double","; Одинарный":"; Single","Разделитель запросов":"Delimiters queries"}).translations("ru",{}).registerAvailableLanguageKeys(["en","ru"],{"en_*":"en","ru_*":"ru"}).determinePreferredLanguage()}])}(angular,smi2),angular.module("amChartsDirective",[]).directive("amChart",["$q",function(e){return{restrict:"E",replace:!0,scope:{options:"=",chart:"=?",height:"@",width:"@",id:"@"},template:'<div class="amchart"></div>',link:function(t,a){function n(){var e=t.id;if(!e){var a=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};e=a()}return e}var i=n();a.attr("id",i);var r;t.chart=r,e.when(t.options).then(function(n){if(n.data){var s=function(s){var o=s||n,l=t.height||"100%",d=t.width||"100%";a.css({height:l,width:d}),r="xy"===o.type?o.theme?new AmCharts.AmXYChart(AmCharts.themes[o.theme]):new AmCharts.AmXYChart:"pie"===o.type?o.theme?new AmCharts.AmPieChart(AmCharts.themes[o.theme]):new AmCharts.AmPieChart:"funnel"===o.type?o.theme?new AmCharts.AmFunnelChart(AmCharts.themes[o.theme]):new AmCharts.AmFunnelChart:"radar"===o.type?o.theme?new AmCharts.AmRadarChart(AmCharts.themes[o.theme]):new AmCharts.AmRadarChart:o.theme?new AmCharts.AmSerialChart(AmCharts.themes[o.theme]):new AmCharts.AmSerialChart,e.when(o.data).then(function(e){function a(e){if(o.categoryAxis){var t=r.categoryAxis;if(t){t.parseDates=!0;for(var a=Object.keys(o.categoryAxis),n=0;n<a.length;n++)!angular.isObject(o.categoryAxis[a[n]])||angular.isArray(o.categoryAxis[a[n]])?t[a[n]]=o.categoryAxis[a[n]]:console.log("Stripped categoryAxis obj "+a[n]);r.categoryAxis=t}}var i=function(e){for(var t=new AmCharts.ValueAxis,a=Object.keys(e),n=0;n<a.length;n++)t[a[n]]=e[a[n]];r.addValueAxis(t)};if(o.valueAxes&&o.valueAxes.length>0)for(var n=0;n<o.valueAxes.length;n++)i(o.valueAxes[n]);var s=function(e){var t=new AmCharts.AmGraph;if(e&&o.data&&o.data.length>0&&(t.valueField=e.valueField||Object.keys(o.data[0])[1]),t.balloonText='<span style="font-size:14px">[[category]]: <b>[[value]]</b></span>',e)for(var a=Object.keys(e),n=0;n<a.length;n++)t[a[n]]=e[a[n]];r.addGraph(t)};if(o.graphs&&o.graphs.length>0)for(var n=0;n<o.graphs.length;n++)s(o.graphs[n]);else s();if("gantt"===o.type||"serial"===o.type||"xy"===o.type){var l=new AmCharts.ChartCursor;if(o.chartCursor)for(var a=Object.keys(o.chartCursor),n=0;n<a.length;n++)"object"!==_typeof(o.chartCursor[a[n]])&&(l[a[n]]=o.chartCursor[a[n]]);r.addChartCursor(l)}if(o.chartScrollbar){for(var d=new AmCharts.ChartScrollbar,a=Object.keys(o.chartScrollbar),n=0;n<a.length;n++)d[a[n]]=o.chartScrollbar[a[n]];r.chartScrollbar=d}o.balloon&&(r.balloon=o.balloon)}function n(){o.balloon&&(r.balloon=o.balloon),o.balloonFunction&&(r.balloonFunction=o.balloonFunction)}if(r.dataProvider=e,r.categoryField=o.categoryField||Object.keys(o.data[0])[0],r.startDuration=.5,r.autoMargins=!0,r.marginTop=0,r.marginLeft=0,r.marginBottom=0,r.marginRight=0,r.creditsPosition="top-right",o.legend){for(var s=new AmCharts.AmLegend,l=Object.keys(o.legend),d=0;d<l.length;d++)s[l[d]]=o.legend[l[d]];r.legend=s}if("pie"===o.type?n():a(),o.titles)for(var d=0;d<o.titles.length;d++){var c=o.titles[d];r.addTitle(c.text,c.size,c.color,c.alpha,c.bold)}if(o["export"]&&(r.amExport=o["export"],r["export"]=o["export"]),o.responsive&&(r.responsive=o.responsive),o.colors&&(r.colors=o.colors),o.defs&&(r.defs=o.defs),o.listeners)for(var d=0;d<o.listeners.length;d++)r.addListener(o.listeners[d].event,o.listeners[d].method);for(var m=function(e,t){for(var a=0;a<e.length;a++)if(e[a].listeners)for(var n=e[a].listeners,i=0;i<n.length;i++)t[a].addListener(n[i].event,n[i].method)},u=Object.keys(o),d=0;d<u.length;d++)"object"!==_typeof(o[u[d]])&&"function"!=typeof o[u[d]]?r[u[d]]=o[u[d]]:"object"===_typeof(o[u[d]])&&m(o[u[d]],r[u[d]]);r.write(i),t.chart=r})};s();var o=t.$on("amCharts.triggerChartAnimate",function(e,t){t!==a[0].id&&t||r.animateAgain()}),l=t.$on("amCharts.updateData",function(e,t,n){n!==a[0].id&&n||(r.dataProvider=t,r.validateData())}),d=t.$on("amCharts.validateNow",function(e,t,n,i){i!==a[0].id&&i||r.validateNow(void 0===t?!0:t,void 0===n?!1:n)}),c=t.$on("amCharts.renderChart",function(e,t,n){n!==a[0].id&&n||(r.clear(),s(t))});t.$on("$destroy",function(){r.clear(),o(),l(),d(),c()})}})}}}]);